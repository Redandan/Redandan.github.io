import{r as u,j as e,c as we,R as xe}from"./react-vendor.Bj0G0Oyz.js";import"./polyfills.DCfrOiPO.js";import{ab as V,ac as Ce,ad as Te,ae as ve,af as ke,ag as je,ah as Le,ai as be,aj as ye,ak as Ne,al as Ee,am as We,an as Ae}from"./wallet-vendor.CHv2NQr2.js";import"./buffer-polyfill.ErO7y5re.js";const Se=()=>{const[t,r]=u.useState(!0),n=async i=>{try{const o=`${i}test`;return new Promise(d=>{const l=document.createElement("iframe");l.style.display="none",l.src=o;let a=!1;const h=setTimeout(()=>{a||(a=!0,document.body.removeChild(l),d(!1))},1e3);l.onload=()=>{a||(a=!0,clearTimeout(h),document.body.removeChild(l),d(!0))},l.onerror=()=>{a||(a=!0,clearTimeout(h),document.body.removeChild(l),d(!1))},document.body.appendChild(l)})}catch(o){return console.error("æª¢æŸ¥ APP å®‰è£ç‹€æ…‹å¤±æ•—:",o),!1}},s=async i=>{try{const o=document.createElement("a");return o.href=i,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),await new Promise(d=>setTimeout(d,300)),!0}catch(o){return console.error("è§¸ç™¼ Deep Link å¤±æ•—:",o),!1}};return u.useEffect(()=>{const i=o=>{o.origin===window.location.origin&&o.data&&o.data.type==="TRONWALLET_CALLBACK"&&console.log("æ”¶åˆ° TronWallet å›žèª¿:",o.data)};return window.addEventListener("message",i),()=>{window.removeEventListener("message",i)}},[]),{isSupported:t,checkAppInstalled:n,triggerDeepLink:s}},J=()=>{const[t,r]=u.useState({isPC:!1,isMobile:!1,isIOS:!1,isAndroid:!1,isTablet:!1,hasExtension:!1,detectedWallets:[],isPWA:!1,isStandalone:!1,platform:"",browser:""});return u.useEffect(()=>{const n=()=>{const a=navigator.userAgent||navigator.vendor||window.opera,h=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(a),j=/iPad|iPhone|iPod/.test(a)&&!window.MSStream,x=/Android/.test(a),g=/iPad/.test(a)||x&&!/Mobile/.test(a),f=!h,c=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://"),m=c||window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches;let w="Unknown";a.indexOf("Chrome")>-1&&a.indexOf("Edg")===-1?w="Chrome":a.indexOf("Safari")>-1&&a.indexOf("Chrome")===-1?w="Safari":a.indexOf("Firefox")>-1?w="Firefox":a.indexOf("Edg")>-1?w="Edge":(a.indexOf("Opera")>-1||a.indexOf("OPR")>-1)&&(w="Opera");let C="Web";m?j?C="iOS PWA":x?C="Android PWA":C="PWA":f?C="Web PC":j?C="iOS Web":x&&(C="Android Web");const T=[],y=f||m&&!h;y&&((window.tronWeb||window.tronLink||window.tron&&window.tron.tronWeb)&&T.push({name:"TronLink",type:"extension",installed:!0}),window.tokenpocket&&T.push({name:"TokenPocket",type:"extension",installed:!0}),window.bitkeep&&(window.bitkeep.tronLink||window.bitkeep.tron)&&T.push({name:"BitKeep",type:"extension",installed:!0}),window.okxwallet&&T.push({name:"OKX Wallet",type:"extension",installed:!0}));const N=T.length>0;m&&console.log("[useEnvironment] PWAæ¨¡å¼æª¢æ¸¬çµæžœ:",{isPWA:m,isPC:f,isMobile:h,platform:C,shouldDetectExtensions:y,detectedWallets:T.map(W=>W.name),hasExtension:N,windowTronWeb:!!window.tronWeb,windowTronLink:!!window.tronLink,windowTron:!!window.tron,windowTokenPocket:!!window.tokenpocket,windowBitKeep:!!window.bitkeep,windowOkxWallet:!!window.okxwallet}),r({isPC:f,isMobile:h,isIOS:j,isAndroid:x,isTablet:g,hasExtension:N,detectedWallets:T,isPWA:m,isStandalone:c,platform:C,browser:w})};n();let s=0;const i=10;let o=setInterval(()=>{n(),s++,s>=i&&(clearInterval(o),o=setInterval(n,3e3))},1e3),d;const l=()=>{clearTimeout(d),d=setTimeout(n,300)};return window.addEventListener("resize",l),()=>{o&&clearInterval(o),d&&clearTimeout(d),window.removeEventListener("resize",l)}},[]),t},ae={apiBaseUrl:"https://agoramarketapi.purrtechllc.com/api"};async function Pe(t){const r=await fetch(`${ae.apiBaseUrl}/auth/wallet-connect/nonce`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({walletAddress:t})});if(!r.ok)throw new Error("ç²å– nonce å¤±æ•—: "+r.statusText);const n=await r.json();if(n.message&&(!n.nonce||n.nonce==="")&&n.message.includes("Nonce:")){const s=n.message.match(/Nonce:\s*([^\n]+)/);s&&s[1]&&(n.nonce=s[1].trim())}if(n.message&&!n.timestamp&&n.message.includes("Timestamp:")){const s=n.message.match(/Timestamp:\s*([^\n]+)/);if(s&&s[1]){const i=parseInt(s[1].trim());isNaN(i)||(n.timestamp=i)}}if(!n.message||n.message==="")throw new Error("ç²å– nonce å¤±æ•—ï¼šç¼ºå°‘ message å­—æ®µ");if(!n.nonce||n.nonce==="")throw new Error("ç²å– nonce å¤±æ•—ï¼šç¼ºå°‘ nonce å­—æ®µ");return n.timestamp||(n.timestamp=Math.floor(Date.now()/1e3)),n}async function Re(t,r,n,s="tron"){const i={walletAddress:t,signature:r,nonce:n.nonce,timestamp:n.timestamp};s==="tron"&&(i.chain="TRC20",i.chainType="tron");const o=await fetch(`${ae.apiBaseUrl}/auth/wallet-connect/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!o.ok){const l=await o.json().catch(()=>({message:o.statusText}));throw new Error(l.message||"ç™»éŒ„å¤±æ•—: "+o.statusText)}const d=await o.json();if(!d.token||!d.refreshToken)throw new Error(d.message||"ç™»éŒ„éŸ¿æ‡‰ä¸­ç¼ºå°‘ token");return d}const P={WALLET_CONNECTED:"WALLET_CONNECTED",WALLET_DISCONNECTED:"WALLET_DISCONNECTED",WALLET_ADDRESS:"WALLET_ADDRESS",JWT_REQUEST:"JWT_REQUEST",JWT_RECEIVED:"JWT_RECEIVED",JWT_ERROR:"JWT_ERROR",READY:"READY",ERROR:"ERROR",INIT:"INIT",CLOSE:"CLOSE"},I=(t,r={})=>{const n={source:"tron-wallet-login-module",type:t,data:r,timestamp:Date.now()};window.parent&&window.parent!==window&&window.parent.postMessage(n,"*"),window.flutter_inappwebview&&window.flutter_inappwebview.callHandler("onMessage",n),window.onTronWalletLoginMessage&&window.onTronWalletLoginMessage(n)},Me=t=>{const r=n=>{n.data&&n.data.source==="flutter-app"&&t(n.data)};return window.addEventListener("message",r),window.flutter_inappwebview&&window.flutter_inappwebview.addEventListener("message",r),()=>{window.removeEventListener("message",r),window.flutter_inappwebview&&window.flutter_inappwebview.removeEventListener("message",r)}},ne=()=>{I(P.READY,{version:"1.0.0",timestamp:Date.now()})},Oe=t=>{I(P.ERROR,{error:t.message||t,stack:t.stack})},De={common:{connect:"é€£æŽ¥",disconnect:"æ–·é–‹é€£æŽ¥",cancel:"å–æ¶ˆ",confirm:"ç¢ºèª",loading:"è¼‰å…¥ä¸­",error:"éŒ¯èª¤",success:"æˆåŠŸ",retry:"é‡è©¦",back:"è¿”å›ž"},login:{title:"é€£æŽ¥éŒ¢åŒ…",description:{pc:"è«‹é¸æ“‡éŒ¢åŒ…é€£æŽ¥æ–¹å¼",mobile:"è«‹é¸æ“‡éŒ¢åŒ…é€²è¡Œé€£æŽ¥",detected:"æª¢æ¸¬åˆ° {wallets}ï¼Œè«‹é¸æ“‡ç™»å…¥æ–¹å¼"},selectWallet:"é¸æ“‡éŒ¢åŒ…",quickLogin:"å¿«æ·ç™»å…¥",useMobileApp:"ä½¿ç”¨æ‰‹æ©Ÿ APP",mobileAppDesc:"é€šéŽ Deep Link æ‰“é–‹ TronLink APP",or:"æˆ–"},wallet:{connected:"å·²é€£æŽ¥éŒ¢åŒ…",connectedWaitingSignature:"å·²é€£æŽ¥éŒ¢åŒ…(ç­‰å¾…ç°½å)",connectedSignatureSuccess:"å·²é€£æŽ¥éŒ¢åŒ…(ç°½åæˆåŠŸ)",redirectingToLogin:"è·³è½‰ç™»å…¥...",disconnected:"éŒ¢åŒ…å·²æ–·é–‹",connecting:"é€£æŽ¥ä¸­",address:"éŒ¢åŒ…åœ°å€ï¼š",connectingTo:"æ­£åœ¨é€£æŽ¥åˆ° {wallet}...",unknown:"æœªçŸ¥éŒ¢åŒ…"},errors:{loginFailed:"ç™»å…¥å¤±æ•—ï¼Œè«‹é‡è©¦",cannotOpenApp:"ç„¡æ³•æ‰“é–‹ TronLink APPï¼Œè«‹ç¢ºèªå·²å®‰è£ä¸¦é‡è©¦",appNotInstalled:`æœªæª¢æ¸¬åˆ° TronLink APPï¼Œæ˜¯å¦å‰å¾€ä¸‹è¼‰ï¼Ÿ

å¦‚æžœå·²å®‰è£ï¼Œè«‹é»žæ“Šå–æ¶ˆå¾Œé‡è©¦ã€‚`,signatureCanceled:"ç°½åå·²å–æ¶ˆã€‚è«‹åœ¨éŒ¢åŒ…ä¸­ç¢ºèªç°½åä»¥ç¹¼çºŒç™»å…¥ã€‚",signatureFailed:"ç°½åå¤±æ•—ï¼Œè«‹é‡è©¦",jwtFailed:"JWT èªè­‰å¤±æ•—: {error}",connectionFailed:"é€£æŽ¥å¤±æ•—: {error}",walletNotSupported:"{wallet} ä¸æ”¯æŒç°½ååŠŸèƒ½ã€‚è«‹ä½¿ç”¨æ”¯æŒç°½åçš„éŒ¢åŒ…ï¼ˆå¦‚ TronLinkã€Ledger ç­‰ï¼‰ã€‚",ledgerTimeout:"Ledger ç°½åè¶…æ™‚ã€‚è«‹ç¢ºä¿è¨­å‚™å·²é€£æŽ¥ä¸¦è§£éŽ–ï¼Œç„¶å¾Œé‡è©¦ã€‚",ledgerNotConnected:"Ledger è¨­å‚™æœªé€£æŽ¥ã€‚è«‹é€£æŽ¥è¨­å‚™å¾Œé‡è©¦ã€‚",ledgerConfirm:"è«‹åœ¨ Ledger è¨­å‚™ä¸Šç¢ºèªç°½å...",nonceFailed:"ç²å– nonce å¤±æ•—: {error}",verifyFailed:"ç™»éŒ„å¤±æ•—: {error}",unknownError:"æœªçŸ¥éŒ¯èª¤"},tips:{title:"ðŸ’¡ æç¤ºï¼š",pcWithExtension:["æª¢æ¸¬åˆ° {wallets} æ“´å±•","é»žæ“Šä¸Šæ–¹æŒ‰éˆ•é¸æ“‡éŒ¢åŒ…é€²è¡Œé€£æŽ¥","æ”¯æŒå¤šç¨®éŒ¢åŒ…ï¼šç€è¦½å™¨æ“´å±•ã€ç§»å‹•ç«¯éŒ¢åŒ…ã€ç¡¬ä»¶éŒ¢åŒ…","é¦–æ¬¡ä½¿ç”¨éœ€è¦åœ¨éŒ¢åŒ…ä¸­æŽˆæ¬Š"],pcWithoutExtension:["æŽ¨è–¦å®‰è£ TronLinkã€TokenPocket ç­‰ç€è¦½å™¨æ“´å±•","æˆ–ä½¿ç”¨ WalletConnect é€£æŽ¥ç§»å‹•ç«¯éŒ¢åŒ…","æ”¯æŒ Ledger ç¡¬ä»¶éŒ¢åŒ…","é»žæ“Šä¸Šæ–¹æŒ‰éˆ•æŸ¥çœ‹æ‰€æœ‰å¯ç”¨é¸é …"],mobile:["ç§»å‹•ç«¯æŽ¨è–¦ä½¿ç”¨ WalletConnect é€£æŽ¥éŒ¢åŒ…","æˆ–é€šéŽ Deep Link æ‰“é–‹ TronLink APP","æ”¯æŒ Trust Walletã€ImToken ç­‰ç§»å‹•ç«¯éŒ¢åŒ…","é»žæ“Šä¸Šæ–¹æŒ‰éˆ•æŸ¥çœ‹æ‰€æœ‰å¯ç”¨é¸é …"]},modal:{connectWalletTitle:"é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ",detected:"å·²æª¢æ¸¬",notFound:"æœªæ‰¾åˆ°",installed:"å·²å®‰è£",notInstalled:"æœªå®‰è£",loading:"è¼‰å…¥ä¸­",connecting:"é€£æŽ¥ä¸­",connected:"å·²é€£æŽ¥",disconnect:"æ–·é–‹é€£æŽ¥"},environment:{webPC:"Web PC",webMobile:"Web ç§»å‹•ç«¯",iosWeb:"iOS Web",androidWeb:"Android Web",iosPWA:"iOS PWA",androidPWA:"Android PWA",pwa:"PWA"},process:{gettingNonce:"ðŸ“¨ æ­£åœ¨ç²å– nonce...",nonceSuccess:"âœ… Nonce ç²å–æˆåŠŸ",signing:"âœï¸ æ­£åœ¨ç°½åæ¶ˆæ¯...",signatureSuccess:"âœ… ç°½åæˆåŠŸ",verifying:"ðŸ” æ­£åœ¨é©—è­‰ç°½åä¸¦ç™»å…¥...",loginSuccess:"âœ… ç™»å…¥æˆåŠŸï¼Œå·²ç²å– Token",jwtSent:"âœ… JWT Token å·²ç™¼é€çµ¦ Flutter",ledgerDetected:"ðŸ” æª¢æ¸¬åˆ° Ledger ç¡¬ä»¶éŒ¢åŒ…ï¼Œè«‹åœ¨è¨­å‚™ä¸Šç¢ºèªç°½å..."},signing:{pendingTitle:"è«‹å®Œæˆç°½åä»¥å®Œæˆç™»å…¥",pendingDesc:"éŒ¢åŒ…å·²é€£æŽ¥ï¼Œè«‹åœ¨éŒ¢åŒ…ä¸­ç¢ºèªç°½åè«‹æ±‚",retry:"é‡æ–°ç°½å"}},Ie={common:{connect:"Connect",disconnect:"Disconnect",cancel:"Cancel",confirm:"Confirm",loading:"Loading",error:"Error",success:"Success",retry:"Retry",back:"Back"},login:{title:"Connect Wallet",description:{pc:"Please select wallet connection method",mobile:"Please select a wallet to connect",detected:"Detected {wallets}, please select login method"},selectWallet:"Select Wallet",quickLogin:"Quick Login",useMobileApp:"Use Mobile APP",mobileAppDesc:"Open TronLink APP via Deep Link",or:"or"},wallet:{connected:"Wallet Connected",connectedWaitingSignature:"Wallet Connected (Waiting for Signature)",connectedSignatureSuccess:"Wallet Connected (Signature Success)",redirectingToLogin:"Redirecting to Login...",disconnected:"Wallet Disconnected",connecting:"Connecting",address:"Wallet Address:",connectingTo:"Connecting to {wallet}...",unknown:"Unknown Wallet"},errors:{loginFailed:"Login failed, please try again",cannotOpenApp:"Cannot open TronLink APP, please confirm it is installed and try again",appNotInstalled:`TronLink APP not detected, go to download?

If already installed, please click cancel and try again.`,signatureCanceled:"Signature canceled. Please confirm the signature in the wallet to continue login.",signatureFailed:"Signature failed, please try again",jwtFailed:"JWT authentication failed: {error}",connectionFailed:"Connection failed: {error}",walletNotSupported:"{wallet} does not support signature function. Please use a wallet that supports signatures (such as TronLink, Ledger, etc.).",ledgerTimeout:"Ledger signature timeout. Please ensure the device is connected and unlocked, then try again.",ledgerNotConnected:"Ledger device not connected. Please connect the device and try again.",ledgerConfirm:"Please confirm signature on Ledger device...",nonceFailed:"Failed to get nonce: {error}",verifyFailed:"Login failed: {error}",unknownError:"Unknown error"},tips:{title:"ðŸ’¡ Tips:",pcWithExtension:["Detected {wallets} extension","Click the button above to select wallet for connection","Supports multiple wallets: browser extensions, mobile wallets, hardware wallets","First-time use requires authorization in the wallet"],pcWithoutExtension:["Recommended to install TronLink, TokenPocket and other browser extensions","Or use WalletConnect to connect mobile wallets","Supports Ledger hardware wallet","Click the button above to view all available options"],mobile:["Mobile devices recommend using WalletConnect to connect wallets","Or open TronLink APP via Deep Link","Supports Trust Wallet, ImToken and other mobile wallets","Click the button above to view all available options"]},modal:{connectWalletTitle:"Connect a wallet on Tron to continue",detected:"Detected",notFound:"NotFound",installed:"Installed",notInstalled:"NotInstalled",loading:"Loading",connecting:"Connecting",connected:"Connected",disconnect:"Disconnect"},environment:{webPC:"Web PC",webMobile:"Web Mobile",iosWeb:"iOS Web",androidWeb:"Android Web",iosPWA:"iOS PWA",androidPWA:"Android PWA",pwa:"PWA"},process:{gettingNonce:"ðŸ“¨ Getting nonce...",nonceSuccess:"âœ… Nonce obtained successfully",signing:"âœï¸ Signing message...",signatureSuccess:"âœ… Signature successful",verifying:"ðŸ” Verifying signature and logging in...",loginSuccess:"âœ… Login successful, Token obtained",jwtSent:"âœ… JWT Token sent to Flutter",ledgerDetected:"ðŸ” Ledger hardware wallet detected, please confirm signature on device..."},signing:{pendingTitle:"Please complete signature to finish login",pendingDesc:"Wallet connected, please confirm signature request in wallet",retry:"Retry Signature"}},le=u.createContext(),$=()=>{const t=u.useContext(le);if(!t)throw new Error("useLanguage must be used within LanguageProvider");return t},Fe=({children:t})=>{const r=()=>{try{return localStorage.getItem("wallet-login-language")==="en"?"en":"zh"}catch{return"zh"}},[n,s]=u.useState(r),i={zh:De,en:Ie},o=(j,x={})=>{const g=j.split(".");let f=i[n];for(const c of g)if(f&&typeof f=="object")f=f[c];else return j;return typeof f=="string"&&Object.keys(x).length>0?f.replace(/\{(\w+)\}/g,(c,m)=>x[m]!==void 0?x[m]:c):Array.isArray(f)&&Object.keys(x).length>0?f.map(c=>typeof c=="string"?c.replace(/\{(\w+)\}/g,(m,w)=>x[w]!==void 0?x[w]:m):c):f||j},d=j=>{(j==="zh"||j==="en")&&(s(j),localStorage.setItem("wallet-login-language",j),window.dispatchEvent(new Event("languageChanged")))},l=()=>n,a=()=>n==="zh",h=()=>n==="en";return e.jsx(le.Provider,{value:{language:n,t:o,changeLanguage:d,getLanguage:l,isZh:a,isEn:h},children:t})},Be=()=>{const[t,r]=u.useState(""),{signMessage:n,wallet:s}=V(),{t:i}=$(),o=u.useCallback(async d=>{var l,a;try{r(""),console.log(i("process.gettingNonce"));const h=await Pe(d);if(console.log(i("process.nonceSuccess"),h.nonce),!n){const x=((l=s==null?void 0:s.adapter)==null?void 0:l.name)||i("wallet.unknown");throw new Error(i("errors.walletNotSupported",{wallet:x}))}const j=((a=s==null?void 0:s.adapter)==null?void 0:a.name)==="Ledger";j?(console.log(i("process.ledgerDetected")),r(i("errors.ledgerConfirm"))):console.log(i("process.signing"));try{const x=await n(h.message);console.log(i("process.signatureSuccess")),j&&r(""),console.log(i("process.verifying"));const g=await Re(d,x,h,"tron");console.log(i("process.loginSuccess")),I(P.JWT_RECEIVED,{token:g.token,refreshToken:g.refreshToken,user:g.user,address:d,timestamp:Date.now()}),console.log(i("process.jwtSent"))}catch(x){const g=x.message||x.toString();if(g.includes("rejected")||g.includes("denied")||g.includes("cancel")||g.includes("å–æ¶ˆ")||g.includes("æ‹’çµ•"))throw new Error(i("errors.signatureCanceled"));if(j){if(g.includes("timeout")||g.includes("è¶…æ™‚"))throw new Error(i("errors.ledgerTimeout"));if(g.includes("not connected")||g.includes("æœªé€£æŽ¥"))throw new Error(i("errors.ledgerNotConnected"))}throw x}}catch(h){throw console.error("âŒ JWT è«‹æ±‚å¤±æ•—:",h),Oe(h),r(i("errors.jwtFailed",{error:h.message||h.toString()})),h}},[n,s,i]);return{error:t,setError:r,handleJWTRequest:o}},_={TRONWALLET_SCHEME:"tronlink://",TRONWALLET_UNIVERSAL_LINK:"https://www.tronlink.org/",CALLBACK_PATH:"/callback"},z={PROJECT_ID:"7412eb629501759c091220ccc09ded23",NETWORK:"mainnet",get METADATA(){return{name:"TRON éŒ¢åŒ…ç™»å…¥æ¨¡å¡Š",description:"TRON éŒ¢åŒ…ç™»å…¥æ¨¡å¡Š - Flutter Web é›†æˆ",url:window.location.origin,icons:[`${window.location.origin}/favicon.ico`]}}},_e={TronLink:"TronLink",TokenPocket:"TokenPocket",BitKeep:"BitKeep","OKX Wallet":"OkxWallet"},$e=()=>{const{wallets:t,select:r,connect:n,connecting:s,connected:i,wallet:o}=V(),{detectedWallets:d}=J(),l=u.useMemo(()=>!t||d.length===0?[]:d.map(g=>{const f=_e[g.name];if(!f)return null;let c=t.find(m=>m.adapter.name===f);return c||(c=t.find(m=>m.adapter.name.toLowerCase().includes(g.name.toLowerCase())||g.name.toLowerCase().includes(m.adapter.name.toLowerCase()))),c?{...c,detectedName:g.name}:null}).filter(Boolean),[t,d]),a=u.useRef(0),h=u.useRef(0);return u.useEffect(()=>{const x=l.length,g=d.length,f=a.current,c=h.current;(x!==f||g!==c)&&(x>0?console.log("[useQuickLogin] å¯ç”¨éŒ¢åŒ…åˆ—è¡¨:",{detectedWallets:d.map(m=>m.name),availableWallets:l.map(m=>({name:m.adapter.name,detectedName:m.detectedName}))}):t&&t.length>0&&g===0&&console.log("[useQuickLogin] ç„¡å¯ç”¨éŒ¢åŒ…:",{hasWallets:!0,walletsCount:t.length,detectedWalletsCount:0,allWallets:t.map(m=>m.adapter.name)}),a.current=x,h.current=g)},[l,d,t]),{availableWallets:l,handleQuickConnect:async x=>{var f,c,m,w,C,T,y,N,W;const g=x.adapter.name;console.log("[QuickLogin] é–‹å§‹é€£æŽ¥éŒ¢åŒ…:",{walletName:g,availableWallets:t.map(k=>k.adapter.name),currentWallet:(f=o==null?void 0:o.adapter)==null?void 0:f.name,connecting:s,connected:i});try{const k=t.find(b=>b.adapter.name===g);if(console.log("[QuickLogin] æŸ¥æ‰¾éŒ¢åŒ…é©é…å™¨:",{walletName:g,found:!!k,targetWalletName:(c=k==null?void 0:k.adapter)==null?void 0:c.name,allWallets:t.map(b=>({name:b.adapter.name,readyState:b.adapter.readyState}))}),!k)throw new Error(`æ‰¾ä¸åˆ°éŒ¢åŒ…é©é…å™¨: ${g}`);console.log("[QuickLogin] æ­¥é©Ÿ 1: é¸æ“‡éŒ¢åŒ…",g),await r(g),console.log("[QuickLogin] æ­¥é©Ÿ 1 å®Œæˆ: select() å·²èª¿ç”¨"),console.log("[QuickLogin] æ­¥é©Ÿ 2: ç­‰å¾…é¸æ“‡å®Œæˆ..."),await new Promise(b=>setTimeout(b,500)),console.log("[QuickLogin] é¸æ“‡å¾Œç‹€æ…‹:",{currentWallet:(m=o==null?void 0:o.adapter)==null?void 0:m.name,expectedWallet:g,match:((w=o==null?void 0:o.adapter)==null?void 0:w.name)===g}),console.log("[QuickLogin] æ­¥é©Ÿ 3: é–‹å§‹é€£æŽ¥éŒ¢åŒ…..."),await n(),console.log("[QuickLogin] æ­¥é©Ÿ 3 å®Œæˆ: connect() æˆåŠŸ")}catch(k){console.error("[QuickLogin] å¿«é€Ÿé€£æŽ¥éŒ¯èª¤:",{error:k,message:k==null?void 0:k.message,stack:k==null?void 0:k.stack,walletName:g,currentWallet:(C=o==null?void 0:o.adapter)==null?void 0:C.name,connecting:s,connected:i});const b=(k==null?void 0:k.message)||(k==null?void 0:k.toString())||"";if(b.includes("No wallet is selected")||b.includes("not selected"))try{console.log('[QuickLogin] æª¢æ¸¬åˆ° "No wallet is selected" éŒ¯èª¤ï¼Œå˜—è©¦é‡è©¦...'),console.log("[QuickLogin] é‡è©¦å‰ç‹€æ…‹:",{walletName:g,currentWallet:(T=o==null?void 0:o.adapter)==null?void 0:T.name,wallets:t.map(L=>L.adapter.name)}),console.log("[QuickLogin] é‡è©¦: å†æ¬¡é¸æ“‡éŒ¢åŒ…",g),await r(g),console.log("[QuickLogin] é‡è©¦: ç­‰å¾…é¸æ“‡å®Œæˆ..."),await new Promise(L=>setTimeout(L,800)),console.log("[QuickLogin] é‡è©¦å¾Œç‹€æ…‹:",{currentWallet:(y=o==null?void 0:o.adapter)==null?void 0:y.name,expectedWallet:g,match:((N=o==null?void 0:o.adapter)==null?void 0:N.name)===g}),console.log("[QuickLogin] é‡è©¦: å†æ¬¡å˜—è©¦é€£æŽ¥..."),await n(),console.log("[QuickLogin] é‡è©¦æˆåŠŸ")}catch(L){console.error("[QuickLogin] é‡è©¦é€£æŽ¥å¤±æ•—:",{error:L,message:L==null?void 0:L.message,stack:L==null?void 0:L.stack,walletName:g,currentWallet:(W=o==null?void 0:o.adapter)==null?void 0:W.name});const R=(L==null?void 0:L.message)||(L==null?void 0:L.toString())||"";throw R.includes("No wallet is selected")||R.includes("not selected")?new Error(`ç„¡æ³•é¸æ“‡éŒ¢åŒ… ${g}ã€‚è«‹ç¢ºä¿ TronLink æ“´å±•å·²å®‰è£ä¸¦å•Ÿç”¨ã€‚`):L}else throw k}},connecting:s,connected:i,currentWallet:o}};function H(){try{return localStorage.getItem("wallet-login-language")==="en"?"en":"zh"}catch{return"zh"}}const qe={"Connect a wallet on Tron to continue.":"é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ","Connect a wallet on Tron to continue":"é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ","Connect a wallet on":"é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ","Tron to continue":"é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ","Connect a wallet":"é€£æŽ¥éŒ¢åŒ…",Detected:"å·²æª¢æ¸¬",NotFound:"æœªæ‰¾åˆ°",NotDetected:"æœªæª¢æ¸¬",Installed:"å·²å®‰è£",NotInstalled:"æœªå®‰è£",Loading:"è¼‰å…¥ä¸­",Connecting:"é€£æŽ¥ä¸­",Connected:"å·²é€£æŽ¥",Disconnect:"æ–·é–‹é€£æŽ¥","Select Wallet":"é¸æ“‡éŒ¢åŒ…",Wallet:"éŒ¢åŒ…","on Tron":"TRON","to continue":"ä»¥ç¹¼çºŒ"},Qe={"Connect a wallet on Tron to continue.":"Connect a wallet on Tron to continue.","Connect a wallet on Tron to continue":"Connect a wallet on Tron to continue","Connect a wallet on":"Connect a wallet on","Tron to continue":"Tron to continue","Connect a wallet":"Connect a wallet",Detected:"Detected",NotFound:"NotFound",NotDetected:"NotDetected",Installed:"Installed",NotInstalled:"NotInstalled",Loading:"Loading",Connecting:"Connecting",Connected:"Connected",Disconnect:"Disconnect","Select Wallet":"Select Wallet",Wallet:"Wallet","on Tron":"on Tron","to continue":"to continue"};function ce(){return H()==="zh"?qe:Qe}function oe(t){if(!t)return t;const r=ce();H()==="zh"&&(t=t.replace(/Connect a wallet on Tron to continue\.?/gi,r["Connect a wallet on Tron to continue"]),t=t.replace(/Connect a wallet on\s*$/gi,r["Connect a wallet on Tron to continue"]),t.includes(r["Connect a wallet on Tron to continue"])?t=t.replace(/Tron to continue\.?/gi,""):t=t.replace(/Tron to continue\.?/gi,""));for(const[s,i]of Object.entries(r)){if(t.trim()===s)return i;const o=new RegExp(`^\\s*${s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\s*$`,"gi");t=t.replace(o,i)}return t}function de(t){if(t){if(t.nodeType===Node.TEXT_NODE){const r=t.textContent,n=oe(r);n!==r&&(t.textContent=n)}else if(t.nodeType===Node.ELEMENT_NODE){const r=t.textContent&&(t.textContent.includes("Connect a wallet")||t.textContent.includes("Detected")||t.textContent.includes("NotFound")||t.textContent.includes("Select Wallet"));if(t.dataset.translated==="true"&&!r)return;const n=t.textContent.trim(),i=ce()["Connect a wallet on Tron to continue"];if(n.includes("Connect a wallet on Tron to continue")||n.includes("Connect a wallet on")&&n.includes("Tron to continue")){t.innerHTML=i,t.dataset.translated="true";return}if(t.children.length===0){const o=t.textContent.trim(),d=oe(o);if(d!==o){t.textContent=d,t.dataset.translated="true";return}}Array.from(t.childNodes).forEach(o=>{de(o)})}}}function Ue(t){if(!t)return!1;if(t.textContent.trim().includes("Connect a wallet on Tron to continue"))return t.innerHTML="é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ",t.dataset.translated="true",!0;const n=Array.from(t.childNodes);let s=!1,i=!1,o=null,d=null;return n.forEach(l=>{const a=l.textContent.trim();(a.includes("Connect a wallet on")||a==="Connect a wallet on")&&(s=!0,o=l),(a.includes("Tron to continue")||a==="Tron to continue")&&(i=!0,d=l)}),s&&i?(o&&(o.textContent="é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ",o.dataset.translated="true"),d&&(d.textContent=""),t.dataset.translated="true",!0):(n.forEach(l=>{if(l.nodeType===Node.TEXT_NODE){const a=l.textContent.trim();if(a==="Connect a wallet on"||a.includes("Connect a wallet on"))l.textContent="é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ";else if(a==="Tron to continue"||a.includes("Tron to continue")){const h=l.previousSibling;h&&h.textContent&&h.textContent.includes("é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ"),l.textContent=""}}else if(l.nodeType===Node.ELEMENT_NODE){const a=l.textContent.trim();a==="Connect a wallet on"||a.includes("Connect a wallet on")?(l.textContent="é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ",l.dataset.translated="true"):(a==="Tron to continue"||a.includes("Tron to continue"))&&(l.textContent="")}}),!1)}function D(){['[role="dialog"]','[class*="wallet-adapter"]','[class*="wallet-modal"]','[class*="WalletModal"]','[class*="modal"]'].forEach(r=>{try{document.querySelectorAll(r).forEach(s=>{s&&(s.textContent&&(s.textContent.includes("Connect a wallet")||s.textContent.includes("Detected")||s.textContent.includes("NotFound")||s.textContent.includes("Select Wallet")||s.textContent.includes("NotDetected")||s.textContent.includes("NotInstalled"))&&(s.dataset.translated="false",s.querySelectorAll('[data-translated="true"]').forEach(o=>{o.dataset.translated="false"})),(!s.dataset.translated||s.dataset.translated==="false")&&(s.querySelectorAll('h1, h2, h3, h4, h5, h6, [class*="title"], [class*="Title"]').forEach(d=>{(!d.dataset.translated||d.dataset.translated==="false")&&Ue(d)}),de(s),s.dataset.translated="true"))})}catch{}})}function ze(t=null){t||H();const r=new MutationObserver(o=>{let d=!1;o.forEach(l=>{l.addedNodes.forEach(a=>{var h;if(a.nodeType===Node.ELEMENT_NODE){const j=((h=a.classList)==null?void 0:h.toString())||"",x=a.getAttribute("role")||"";(j.includes("wallet")||j.includes("modal")||x==="dialog"||a.querySelector('[role="dialog"]')||a.querySelector('[class*="wallet"]')||a.querySelector('[class*="modal"]'))&&(d=!0)}})}),d&&requestAnimationFrame(()=>{D(),requestAnimationFrame(()=>{D()})})});document.body&&r.observe(document.body,{childList:!0,subtree:!0});const n=()=>{D()};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n):n();const s=setInterval(()=>{D()},200),i=()=>{document.querySelectorAll('[data-translated="true"]').forEach(o=>{o.dataset.translated="false"}),D()};return window.addEventListener("storage",i),window.addEventListener("languageChanged",i),{disconnect:()=>{r.disconnect(),clearInterval(s),window.removeEventListener("storage",i),window.removeEventListener("languageChanged",i)}}}const ue=u.createContext(),Ve=()=>{const t=u.useContext(ue);if(!t)throw new Error("useTheme must be used within ThemeProvider");return t},Je=({children:t})=>{const r=()=>{try{const o=localStorage.getItem("wallet-login-theme");return o?o==="dark"?"dark":"light":window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}catch{return"light"}},[n,s]=u.useState(r),i=()=>{const o=n==="light"?"dark":"light";s(o),localStorage.setItem("wallet-login-theme",o),document.documentElement.setAttribute("data-theme",o)};return u.useEffect(()=>{document.documentElement.setAttribute("data-theme",n)},[n]),u.useEffect(()=>{const o=window.matchMedia("(prefers-color-scheme: dark)"),d=l=>{localStorage.getItem("wallet-login-theme")||s(l.matches?"dark":"light")};return o.addEventListener("change",d),()=>o.removeEventListener("change",d)},[]),e.jsx(ue.Provider,{value:{theme:n,toggleTheme:i,isDark:n==="dark",isLight:n==="light"},children:t})},se=()=>{const{language:t,changeLanguage:r}=$(),{theme:n,toggleTheme:s}=Ve();return e.jsxs("div",{className:"language-switcher",children:[e.jsx("button",{className:"theme-btn",onClick:s,title:n==="light"?"åˆ‡æ›åˆ°æ·±è‰²ä¸»é¡Œ":"åˆ‡æ›åˆ°æ·ºè‰²ä¸»é¡Œ","aria-label":n==="light"?"Switch to dark theme":"Switch to light theme",children:n==="light"?e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})}):e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),e.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),e.jsx("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),e.jsx("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),e.jsx("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),e.jsx("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),e.jsx("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),e.jsx("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]})}),e.jsx("button",{className:`lang-btn ${t==="zh"?"active":""}`,onClick:()=>r("zh"),title:"ä¸­æ–‡",children:"ä¸­æ–‡"}),e.jsx("button",{className:`lang-btn ${t==="en"?"active":""}`,onClick:()=>r("en"),title:"English",children:"EN"})]})},He=({address:t,signingStatus:r})=>{const{t:n}=$(),{platform:s,browser:i,isPWA:o}=J(),l=r==="pending"?{title:n("wallet.connectedWaitingSignature","å·²é€£æŽ¥éŒ¢åŒ…(ç­‰å¾…ç°½å)"),icon:e.jsx("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"})}),className:"status-waiting"}:r==="success"?{title:n("wallet.connectedSignatureSuccess","å·²é€£æŽ¥éŒ¢åŒ…(ç°½åæˆåŠŸ)"),icon:e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),className:"status-success"}:{title:n("wallet.connected","å·²é€£æŽ¥éŒ¢åŒ…"),icon:e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),className:"status-default"};return e.jsxs("div",{className:"wallet-info",children:[e.jsxs("div",{className:`success-message ${l.className}`,children:[e.jsx("div",{className:"status-icon-wrapper",children:l.icon}),e.jsx("h2",{children:l.title}),r==="success"&&e.jsx("p",{className:"login-redirect-message",children:n("wallet.redirectingToLogin","è·³è½‰ç™»å…¥...")})]}),e.jsx("div",{className:"environment-info",children:e.jsxs("div",{className:"env-badge",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),e.jsx("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),e.jsx("line",{x1:"12",y1:"17",x2:"12",y2:"21"})]}),e.jsx("span",{className:"env-platform",children:s}),i&&i!=="Unknown"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"env-separator",children:"Â·"}),e.jsx("span",{className:"env-browser",children:i})]}),o&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"env-separator",children:"Â·"}),e.jsx("span",{className:"env-pwa-badge",children:"PWA"})]})]})}),e.jsxs("div",{className:"address-display",children:[e.jsxs("label",{children:[n("wallet.address"),"ï¼š"]}),e.jsx("div",{className:"address-value",children:t})]}),e.jsx("div",{className:"wallet-actions",children:e.jsx(Ce,{})})]})},Ke=({availableWallets:t,onWalletClick:r,connecting:n,connectedWallet:s})=>t.length===0?null:e.jsx("div",{className:"quick-login-section",children:e.jsx("div",{className:"quick-login-buttons",children:t.map(i=>{var l,a;const o=i.adapter.name===((l=s==null?void 0:s.adapter)==null?void 0:l.name),d=n&&o;return e.jsxs("button",{className:"quick-login-btn",onClick:()=>r(i),disabled:d,children:[e.jsxs("div",{className:"quick-login-icon",children:[i.adapter.icon&&e.jsx("img",{src:i.adapter.icon,alt:i.detectedName,onError:h=>{h.target.style.display="none"}}),(!i.adapter.icon||!i.adapter.icon.startsWith("data:"))&&e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]})]}),e.jsx("span",{className:"quick-login-name",children:i.detectedName}),n&&i.adapter.name===((a=s==null?void 0:s.adapter)==null?void 0:a.name)&&e.jsx("div",{className:"quick-login-spinner"})]},i.adapter.name)})})}),Ge=500,Xe=()=>{const[t,r]=u.useState([]),[n,s]=u.useState(!0),i=u.useRef(null),o=u.useRef(null),d=u.useRef(null),l=u.useRef(n),a=u.useRef(null);u.useEffect(()=>{l.current=n},[n]);const h=u.useCallback((f,c,m=null)=>{if(l.current)try{const w=new Date().toLocaleTimeString("zh-TW",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3}),C={id:Date.now()+Math.random(),timestamp:w,level:f,message:c,data:m?JSON.stringify(m,null,2):null};r(T=>[...T,C].slice(-Ge))}catch(w){o.current&&o.current("Logger error:",w)}},[]);u.useEffect(()=>{a.current=h},[h]),u.useEffect(()=>{const f=setTimeout(()=>{l.current&&(i.current||(i.current=console.log.bind(console),o.current=console.error.bind(console),d.current=console.warn.bind(console)),console.log=(...c)=>{try{if(i.current(...c),!l.current||!a.current)return;const m=c.find(T=>typeof T=="string")||"",w=c.find(T=>typeof T=="object"&&T!==null&&!Array.isArray(T))||null;["[useEnvironment]","[useQuickLogin]","[TronWalletLogin]","[QuickLogin]","[Flutter Bridge]"].some(T=>m.includes(T))&&setTimeout(()=>{a.current&&a.current("log",m,w)},0)}catch{i.current&&i.current(...c)}},console.error=(...c)=>{var m;try{if(o.current(...c),!l.current||!a.current)return;const w=c.find(T=>typeof T=="string")||((m=c[0])==null?void 0:m.toString())||"Error",C=c.find(T=>typeof T=="object"&&T!==null&&!Array.isArray(T))||null;setTimeout(()=>{a.current&&a.current("error",w,C)},0)}catch{o.current&&o.current(...c)}},console.warn=(...c)=>{var m;try{if(d.current(...c),!l.current||!a.current)return;const w=c.find(T=>typeof T=="string")||((m=c[0])==null?void 0:m.toString())||"Warning",C=c.find(T=>typeof T=="object"&&T!==null&&!Array.isArray(T))||null;setTimeout(()=>{a.current&&a.current("warn",w,C)},0)}catch{d.current&&d.current(...c)}})},100);return()=>{clearTimeout(f),i.current&&(console.log=i.current,console.error=o.current,console.warn=d.current)}},[]);const j=u.useCallback(()=>{r([])},[]),x=u.useCallback(()=>{const f=t.map(c=>{const m=c.data?`
${c.data}`:"";return`[${c.timestamp}] [${c.level.toUpperCase()}] ${c.message}${m}`}).join(`

`);navigator.clipboard.writeText(f).then(()=>{h("info","æ—¥èªŒå·²è¤‡è£½åˆ°å‰ªè²¼æ¿")}).catch(c=>{h("error","è¤‡è£½æ—¥èªŒå¤±æ•—: "+c.message)})},[t,h]),g=u.useCallback(()=>{const f=t.map(C=>{const T=C.data?`
${C.data}`:"";return`[${C.timestamp}] [${C.level.toUpperCase()}] ${C.message}${T}`}).join(`

`),c=new Blob([f],{type:"text/plain"}),m=URL.createObjectURL(c),w=document.createElement("a");w.href=m,w.download=`tronwallet-logs-${new Date().toISOString().replace(/[:.]/g,"-")}.txt`,document.body.appendChild(w),w.click(),document.body.removeChild(w),URL.revokeObjectURL(m),h("info","æ—¥èªŒå·²å°Žå‡º")},[t,h]);return{logs:t,isEnabled:n,setIsEnabled:s,clearLogs:j,copyLogs:x,exportLogs:g,addLog:h}},ge=u.createContext(null),Ze=({children:t})=>{const r=Xe();return e.jsx(ge.Provider,{value:r,children:t})},Ye=()=>u.useContext(ge),ie=()=>{const t=Ye();if(!t)return null;const{logs:r,isEnabled:n,setIsEnabled:s,clearLogs:i,copyLogs:o,exportLogs:d}=t,[l,a]=u.useState(!1),[h,j]=u.useState(!0),x=u.useRef(null),g=c=>{switch(c){case"error":return"log-entry-error";case"warn":return"log-entry-warn";case"info":return"log-entry-info";default:return"log-entry-log"}},f=()=>{x.current&&h&&(x.current.scrollTop=x.current.scrollHeight)};return u.useEffect(()=>{l&&h&&setTimeout(f,100)},[r,l,h]),n?e.jsxs("div",{className:`logger-panel ${l?"expanded":"collapsed"}`,children:[e.jsxs("div",{className:"logger-header",children:[e.jsxs("div",{className:"logger-header-left",children:[e.jsx("button",{className:"logger-toggle-btn",onClick:()=>a(!l),title:l?"æ”¶èµ·æ—¥èªŒ":"å±•é–‹æ—¥èªŒ",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:l?e.jsx("path",{d:"M18 15l-6-6-6 6"}):e.jsx("path",{d:"M6 9l6 6 6-6"})})}),e.jsxs("span",{className:"logger-title",children:["èª¿è©¦æ—¥èªŒ (",r.length,")"]})]}),l&&e.jsxs("div",{className:"logger-actions",children:[e.jsxs("label",{className:"logger-checkbox",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:c=>j(c.target.checked)}),e.jsx("span",{children:"è‡ªå‹•æ»¾å‹•"})]}),e.jsx("button",{className:"logger-action-btn",onClick:i,title:"æ¸…é™¤æ—¥èªŒ",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})}),e.jsx("button",{className:"logger-action-btn",onClick:o,title:"è¤‡è£½æ—¥èªŒ",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),e.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]})}),e.jsx("button",{className:"logger-action-btn",onClick:d,title:"å°Žå‡ºæ—¥èªŒ",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"7 10 12 15 17 10"}),e.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]})}),e.jsx("button",{className:"logger-action-btn",onClick:()=>s(!1),title:"é—œé–‰æ—¥èªŒ",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]})]}),l&&e.jsx("div",{className:"logger-content",ref:x,children:r.length===0?e.jsxs("div",{className:"logger-empty",children:[e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",opacity:"0.3",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e.jsx("polyline",{points:"10 9 9 9 8 9"})]}),e.jsx("p",{children:"æš«ç„¡æ—¥èªŒ"})]}):e.jsx("div",{className:"logger-entries",children:r.map(c=>e.jsxs("div",{className:`log-entry ${g(c.level)}`,children:[e.jsxs("div",{className:"log-entry-header",children:[e.jsx("span",{className:"log-timestamp",children:c.timestamp}),e.jsx("span",{className:`log-level log-level-${c.level}`,children:c.level.toUpperCase()})]}),e.jsx("div",{className:"log-message",children:c.message}),c.data&&e.jsxs("details",{className:"log-data",children:[e.jsx("summary",{children:"æŸ¥çœ‹æ•¸æ“š"}),e.jsx("pre",{children:c.data})]})]},c.id))})})]}):e.jsx("button",{className:"logger-toggle-btn",onClick:()=>s(!0),title:"å•Ÿç”¨æ—¥èªŒ",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e.jsx("polyline",{points:"10 9 9 9 8 9"})]})})},re=t=>{const r=(t==null?void 0:t.message)||(t==null?void 0:t.toString())||"";return r.includes("å–æ¶ˆ")||r.includes("rejected")||r.includes("cancel")||r.includes("denied")||r.includes("æ‹’çµ•")},et=()=>{var te;const{t,language:r}=$(),{address:n,connected:s,wallet:i,select:o,connect:d}=V(),{setVisible:l,visible:a}=Te(),{triggerDeepLink:h,checkAppInstalled:j}=Se(),x=J(),{error:g,setError:f,handleJWTRequest:c}=Be(),[m,w]=u.useState(null),{availableWallets:C,handleQuickConnect:T,connecting:y,currentWallet:N}=$e(),{isPC:W,isMobile:k,hasExtension:b,detectedWallets:L,platform:R,browser:q,isPWA:M}=x,Q=(W||M&&!k)&&b,he=k||!b,K=u.useRef(s),G=u.useRef(n),F=u.useRef(!1),X=u.useRef(C.length),Z=u.useRef(s);u.useEffect(()=>{var p;(C.length!==X.current||s!==Z.current)&&(console.log("[TronWalletLogin] çµ„ä»¶ç‹€æ…‹æ›´æ–°:",{isPWA:M,isPC:W,isMobile:k,platform:R,availableWalletsCount:C.length,availableWallets:C.map(v=>({name:v.adapter.name,detectedName:v.detectedName,readyState:v.adapter.readyState})),detectedWallets:L.map(v=>v.name),hasExtension:b,showExtensionOption:Q,connecting:y,connected:s,currentWallet:(p=N==null?void 0:N.adapter)==null?void 0:p.name,address:n}),X.current=C.length,Z.current=s)},[C.length,L.length,b,y,s,(te=N==null?void 0:N.adapter)==null?void 0:te.name,n,M,W,k,R,Q]);const me=()=>{const v=`login_${Date.now()}`,E=encodeURIComponent(window.location.origin+_.CALLBACK_PATH);return{deepLinkUrl:`${_.TRONWALLET_SCHEME}login?callback=${E}&requestId=${v}`,requestId:v,callbackUrl:E}},pe=async()=>{f("");try{const{deepLinkUrl:p}=me();if(k&&!await j(_.TRONWALLET_SCHEME)){window.confirm(t("errors.appNotInstalled"))&&window.open(_.TRONWALLET_UNIVERSAL_LINK,"_blank");return}await h(p)||f(t("errors.cannotOpenApp"))}catch(p){console.error("APP ç™»å…¥éŒ¯èª¤:",p),f(t("errors.loginFailed"))}};u.useEffect(()=>{const p=new URLSearchParams(window.location.search),v=p.get("address"),E=p.get("requestId");v&&E&&(window.history.replaceState({},document.title,window.location.pathname),console.log("æ”¶åˆ° Deep Link å›žèª¿:",{address:v,requestId:E}))},[]);const Y=u.useRef(!1),O=u.useRef(!1);u.useEffect(()=>{var E;const p=Y.current,v=a||!1;if(p&&!v&&i&&!s&&!y){const A=(E=i==null?void 0:i.adapter)==null?void 0:E.name;A&&(console.log("[TronWalletLogin] æª¢æ¸¬åˆ°ç”¨æˆ¶åœ¨å½ˆçª—ä¸­é¸æ“‡äº†éŒ¢åŒ…ï¼Œè‡ªå‹•é€£æŽ¥:",{walletName:A}),O.current=!0,d().catch(S=>{console.error("[TronWalletLogin] å½ˆçª—é¸æ“‡å¾Œè‡ªå‹•é€£æŽ¥å¤±æ•—:",S),f(t("errors.connectionFailed",{error:S.message||S.toString()})),O.current=!1}))}v&&!p&&(O.current=!1),s&&O.current&&(O.current=!1),Y.current=v},[a,i,s,y,d,f,t]),u.useEffect(()=>{var A;const p=K.current,v=G.current;(s!==p||n!==v)&&(console.log("[TronWalletLogin] é€£æŽ¥ç‹€æ…‹è®ŠåŒ–:",{wasConnected:p,connected:s,prevAddress:v,address:n,wallet:(A=i==null?void 0:i.adapter)==null?void 0:A.name,connecting:y}),s&&n?(console.log("[TronWalletLogin] è§¸ç™¼é€£æŽ¥æµç¨‹"),f(""),w("pending"),I(P.WALLET_CONNECTED,{address:n,timestamp:Date.now()}),c(n).then(()=>{w("success")}).catch(S=>{re(S)?w("pending"):w("failed")})):!s&&p&&(console.log("[TronWalletLogin] è§¸ç™¼æ–·é–‹æµç¨‹"),w(null),I(P.WALLET_DISCONNECTED,{timestamp:Date.now()})),K.current=s,G.current=n)},[s,n]),u.useEffect(()=>{const p=()=>{const S=document.querySelectorAll(".official-wallet-button button");if(S.length===0)return;const fe=document.documentElement.getAttribute("data-theme")==="dark"?"#4b5563":"#e5e7eb";S.forEach(B=>{B instanceof HTMLElement&&(B.style.setProperty("background","transparent","important"),B.style.setProperty("border",`2px solid ${fe}`,"important"),B.style.setProperty("background-image","none","important"))})},v=setTimeout(()=>{requestAnimationFrame(p)},100),E=new MutationObserver(()=>{requestAnimationFrame(p)}),A=document.querySelector(".tronwallet-login");return A&&E.observe(A,{childList:!0,subtree:!0}),()=>{clearTimeout(v),E.disconnect()}},[C.length]),u.useEffect(()=>{const p=ze(r);return()=>{p&&p.disconnect&&p.disconnect()}},[r]),u.useEffect(()=>(F.current||(ne(),F.current=!0),Me(v=>{switch(v.type){case P.INIT:F.current||(ne(),F.current=!0);break;case P.CLOSE:console.log("Flutter è«‹æ±‚é—œé–‰ç™»å…¥æ¨¡å¡Š");break}})),[]);const U=u.useMemo(()=>document.referrer&&document.referrer!==window.location.href?!0:window.history.length>1,[]),ee=()=>{U&&window.history.back()};return s&&n?e.jsxs(e.Fragment,{children:[U()&&e.jsxs("button",{className:"back-button",onClick:ee,title:t("common.back"),children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7"})}),e.jsx("span",{children:t("common.back")})]}),e.jsx(se,{}),e.jsx(He,{address:n,signingStatus:m}),e.jsx(ie,{})]}):e.jsxs("div",{className:"tronwallet-login",children:[U&&e.jsxs("button",{className:"back-button",onClick:ee,title:t("common.back"),children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7"})}),e.jsx("span",{children:t("common.back")})]}),e.jsx(se,{}),e.jsx("div",{className:"login-icon",children:e.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]})}),e.jsx("h2",{className:"login-title",children:t("login.title")}),e.jsx("div",{className:"environment-info",children:e.jsxs("div",{className:"env-badge",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),e.jsx("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),e.jsx("line",{x1:"12",y1:"17",x2:"12",y2:"21"})]}),e.jsx("span",{className:"env-platform",children:R}),q&&q!=="Unknown"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"env-separator",children:"Â·"}),e.jsx("span",{className:"env-browser",children:q})]}),M&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"env-separator",children:"Â·"}),e.jsx("span",{className:"env-pwa-badge",children:"PWA"})]})]})}),e.jsx("p",{className:"login-description",children:C.length>0?t("login.description.detected",{wallets:L.map(p=>p.name).join("ã€")}):t(W||M&&!k?"login.description.pc":"login.description.mobile")}),g&&e.jsxs("div",{className:"error-message",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),g]}),s&&n&&m==="pending"&&e.jsx("div",{className:"signing-prompt",children:e.jsxs("div",{className:"signing-prompt-content",children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"})}),e.jsxs("div",{className:"signing-prompt-text",children:[e.jsx("p",{className:"signing-prompt-title",children:t("signing.pendingTitle","è«‹å®Œæˆç°½åä»¥å®Œæˆç™»å…¥")}),e.jsx("p",{className:"signing-prompt-desc",children:t("signing.pendingDesc","éŒ¢åŒ…å·²é€£æŽ¥ï¼Œè«‹åœ¨éŒ¢åŒ…ä¸­ç¢ºèªç°½åè«‹æ±‚")})]}),e.jsx("button",{className:"signing-prompt-btn",onClick:async()=>{w("pending"),f("");try{await c(n),w("success")}catch(p){re(p)?w("pending"):w("failed")}},children:t("signing.retry","é‡æ–°ç°½å")})]})}),C.length>0&&e.jsx(Ke,{availableWallets:C,onWalletClick:async p=>{console.log("[TronWalletLogin] å¿«æ·ç™»å…¥æŒ‰éˆ•è¢«é»žæ“Š:",{walletName:p.adapter.name,detectedName:p.detectedName});try{f(""),await T(p),console.log("[TronWalletLogin] å¿«æ·ç™»å…¥æˆåŠŸ")}catch(v){console.error("[TronWalletLogin] å¿«æ·ç™»å…¥å¤±æ•—:",v),f(t("errors.connectionFailed",{error:v.message||v.toString()}))}},connecting:y,connectedWallet:N}),e.jsxs("div",{className:"login-methods",children:[C.length>0&&e.jsx("div",{className:"method-divider",children:e.jsx("span",{children:t("login.or")})}),e.jsx("div",{className:"official-wallet-button","data-button-text":t("login.selectWallet"),style:{"--button-text":`"${t("login.selectWallet")}"`},children:e.jsx("button",{className:"select-wallet-custom-btn",onClick:p=>{p.preventDefault(),p.stopPropagation(),console.log("[TronWalletLogin] æ‰“é–‹å®˜æ–¹éŒ¢åŒ…é¸æ“‡å½ˆçª—"),l(!0)},children:t("login.selectWallet")})}),Q&&he&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"method-divider",children:e.jsx("span",{children:t("login.or")})}),e.jsxs("button",{className:"login-method-btn",onClick:pe,disabled:y,children:[e.jsx("div",{className:"method-icon",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"5",y:"2",width:"14",height:"20",rx:"2",ry:"2"}),e.jsx("line",{x1:"12",y1:"18",x2:"12.01",y2:"18"})]})}),e.jsxs("div",{className:"method-content",children:[e.jsx("h3",{children:t("login.useMobileApp")}),e.jsx("p",{children:t("login.mobileAppDesc")})]})]})]})]}),e.jsxs("div",{className:"login-tips",children:[e.jsx("p",{children:t("tips.title")}),e.jsx("ul",{children:W?b?t("tips.pcWithExtension",{wallets:L.map(p=>p.name).join("ã€")}).map((p,v)=>e.jsx("li",{children:p},v)):t("tips.pcWithoutExtension").map((p,v)=>e.jsx("li",{children:p},v)):t("tips.mobile").map((p,v)=>e.jsx("li",{children:p},v))})]}),e.jsx(ie,{})]})},tt=()=>[new ve,new ke,new je,new Le],nt=()=>[new be,new ye],ot=()=>[new Ne],st=()=>{const t=z.METADATA;return new Ee({network:z.NETWORK,options:{projectId:z.PROJECT_ID,metadata:t}})},it=()=>{const t=[...tt(),...nt(),...ot()],r=st();return r&&t.push(r),t};function rt(){return e.jsx("div",{className:"app",children:e.jsx("div",{className:"app-container",children:e.jsx(et,{})})})}function at(){const t=u.useMemo(()=>it(),[]),r=n=>{console.error("éŒ¢åŒ…éŒ¯èª¤:",n)};return e.jsx(Je,{children:e.jsx(Fe,{children:e.jsx(Ze,{children:e.jsx(We,{adapters:t,onError:r,autoConnect:!1,children:e.jsx(Ae,{children:e.jsx(rt,{})})})})})})}console.log("[Main] Before importing polyfills...");console.log("[Main] After importing polyfills, checking Buffer:",typeof window<"u"?typeof window.Buffer:"window undefined");console.log("[Main] App imports complete, Buffer check:",typeof window<"u"?typeof window.Buffer:"window undefined");we.createRoot(document.getElementById("root")).render(e.jsx(xe.StrictMode,{children:e.jsx(at,{})}));
