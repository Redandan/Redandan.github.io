import{r as g,j as e,c as ye,R as ke}from"./react-vendor.Bj0G0Oyz.js";import"./polyfills.DCfrOiPO.js";import{ab as K,ac as Ce,ad as be,ae as je,af as Le,ag as Ne,ah as Ee,ai as We,aj as Se,ak as Ae,al as Re,am as Pe,an as Me}from"./wallet-vendor.CHv2NQr2.js";import"./buffer-polyfill.ErO7y5re.js";const Oe=()=>{const[t,i]=g.useState(!0),o=async a=>{try{const n=`${a}test`;return new Promise(d=>{const l=document.createElement("iframe");l.style.display="none",l.src=n;let r=!1;const p=setTimeout(()=>{r||(r=!0,document.body.removeChild(l),d(!1))},1e3);l.onload=()=>{r||(r=!0,clearTimeout(p),document.body.removeChild(l),d(!0))},l.onerror=()=>{r||(r=!0,clearTimeout(p),document.body.removeChild(l),d(!1))},document.body.appendChild(l)})}catch(n){return console.error("æª¢æŸ¥ APP å®‰è£ç‹€æ…‹å¤±æ•—:",n),!1}},s=async a=>{try{const n=document.createElement("a");return n.href=a,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),await new Promise(d=>setTimeout(d,300)),!0}catch(n){return console.error("è§¸ç™¼ Deep Link å¤±æ•—:",n),!1}};return g.useEffect(()=>{const a=n=>{n.origin===window.location.origin&&n.data&&n.data.type==="TRONWALLET_CALLBACK"&&console.log("æ”¶åˆ° TronWallet å›èª¿:",n.data)};return window.addEventListener("message",a),()=>{window.removeEventListener("message",a)}},[]),{isSupported:t,checkAppInstalled:o,triggerDeepLink:s}},ue=()=>{const[t,i]=g.useState({isPC:!1,isMobile:!1,isIOS:!1,isAndroid:!1,isTablet:!1,hasExtension:!1,detectedWallets:[],isPWA:!1,isStandalone:!1,platform:"",browser:""});return g.useEffect(()=>{const o=()=>{const r=navigator.userAgent||navigator.vendor||window.opera,p=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(r),v=/iPad|iPhone|iPod/.test(r)&&!window.MSStream,h=/Android/.test(r),y=/iPad/.test(r)||h&&!/Mobile/.test(r),w=!p,u=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://"),m=u||window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches;let x="Unknown";r.indexOf("Chrome")>-1&&r.indexOf("Edg")===-1?x="Chrome":r.indexOf("Safari")>-1&&r.indexOf("Chrome")===-1?x="Safari":r.indexOf("Firefox")>-1?x="Firefox":r.indexOf("Edg")>-1?x="Edge":(r.indexOf("Opera")>-1||r.indexOf("OPR")>-1)&&(x="Opera");let k="Web";m?v?k="iOS PWA":h?k="Android PWA":k="PWA":w?k="Web PC":v?k="iOS Web":h&&(k="Android Web");const T=[],L=w||m&&!p;L&&((window.tronWeb||window.tronLink||window.tron&&window.tron.tronWeb)&&T.push({name:"TronLink",type:"extension",installed:!0}),window.tokenpocket&&T.push({name:"TokenPocket",type:"extension",installed:!0}),window.bitkeep&&(window.bitkeep.tronLink||window.bitkeep.tron)&&T.push({name:"BitKeep",type:"extension",installed:!0}),window.okxwallet&&T.push({name:"OKX Wallet",type:"extension",installed:!0}));const N=T.length>0;m&&console.log("[useEnvironment] PWAæ¨¡å¼æª¢æ¸¬çµæœ:",{isPWA:m,isPC:w,isMobile:p,platform:k,shouldDetectExtensions:L,detectedWallets:T.map(b=>b.name),hasExtension:N,windowTronWeb:!!window.tronWeb,windowTronLink:!!window.tronLink,windowTron:!!window.tron,windowTokenPocket:!!window.tokenpocket,windowBitKeep:!!window.bitkeep,windowOkxWallet:!!window.okxwallet}),i({isPC:w,isMobile:p,isIOS:v,isAndroid:h,isTablet:y,hasExtension:N,detectedWallets:T,isPWA:m,isStandalone:u,platform:k,browser:x})};o();let s=0;const a=10;let n=setInterval(()=>{o(),s++,s>=a&&(clearInterval(n),n=setInterval(o,3e3))},1e3),d;const l=()=>{clearTimeout(d),d=setTimeout(o,300)};return window.addEventListener("resize",l),()=>{n&&clearInterval(n),d&&clearTimeout(d),window.removeEventListener("resize",l)}},[]),t},ge={apiBaseUrl:"https://agoramarketapi.purrtechllc.com/api"};async function De(t){const i=await fetch(`${ge.apiBaseUrl}/auth/wallet-connect/nonce`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({walletAddress:t})});if(!i.ok)throw new Error("ç²å– nonce å¤±æ•—: "+i.statusText);const o=await i.json();if(o.message&&(!o.nonce||o.nonce==="")&&o.message.includes("Nonce:")){const s=o.message.match(/Nonce:\s*([^\n]+)/);s&&s[1]&&(o.nonce=s[1].trim())}if(o.message&&!o.timestamp&&o.message.includes("Timestamp:")){const s=o.message.match(/Timestamp:\s*([^\n]+)/);if(s&&s[1]){const a=parseInt(s[1].trim());isNaN(a)||(o.timestamp=a)}}if(!o.message||o.message==="")throw new Error("ç²å– nonce å¤±æ•—ï¼šç¼ºå°‘ message å­—æ®µ");if(!o.nonce||o.nonce==="")throw new Error("ç²å– nonce å¤±æ•—ï¼šç¼ºå°‘ nonce å­—æ®µ");return o.timestamp||(o.timestamp=Math.floor(Date.now()/1e3)),o}async function Ie(t,i,o,s="tron"){const a={walletAddress:t,signature:i,nonce:o.nonce,timestamp:o.timestamp};s==="tron"&&(a.chain="TRC20",a.chainType="tron");const n=await fetch(`${ge.apiBaseUrl}/auth/wallet-connect/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!n.ok){const l=await n.json().catch(()=>({message:n.statusText}));throw new Error(l.message||"ç™»éŒ„å¤±æ•—: "+n.statusText)}const d=await n.json();if(!d.token||!d.refreshToken)throw new Error(d.message||"ç™»éŒ„éŸ¿æ‡‰ä¸­ç¼ºå°‘ token");return d}const O={WALLET_CONNECTED:"WALLET_CONNECTED",WALLET_DISCONNECTED:"WALLET_DISCONNECTED",WALLET_ADDRESS:"WALLET_ADDRESS",JWT_REQUEST:"JWT_REQUEST",JWT_RECEIVED:"JWT_RECEIVED",JWT_ERROR:"JWT_ERROR",READY:"READY",ERROR:"ERROR",INIT:"INIT",CLOSE:"CLOSE"},_=(t,i={})=>{const o={source:"tron-wallet-login-module",type:t,data:i,timestamp:Date.now()};window.parent&&window.parent!==window&&window.parent.postMessage(o,"*"),window.flutter_inappwebview&&window.flutter_inappwebview.callHandler("onMessage",o),window.onTronWalletLoginMessage&&window.onTronWalletLoginMessage(o)},Fe=t=>{const i=o=>{o.data&&o.data.source==="flutter-app"&&t(o.data)};return window.addEventListener("message",i),window.flutter_inappwebview&&window.flutter_inappwebview.addEventListener("message",i),()=>{window.removeEventListener("message",i),window.flutter_inappwebview&&window.flutter_inappwebview.removeEventListener("message",i)}},ie=()=>{_(O.READY,{version:"1.0.0",timestamp:Date.now()})},Be=t=>{_(O.ERROR,{error:t.message||t,stack:t.stack})},_e={common:{connect:"é€£æ¥",disconnect:"æ–·é–‹é€£æ¥",cancel:"å–æ¶ˆ",confirm:"ç¢ºèª",loading:"è¼‰å…¥ä¸­",error:"éŒ¯èª¤",success:"æˆåŠŸ",retry:"é‡è©¦",back:"è¿”å›"},login:{title:"é€£æ¥éŒ¢åŒ…",description:{pc:"è«‹é¸æ“‡éŒ¢åŒ…é€£æ¥æ–¹å¼",mobile:"è«‹é¸æ“‡éŒ¢åŒ…é€²è¡Œé€£æ¥",detected:"æª¢æ¸¬åˆ° {wallets}ï¼Œè«‹é¸æ“‡ç™»å…¥æ–¹å¼"},selectWallet:"é¸æ“‡éŒ¢åŒ…",quickLogin:"å¿«æ·ç™»å…¥",useMobileApp:"ä½¿ç”¨æ‰‹æ©Ÿ APP",mobileAppDesc:"é€šé Deep Link æ‰“é–‹ TronLink APP",or:"æˆ–"},wallet:{connected:"å·²é€£æ¥éŒ¢åŒ…",connectedWaitingSignature:"å·²é€£æ¥éŒ¢åŒ…(ç­‰å¾…ç°½å)",connectedSignatureSuccess:"å·²é€£æ¥éŒ¢åŒ…(ç°½åæˆåŠŸ)",redirectingToLogin:"è·³è½‰ç™»å…¥...",disconnected:"éŒ¢åŒ…å·²æ–·é–‹",connecting:"é€£æ¥ä¸­",address:"éŒ¢åŒ…åœ°å€ï¼š",connectingTo:"æ­£åœ¨é€£æ¥åˆ° {wallet}...",unknown:"æœªçŸ¥éŒ¢åŒ…"},errors:{loginFailed:"ç™»å…¥å¤±æ•—ï¼Œè«‹é‡è©¦",cannotOpenApp:"ç„¡æ³•æ‰“é–‹ TronLink APPï¼Œè«‹ç¢ºèªå·²å®‰è£ä¸¦é‡è©¦",appNotInstalled:`æœªæª¢æ¸¬åˆ° TronLink APPï¼Œæ˜¯å¦å‰å¾€ä¸‹è¼‰ï¼Ÿ

å¦‚æœå·²å®‰è£ï¼Œè«‹é»æ“Šå–æ¶ˆå¾Œé‡è©¦ã€‚`,signatureCanceled:"ç°½åå·²å–æ¶ˆã€‚è«‹åœ¨éŒ¢åŒ…ä¸­ç¢ºèªç°½åä»¥ç¹¼çºŒç™»å…¥ã€‚",signatureFailed:"ç°½åå¤±æ•—ï¼Œè«‹é‡è©¦",jwtFailed:"JWT èªè­‰å¤±æ•—: {error}",connectionFailed:"é€£æ¥å¤±æ•—: {error}",walletNotSupported:"{wallet} ä¸æ”¯æŒç°½ååŠŸèƒ½ã€‚è«‹ä½¿ç”¨æ”¯æŒç°½åçš„éŒ¢åŒ…ï¼ˆå¦‚ TronLinkã€Ledger ç­‰ï¼‰ã€‚",ledgerTimeout:"Ledger ç°½åè¶…æ™‚ã€‚è«‹ç¢ºä¿è¨­å‚™å·²é€£æ¥ä¸¦è§£é–ï¼Œç„¶å¾Œé‡è©¦ã€‚",ledgerNotConnected:"Ledger è¨­å‚™æœªé€£æ¥ã€‚è«‹é€£æ¥è¨­å‚™å¾Œé‡è©¦ã€‚",ledgerConfirm:"è«‹åœ¨ Ledger è¨­å‚™ä¸Šç¢ºèªç°½å...",nonceFailed:"ç²å– nonce å¤±æ•—: {error}",verifyFailed:"ç™»éŒ„å¤±æ•—: {error}",unknownError:"æœªçŸ¥éŒ¯èª¤"},tips:{title:"ğŸ’¡ æç¤ºï¼š",pcWithExtension:["æª¢æ¸¬åˆ° {wallets} æ“´å±•","é»æ“Šä¸Šæ–¹æŒ‰éˆ•é¸æ“‡éŒ¢åŒ…é€²è¡Œé€£æ¥","æ”¯æŒå¤šç¨®éŒ¢åŒ…ï¼šç€è¦½å™¨æ“´å±•ã€ç§»å‹•ç«¯éŒ¢åŒ…ã€ç¡¬ä»¶éŒ¢åŒ…","é¦–æ¬¡ä½¿ç”¨éœ€è¦åœ¨éŒ¢åŒ…ä¸­æˆæ¬Š"],pcWithoutExtension:["æ¨è–¦å®‰è£ TronLinkã€TokenPocket ç­‰ç€è¦½å™¨æ“´å±•","æˆ–ä½¿ç”¨ WalletConnect é€£æ¥ç§»å‹•ç«¯éŒ¢åŒ…","æ”¯æŒ Ledger ç¡¬ä»¶éŒ¢åŒ…","é»æ“Šä¸Šæ–¹æŒ‰éˆ•æŸ¥çœ‹æ‰€æœ‰å¯ç”¨é¸é …"],mobile:["ç§»å‹•ç«¯æ¨è–¦ä½¿ç”¨ WalletConnect é€£æ¥éŒ¢åŒ…","æˆ–é€šé Deep Link æ‰“é–‹ TronLink APP","æ”¯æŒ Trust Walletã€ImToken ç­‰ç§»å‹•ç«¯éŒ¢åŒ…","é»æ“Šä¸Šæ–¹æŒ‰éˆ•æŸ¥çœ‹æ‰€æœ‰å¯ç”¨é¸é …"]},modal:{connectWalletTitle:"é€£æ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ",detected:"å·²æª¢æ¸¬",notFound:"æœªæ‰¾åˆ°",installed:"å·²å®‰è£",notInstalled:"æœªå®‰è£",loading:"è¼‰å…¥ä¸­",connecting:"é€£æ¥ä¸­",connected:"å·²é€£æ¥",disconnect:"æ–·é–‹é€£æ¥"},environment:{webPC:"Web PC",webMobile:"Web ç§»å‹•ç«¯",iosWeb:"iOS Web",androidWeb:"Android Web",iosPWA:"iOS PWA",androidPWA:"Android PWA",pwa:"PWA"},process:{gettingNonce:"ğŸ“¨ æ­£åœ¨ç²å– nonce...",nonceSuccess:"âœ… Nonce ç²å–æˆåŠŸ",signing:"âœï¸ æ­£åœ¨ç°½åæ¶ˆæ¯...",signatureSuccess:"âœ… ç°½åæˆåŠŸ",verifying:"ğŸ” æ­£åœ¨é©—è­‰ç°½åä¸¦ç™»å…¥...",loginSuccess:"âœ… ç™»å…¥æˆåŠŸï¼Œå·²ç²å– Token",jwtSent:"âœ… JWT Token å·²ç™¼é€çµ¦ Flutter",ledgerDetected:"ğŸ” æª¢æ¸¬åˆ° Ledger ç¡¬ä»¶éŒ¢åŒ…ï¼Œè«‹åœ¨è¨­å‚™ä¸Šç¢ºèªç°½å..."},signing:{pendingTitle:"è«‹å®Œæˆç°½åä»¥å®Œæˆç™»å…¥",pendingDesc:"éŒ¢åŒ…å·²é€£æ¥ï¼Œè«‹åœ¨éŒ¢åŒ…ä¸­ç¢ºèªç°½åè«‹æ±‚",retry:"é‡æ–°ç°½å"}},$e={common:{connect:"Connect",disconnect:"Disconnect",cancel:"Cancel",confirm:"Confirm",loading:"Loading",error:"Error",success:"Success",retry:"Retry",back:"Back"},login:{title:"Connect Wallet",description:{pc:"Please select wallet connection method",mobile:"Please select a wallet to connect",detected:"Detected {wallets}, please select login method"},selectWallet:"Select Wallet",quickLogin:"Quick Login",useMobileApp:"Use Mobile APP",mobileAppDesc:"Open TronLink APP via Deep Link",or:"or"},wallet:{connected:"Wallet Connected",connectedWaitingSignature:"Wallet Connected (Waiting for Signature)",connectedSignatureSuccess:"Wallet Connected (Signature Success)",redirectingToLogin:"Redirecting to Login...",disconnected:"Wallet Disconnected",connecting:"Connecting",address:"Wallet Address:",connectingTo:"Connecting to {wallet}...",unknown:"Unknown Wallet"},errors:{loginFailed:"Login failed, please try again",cannotOpenApp:"Cannot open TronLink APP, please confirm it is installed and try again",appNotInstalled:`TronLink APP not detected, go to download?

If already installed, please click cancel and try again.`,signatureCanceled:"Signature canceled. Please confirm the signature in the wallet to continue login.",signatureFailed:"Signature failed, please try again",jwtFailed:"JWT authentication failed: {error}",connectionFailed:"Connection failed: {error}",walletNotSupported:"{wallet} does not support signature function. Please use a wallet that supports signatures (such as TronLink, Ledger, etc.).",ledgerTimeout:"Ledger signature timeout. Please ensure the device is connected and unlocked, then try again.",ledgerNotConnected:"Ledger device not connected. Please connect the device and try again.",ledgerConfirm:"Please confirm signature on Ledger device...",nonceFailed:"Failed to get nonce: {error}",verifyFailed:"Login failed: {error}",unknownError:"Unknown error"},tips:{title:"ğŸ’¡ Tips:",pcWithExtension:["Detected {wallets} extension","Click the button above to select wallet for connection","Supports multiple wallets: browser extensions, mobile wallets, hardware wallets","First-time use requires authorization in the wallet"],pcWithoutExtension:["Recommended to install TronLink, TokenPocket and other browser extensions","Or use WalletConnect to connect mobile wallets","Supports Ledger hardware wallet","Click the button above to view all available options"],mobile:["Mobile devices recommend using WalletConnect to connect wallets","Or open TronLink APP via Deep Link","Supports Trust Wallet, ImToken and other mobile wallets","Click the button above to view all available options"]},modal:{connectWalletTitle:"Connect a wallet on Tron to continue",detected:"Detected",notFound:"NotFound",installed:"Installed",notInstalled:"NotInstalled",loading:"Loading",connecting:"Connecting",connected:"Connected",disconnect:"Disconnect"},environment:{webPC:"Web PC",webMobile:"Web Mobile",iosWeb:"iOS Web",androidWeb:"Android Web",iosPWA:"iOS PWA",androidPWA:"Android PWA",pwa:"PWA"},process:{gettingNonce:"ğŸ“¨ Getting nonce...",nonceSuccess:"âœ… Nonce obtained successfully",signing:"âœï¸ Signing message...",signatureSuccess:"âœ… Signature successful",verifying:"ğŸ” Verifying signature and logging in...",loginSuccess:"âœ… Login successful, Token obtained",jwtSent:"âœ… JWT Token sent to Flutter",ledgerDetected:"ğŸ” Ledger hardware wallet detected, please confirm signature on device..."},signing:{pendingTitle:"Please complete signature to finish login",pendingDesc:"Wallet connected, please confirm signature request in wallet",retry:"Retry Signature"}},he=g.createContext(),U=()=>{const t=g.useContext(he);if(!t)throw new Error("useLanguage must be used within LanguageProvider");return t},qe=({children:t})=>{const i=()=>{try{return localStorage.getItem("wallet-login-language")==="en"?"en":"zh"}catch{return"zh"}},[o,s]=g.useState(i),a={zh:_e,en:$e},n=(v,h={})=>{const y=v.split(".");let w=a[o];for(const u of y)if(w&&typeof w=="object")w=w[u];else return v;return typeof w=="string"&&Object.keys(h).length>0?w.replace(/\{(\w+)\}/g,(u,m)=>h[m]!==void 0?h[m]:u):Array.isArray(w)&&Object.keys(h).length>0?w.map(u=>typeof u=="string"?u.replace(/\{(\w+)\}/g,(m,x)=>h[x]!==void 0?h[x]:m):u):w||v},d=v=>{(v==="zh"||v==="en")&&(s(v),localStorage.setItem("wallet-login-language",v),window.dispatchEvent(new Event("languageChanged")))},l=()=>o,r=()=>o==="zh",p=()=>o==="en";return e.jsx(he.Provider,{value:{language:o,t:n,changeLanguage:d,getLanguage:l,isZh:r,isEn:p},children:t})},Qe=()=>{const[t,i]=g.useState(""),{signMessage:o,wallet:s}=K(),{t:a}=U(),n=g.useCallback(async d=>{var l,r;try{i(""),console.log(a("process.gettingNonce"));const p=await De(d);if(console.log(a("process.nonceSuccess"),p.nonce),!o){const h=((l=s==null?void 0:s.adapter)==null?void 0:l.name)||a("wallet.unknown");throw new Error(a("errors.walletNotSupported",{wallet:h}))}const v=((r=s==null?void 0:s.adapter)==null?void 0:r.name)==="Ledger";v?(console.log(a("process.ledgerDetected")),i(a("errors.ledgerConfirm"))):console.log(a("process.signing"));try{const h=await o(p.message);console.log(a("process.signatureSuccess")),v&&i(""),console.log(a("process.verifying"));const y=await Ie(d,h,p,"tron");console.log(a("process.loginSuccess")),_(O.JWT_RECEIVED,{token:y.token,refreshToken:y.refreshToken,user:y.user,address:d,timestamp:Date.now()}),console.log(a("process.jwtSent"))}catch(h){const y=h.message||h.toString();if(y.includes("rejected")||y.includes("denied")||y.includes("cancel")||y.includes("å–æ¶ˆ")||y.includes("æ‹’çµ•"))throw new Error(a("errors.signatureCanceled"));if(v){if(y.includes("timeout")||y.includes("è¶…æ™‚"))throw new Error(a("errors.ledgerTimeout"));if(y.includes("not connected")||y.includes("æœªé€£æ¥"))throw new Error(a("errors.ledgerNotConnected"))}throw h}}catch(p){throw console.error("âŒ JWT è«‹æ±‚å¤±æ•—:",p),Be(p),i(a("errors.jwtFailed",{error:p.message||p.toString()})),p}},[o,s,a]);return{error:t,setError:i,handleJWTRequest:n}},Ue=()=>{const{wallets:t,select:i,connect:o,connecting:s,connected:a,wallet:n}=K(),d=g.useMemo(()=>t?t.filter(h=>{const y=h.adapter.readyState;return y==="Detected"||y==="Installed"||y==="Loadable"}).map(h=>({...h,detectedName:h.adapter.name,readyState:h.adapter.readyState})):[],[t,t==null?void 0:t.map(v=>`${v.adapter.name}:${v.adapter.readyState}`).join(",")]),l=g.useRef(0),r=g.useRef("");return g.useEffect(()=>{const v=d.length,h=l.current,y=(t==null?void 0:t.map(m=>`${m.adapter.name}:${m.adapter.readyState}`).join(","))||"",w=r.current,u=y!==w;(v!==h||u)&&(v>0?console.log("[useQuickLogin] å¯ç”¨éŒ¢åŒ…åˆ—è¡¨æ›´æ–°ï¼ˆåŸºæ–¼å®˜æ–¹é©é…å™¨ readyStateï¼‰:",{availableWallets:d.map(m=>({name:m.adapter.name,detectedName:m.detectedName,readyState:m.readyState||m.adapter.readyState})),allWalletsReadyStates:t==null?void 0:t.map(m=>({name:m.adapter.name,readyState:m.adapter.readyState})),readyStateChanged:u}):t&&t.length>0&&console.log("[useQuickLogin] ç„¡å¯ç”¨éŒ¢åŒ…ï¼ˆåŸºæ–¼å®˜æ–¹é©é…å™¨ readyStateï¼‰:",{hasWallets:!0,walletsCount:t.length,allWalletsReadyStates:t.map(m=>({name:m.adapter.name,readyState:m.adapter.readyState}))}),l.current=v,r.current=y)},[d,t]),{availableWallets:d,handleQuickConnect:async v=>{var y,w,u,m,x,k,T,L,N;const h=v.adapter.name;console.log("[QuickLogin] é–‹å§‹é€£æ¥éŒ¢åŒ…:",{walletName:h,availableWallets:t.map(b=>b.adapter.name),currentWallet:(y=n==null?void 0:n.adapter)==null?void 0:y.name,connecting:s,connected:a});try{const b=t.find(E=>E.adapter.name===h);if(console.log("[QuickLogin] æŸ¥æ‰¾éŒ¢åŒ…é©é…å™¨:",{walletName:h,found:!!b,targetWalletName:(w=b==null?void 0:b.adapter)==null?void 0:w.name,allWallets:t.map(E=>({name:E.adapter.name,readyState:E.adapter.readyState}))}),!b)throw new Error(`æ‰¾ä¸åˆ°éŒ¢åŒ…é©é…å™¨: ${h}`);console.log("[QuickLogin] æ­¥é©Ÿ 1: é¸æ“‡éŒ¢åŒ…",h),await i(h),console.log("[QuickLogin] æ­¥é©Ÿ 1 å®Œæˆ: select() å·²èª¿ç”¨"),console.log("[QuickLogin] æ­¥é©Ÿ 2: ç­‰å¾…é¸æ“‡å®Œæˆ..."),await new Promise(E=>setTimeout(E,500)),console.log("[QuickLogin] é¸æ“‡å¾Œç‹€æ…‹:",{currentWallet:(u=n==null?void 0:n.adapter)==null?void 0:u.name,expectedWallet:h,match:((m=n==null?void 0:n.adapter)==null?void 0:m.name)===h}),console.log("[QuickLogin] æ­¥é©Ÿ 3: é–‹å§‹é€£æ¥éŒ¢åŒ…..."),await o(),console.log("[QuickLogin] æ­¥é©Ÿ 3 å®Œæˆ: connect() æˆåŠŸ")}catch(b){console.error("[QuickLogin] å¿«é€Ÿé€£æ¥éŒ¯èª¤:",{error:b,message:b==null?void 0:b.message,stack:b==null?void 0:b.stack,walletName:h,currentWallet:(x=n==null?void 0:n.adapter)==null?void 0:x.name,connecting:s,connected:a});const E=(b==null?void 0:b.message)||(b==null?void 0:b.toString())||"";if(E.includes("No wallet is selected")||E.includes("not selected"))try{console.log('[QuickLogin] æª¢æ¸¬åˆ° "No wallet is selected" éŒ¯èª¤ï¼Œå˜—è©¦é‡è©¦...'),console.log("[QuickLogin] é‡è©¦å‰ç‹€æ…‹:",{walletName:h,currentWallet:(k=n==null?void 0:n.adapter)==null?void 0:k.name,wallets:t.map(j=>j.adapter.name)}),console.log("[QuickLogin] é‡è©¦: å†æ¬¡é¸æ“‡éŒ¢åŒ…",h),await i(h),console.log("[QuickLogin] é‡è©¦: ç­‰å¾…é¸æ“‡å®Œæˆ..."),await new Promise(j=>setTimeout(j,800)),console.log("[QuickLogin] é‡è©¦å¾Œç‹€æ…‹:",{currentWallet:(T=n==null?void 0:n.adapter)==null?void 0:T.name,expectedWallet:h,match:((L=n==null?void 0:n.adapter)==null?void 0:L.name)===h}),console.log("[QuickLogin] é‡è©¦: å†æ¬¡å˜—è©¦é€£æ¥..."),await o(),console.log("[QuickLogin] é‡è©¦æˆåŠŸ")}catch(j){console.error("[QuickLogin] é‡è©¦é€£æ¥å¤±æ•—:",{error:j,message:j==null?void 0:j.message,stack:j==null?void 0:j.stack,walletName:h,currentWallet:(N=n==null?void 0:n.adapter)==null?void 0:N.name});const P=(j==null?void 0:j.message)||(j==null?void 0:j.toString())||"";throw P.includes("No wallet is selected")||P.includes("not selected")?new Error(`ç„¡æ³•é¸æ“‡éŒ¢åŒ… ${h}ã€‚è«‹ç¢ºä¿ TronLink æ“´å±•å·²å®‰è£ä¸¦å•Ÿç”¨ã€‚`):j}else throw b}},connecting:s,connected:a,currentWallet:n}};function G(){try{return localStorage.getItem("wallet-login-language")==="en"?"en":"zh"}catch{return"zh"}}const Ve={"Connect a wallet on Tron to continue.":"é€£æ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ","Connect a wallet on Tron to continue":"é€£æ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ","Connect a wallet on":"é€£æ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ","Tron to continue":"é€£æ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ","Connect a wallet":"é€£æ¥éŒ¢åŒ…",Detected:"å·²æª¢æ¸¬",NotFound:"æœªæ‰¾åˆ°",NotDetected:"æœªæª¢æ¸¬",Installed:"å·²å®‰è£",NotInstalled:"æœªå®‰è£",Loading:"è¼‰å…¥ä¸­",Connecting:"é€£æ¥ä¸­",Connected:"å·²é€£æ¥",Disconnect:"æ–·é–‹é€£æ¥","Select Wallet":"é¸æ“‡éŒ¢åŒ…",Wallet:"éŒ¢åŒ…","on Tron":"TRON","to continue":"ä»¥ç¹¼çºŒ"},ze={"Connect a wallet on Tron to continue.":"Connect a wallet on Tron to continue.","Connect a wallet on Tron to continue":"Connect a wallet on Tron to continue","Connect a wallet on":"Connect a wallet on","Tron to continue":"Tron to continue","Connect a wallet":"Connect a wallet",Detected:"Detected",NotFound:"NotFound",NotDetected:"NotDetected",Installed:"Installed",NotInstalled:"NotInstalled",Loading:"Loading",Connecting:"Connecting",Connected:"Connected",Disconnect:"Disconnect","Select Wallet":"Select Wallet",Wallet:"Wallet","on Tron":"on Tron","to continue":"to continue"};function me(){return G()==="zh"?Ve:ze}function le(t){if(!t)return t;const i=me();G()==="zh"&&(t=t.replace(/Connect a wallet on Tron to continue\.?/gi,i["Connect a wallet on Tron to continue"]),t=t.replace(/Connect a wallet on\s*$/gi,i["Connect a wallet on Tron to continue"]),t.includes(i["Connect a wallet on Tron to continue"])?t=t.replace(/Tron to continue\.?/gi,""):t=t.replace(/Tron to continue\.?/gi,""));for(const[s,a]of Object.entries(i)){if(t.trim()===s)return a;const n=new RegExp(`^\\s*${s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\s*$`,"gi");t=t.replace(n,a)}return t}function pe(t){if(t){if(t.nodeType===Node.TEXT_NODE){const i=t.textContent,o=le(i);o!==i&&(t.textContent=o)}else if(t.nodeType===Node.ELEMENT_NODE){const i=t.textContent&&(t.textContent.includes("Connect a wallet")||t.textContent.includes("Detected")||t.textContent.includes("NotFound")||t.textContent.includes("Select Wallet"));if(t.dataset.translated==="true"&&!i)return;const o=t.textContent.trim(),a=me()["Connect a wallet on Tron to continue"];if(o.includes("Connect a wallet on Tron to continue")||o.includes("Connect a wallet on")&&o.includes("Tron to continue")){t.innerHTML=a,t.dataset.translated="true";return}if(t.children.length===0){const n=t.textContent.trim(),d=le(n);if(d!==n){t.textContent=d,t.dataset.translated="true";return}}Array.from(t.childNodes).forEach(n=>{pe(n)})}}}function Je(t){if(!t)return!1;if(t.textContent.trim().includes("Connect a wallet on Tron to continue"))return t.innerHTML="é€£æ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ",t.dataset.translated="true",!0;const o=Array.from(t.childNodes);let s=!1,a=!1,n=null,d=null;return o.forEach(l=>{const r=l.textContent.trim();(r.includes("Connect a wallet on")||r==="Connect a wallet on")&&(s=!0,n=l),(r.includes("Tron to continue")||r==="Tron to continue")&&(a=!0,d=l)}),s&&a?(n&&(n.textContent="é€£æ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ",n.dataset.translated="true"),d&&(d.textContent=""),t.dataset.translated="true",!0):(o.forEach(l=>{if(l.nodeType===Node.TEXT_NODE){const r=l.textContent.trim();if(r==="Connect a wallet on"||r.includes("Connect a wallet on"))l.textContent="é€£æ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ";else if(r==="Tron to continue"||r.includes("Tron to continue")){const p=l.previousSibling;p&&p.textContent&&p.textContent.includes("é€£æ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ"),l.textContent=""}}else if(l.nodeType===Node.ELEMENT_NODE){const r=l.textContent.trim();r==="Connect a wallet on"||r.includes("Connect a wallet on")?(l.textContent="é€£æ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ",l.dataset.translated="true"):(r==="Tron to continue"||r.includes("Tron to continue"))&&(l.textContent="")}}),!1)}function B(){['[role="dialog"]','[class*="wallet-adapter"]','[class*="wallet-modal"]','[class*="WalletModal"]','[class*="modal"]'].forEach(i=>{try{document.querySelectorAll(i).forEach(s=>{s&&(s.textContent&&(s.textContent.includes("Connect a wallet")||s.textContent.includes("Detected")||s.textContent.includes("NotFound")||s.textContent.includes("Select Wallet")||s.textContent.includes("NotDetected")||s.textContent.includes("NotInstalled"))&&(s.dataset.translated="false",s.querySelectorAll('[data-translated="true"]').forEach(n=>{n.dataset.translated="false"})),(!s.dataset.translated||s.dataset.translated==="false")&&(s.querySelectorAll('h1, h2, h3, h4, h5, h6, [class*="title"], [class*="Title"]').forEach(d=>{(!d.dataset.translated||d.dataset.translated==="false")&&Je(d)}),pe(s),s.dataset.translated="true"))})}catch{}})}function He(t=null){t||G();const i=new MutationObserver(n=>{let d=!1;n.forEach(l=>{l.addedNodes.forEach(r=>{var p;if(r.nodeType===Node.ELEMENT_NODE){const v=((p=r.classList)==null?void 0:p.toString())||"",h=r.getAttribute("role")||"";(v.includes("wallet")||v.includes("modal")||h==="dialog"||r.querySelector('[role="dialog"]')||r.querySelector('[class*="wallet"]')||r.querySelector('[class*="modal"]'))&&(d=!0)}})}),d&&requestAnimationFrame(()=>{B(),requestAnimationFrame(()=>{B()})})});document.body&&i.observe(document.body,{childList:!0,subtree:!0});const o=()=>{B()};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",o):o();const s=setInterval(()=>{B()},200),a=()=>{document.querySelectorAll('[data-translated="true"]').forEach(n=>{n.dataset.translated="false"}),B()};return window.addEventListener("storage",a),window.addEventListener("languageChanged",a),{disconnect:()=>{i.disconnect(),clearInterval(s),window.removeEventListener("storage",a),window.removeEventListener("languageChanged",a)}}}const Q={TRONWALLET_SCHEME:"tronlink://",TRONWALLET_UNIVERSAL_LINK:"https://www.tronlink.org/",CALLBACK_PATH:"/callback"},H={PROJECT_ID:"7412eb629501759c091220ccc09ded23",NETWORK:"mainnet",get METADATA(){return{name:"TRON éŒ¢åŒ…ç™»å…¥æ¨¡å¡Š",description:"TRON éŒ¢åŒ…ç™»å…¥æ¨¡å¡Š - Flutter Web é›†æˆ",url:window.location.origin,icons:[`${window.location.origin}/favicon.ico`]}}},fe=g.createContext(),Ke=()=>{const t=g.useContext(fe);if(!t)throw new Error("useTheme must be used within ThemeProvider");return t},Ge=({children:t})=>{const i=()=>{try{const n=localStorage.getItem("wallet-login-theme");return n?n==="dark"?"dark":"light":window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}catch{return"light"}},[o,s]=g.useState(i),a=()=>{const n=o==="light"?"dark":"light";s(n),localStorage.setItem("wallet-login-theme",n),document.documentElement.setAttribute("data-theme",n)};return g.useEffect(()=>{document.documentElement.setAttribute("data-theme",o)},[o]),g.useEffect(()=>{const n=window.matchMedia("(prefers-color-scheme: dark)"),d=l=>{localStorage.getItem("wallet-login-theme")||s(l.matches?"dark":"light")};return n.addEventListener("change",d),()=>n.removeEventListener("change",d)},[]),e.jsx(fe.Provider,{value:{theme:o,toggleTheme:a,isDark:o==="dark",isLight:o==="light"},children:t})},ce=()=>{const{language:t,changeLanguage:i}=U(),{theme:o,toggleTheme:s}=Ke();return e.jsxs("div",{className:"language-switcher",children:[e.jsx("button",{className:"theme-btn",onClick:s,title:o==="light"?"åˆ‡æ›åˆ°æ·±è‰²ä¸»é¡Œ":"åˆ‡æ›åˆ°æ·ºè‰²ä¸»é¡Œ","aria-label":o==="light"?"Switch to dark theme":"Switch to light theme",children:o==="light"?e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})}):e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),e.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),e.jsx("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),e.jsx("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),e.jsx("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),e.jsx("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),e.jsx("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),e.jsx("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]})}),e.jsx("button",{className:`lang-btn ${t==="zh"?"active":""}`,onClick:()=>i("zh"),title:"ä¸­æ–‡",children:"ä¸­æ–‡"}),e.jsx("button",{className:`lang-btn ${t==="en"?"active":""}`,onClick:()=>i("en"),title:"English",children:"EN"})]})},Xe=({address:t,signingStatus:i})=>{const{t:o}=U(),{platform:s,browser:a,isPWA:n}=ue(),l=i==="pending"?{title:o("wallet.connectedWaitingSignature","å·²é€£æ¥éŒ¢åŒ…(ç­‰å¾…ç°½å)"),icon:e.jsx("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"})}),className:"status-waiting"}:i==="success"?{title:o("wallet.connectedSignatureSuccess","å·²é€£æ¥éŒ¢åŒ…(ç°½åæˆåŠŸ)"),icon:e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),className:"status-success"}:{title:o("wallet.connected","å·²é€£æ¥éŒ¢åŒ…"),icon:e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),className:"status-default"};return e.jsxs("div",{className:"wallet-info",children:[e.jsxs("div",{className:`success-message ${l.className}`,children:[e.jsx("div",{className:"status-icon-wrapper",children:l.icon}),e.jsx("h2",{children:l.title}),i==="success"&&e.jsx("p",{className:"login-redirect-message",children:o("wallet.redirectingToLogin","è·³è½‰ç™»å…¥...")})]}),e.jsx("div",{className:"environment-info",children:e.jsxs("div",{className:"env-badge",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),e.jsx("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),e.jsx("line",{x1:"12",y1:"17",x2:"12",y2:"21"})]}),e.jsx("span",{className:"env-platform",children:s}),a&&a!=="Unknown"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"env-separator",children:"Â·"}),e.jsx("span",{className:"env-browser",children:a})]}),n&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"env-separator",children:"Â·"}),e.jsx("span",{className:"env-pwa-badge",children:"PWA"})]})]})}),e.jsxs("div",{className:"address-display",children:[e.jsxs("label",{children:[o("wallet.address"),"ï¼š"]}),e.jsx("div",{className:"address-value",children:t})]}),e.jsx("div",{className:"wallet-actions",children:e.jsx(Ce,{})})]})},Ze=({availableWallets:t,onWalletClick:i,connecting:o,connectedWallet:s})=>{const a=t.filter(n=>{var r;const d=n.readyState||((r=n.adapter)==null?void 0:r.readyState);return d==="Detected"||d==="Installed"||d==="Loadable"||d==="Loading"});return a.length===0?null:e.jsx("div",{className:"quick-login-section",children:e.jsx("div",{className:"quick-login-buttons",children:a.map(n=>{var r,p;const d=n.adapter.name===((r=s==null?void 0:s.adapter)==null?void 0:r.name),l=o&&d;return e.jsxs("button",{className:"quick-login-btn",onClick:()=>i(n),disabled:l,children:[e.jsxs("div",{className:"quick-login-icon",children:[n.adapter.icon&&e.jsx("img",{src:n.adapter.icon,alt:n.detectedName,onError:v=>{v.target.style.display="none"}}),(!n.adapter.icon||!n.adapter.icon.startsWith("data:"))&&e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]})]}),e.jsx("span",{className:"quick-login-name",children:n.detectedName}),o&&n.adapter.name===((p=s==null?void 0:s.adapter)==null?void 0:p.name)&&e.jsx("div",{className:"quick-login-spinner"})]},n.adapter.name)})})})},Ye=500,et=()=>{const[t,i]=g.useState([]),[o,s]=g.useState(!0),a=g.useRef(null),n=g.useRef(null),d=g.useRef(null),l=g.useRef(o),r=g.useRef(null);g.useEffect(()=>{l.current=o},[o]);const p=g.useCallback((w,u,m=null)=>{if(l.current)try{const x=new Date().toLocaleTimeString("zh-TW",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3}),k={id:Date.now()+Math.random(),timestamp:x,level:w,message:u,data:m?JSON.stringify(m,null,2):null};i(T=>[...T,k].slice(-Ye))}catch(x){n.current&&n.current("Logger error:",x)}},[]);g.useEffect(()=>{r.current=p},[p]),g.useEffect(()=>{const w=setTimeout(()=>{l.current&&(a.current||(a.current=console.log.bind(console),n.current=console.error.bind(console),d.current=console.warn.bind(console)),console.log=(...u)=>{try{if(a.current(...u),!l.current||!r.current)return;const m=u.find(T=>typeof T=="string")||"",x=u.find(T=>typeof T=="object"&&T!==null&&!Array.isArray(T))||null;["[useEnvironment]","[useQuickLogin]","[TronWalletLogin]","[QuickLogin]","[Flutter Bridge]"].some(T=>m.includes(T))&&setTimeout(()=>{r.current&&r.current("log",m,x)},0)}catch{a.current&&a.current(...u)}},console.error=(...u)=>{var m;try{if(n.current(...u),!l.current||!r.current)return;const x=u.find(T=>typeof T=="string")||((m=u[0])==null?void 0:m.toString())||"Error",k=u.find(T=>typeof T=="object"&&T!==null&&!Array.isArray(T))||null;setTimeout(()=>{r.current&&r.current("error",x,k)},0)}catch{n.current&&n.current(...u)}},console.warn=(...u)=>{var m;try{if(d.current(...u),!l.current||!r.current)return;const x=u.find(T=>typeof T=="string")||((m=u[0])==null?void 0:m.toString())||"Warning",k=u.find(T=>typeof T=="object"&&T!==null&&!Array.isArray(T))||null;setTimeout(()=>{r.current&&r.current("warn",x,k)},0)}catch{d.current&&d.current(...u)}})},100);return()=>{clearTimeout(w),a.current&&(console.log=a.current,console.error=n.current,console.warn=d.current)}},[]);const v=g.useCallback(()=>{i([])},[]),h=g.useCallback(()=>{const w=t.map(u=>{const m=u.data?`
${u.data}`:"";return`[${u.timestamp}] [${u.level.toUpperCase()}] ${u.message}${m}`}).join(`

`);navigator.clipboard.writeText(w).then(()=>{p("info","æ—¥èªŒå·²è¤‡è£½åˆ°å‰ªè²¼æ¿")}).catch(u=>{p("error","è¤‡è£½æ—¥èªŒå¤±æ•—: "+u.message)})},[t,p]),y=g.useCallback(()=>{const w=t.map(k=>{const T=k.data?`
${k.data}`:"";return`[${k.timestamp}] [${k.level.toUpperCase()}] ${k.message}${T}`}).join(`

`),u=new Blob([w],{type:"text/plain"}),m=URL.createObjectURL(u),x=document.createElement("a");x.href=m,x.download=`tronwallet-logs-${new Date().toISOString().replace(/[:.]/g,"-")}.txt`,document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(m),p("info","æ—¥èªŒå·²å°å‡º")},[t,p]);return{logs:t,isEnabled:o,setIsEnabled:s,clearLogs:v,copyLogs:h,exportLogs:y,addLog:p}},we=g.createContext(null),tt=({children:t})=>{const i=et();return e.jsx(we.Provider,{value:i,children:t})},nt=()=>g.useContext(we),de=()=>{const t=nt();if(!t)return null;const{logs:i,isEnabled:o,setIsEnabled:s,clearLogs:a,copyLogs:n,exportLogs:d}=t,[l,r]=g.useState(!1),[p,v]=g.useState(!0),h=g.useRef(null),y=u=>{switch(u){case"error":return"log-entry-error";case"warn":return"log-entry-warn";case"info":return"log-entry-info";default:return"log-entry-log"}},w=()=>{h.current&&p&&(h.current.scrollTop=h.current.scrollHeight)};return g.useEffect(()=>{l&&p&&setTimeout(w,100)},[i,l,p]),o?e.jsxs("div",{className:`logger-panel ${l?"expanded":"collapsed"}`,children:[e.jsxs("div",{className:"logger-header",children:[e.jsxs("div",{className:"logger-header-left",children:[e.jsx("button",{className:"logger-toggle-btn",onClick:()=>r(!l),title:l?"æ”¶èµ·æ—¥èªŒ":"å±•é–‹æ—¥èªŒ",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:l?e.jsx("path",{d:"M18 15l-6-6-6 6"}):e.jsx("path",{d:"M6 9l6 6 6-6"})})}),e.jsxs("span",{className:"logger-title",children:["èª¿è©¦æ—¥èªŒ (",i.length,")"]})]}),l&&e.jsxs("div",{className:"logger-actions",children:[e.jsxs("label",{className:"logger-checkbox",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:u=>v(u.target.checked)}),e.jsx("span",{children:"è‡ªå‹•æ»¾å‹•"})]}),e.jsx("button",{className:"logger-action-btn",onClick:a,title:"æ¸…é™¤æ—¥èªŒ",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})}),e.jsx("button",{className:"logger-action-btn",onClick:n,title:"è¤‡è£½æ—¥èªŒ",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),e.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]})}),e.jsx("button",{className:"logger-action-btn",onClick:d,title:"å°å‡ºæ—¥èªŒ",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"7 10 12 15 17 10"}),e.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]})}),e.jsx("button",{className:"logger-action-btn",onClick:()=>s(!1),title:"é—œé–‰æ—¥èªŒ",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]})]}),l&&e.jsx("div",{className:"logger-content",ref:h,children:i.length===0?e.jsxs("div",{className:"logger-empty",children:[e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",opacity:"0.3",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e.jsx("polyline",{points:"10 9 9 9 8 9"})]}),e.jsx("p",{children:"æš«ç„¡æ—¥èªŒ"})]}):e.jsx("div",{className:"logger-entries",children:i.map(u=>e.jsxs("div",{className:`log-entry ${y(u.level)}`,children:[e.jsxs("div",{className:"log-entry-header",children:[e.jsx("span",{className:"log-timestamp",children:u.timestamp}),e.jsx("span",{className:`log-level log-level-${u.level}`,children:u.level.toUpperCase()})]}),e.jsx("div",{className:"log-message",children:u.message}),u.data&&e.jsxs("details",{className:"log-data",children:[e.jsx("summary",{children:"æŸ¥çœ‹æ•¸æ“š"}),e.jsx("pre",{children:u.data})]})]},u.id))})})]}):e.jsx("button",{className:"logger-toggle-btn",onClick:()=>s(!0),title:"å•Ÿç”¨æ—¥èªŒ",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e.jsx("polyline",{points:"10 9 9 9 8 9"})]})})},ot=()=>{var se;const{t,language:i}=U(),{address:o,connected:s,wallet:a,select:n,connect:d}=K(),{setVisible:l,visible:r}=be(),{triggerDeepLink:p,checkAppInstalled:v}=Oe(),h=ue(),{error:y,setError:w,handleJWTRequest:u}=Qe(),[m,x]=g.useState(null),{availableWallets:k,handleQuickConnect:T,connecting:L,currentWallet:N}=Ue(),{isPC:b,isMobile:E,hasExtension:j,detectedWallets:P,platform:V,browser:z,isPWA:D}=h,$=(b||D&&!E)&&j,xe=E||!j,X=g.useRef(s),Z=g.useRef(o),q=g.useRef(!1),Y=g.useRef(k.length),ee=g.useRef(s);g.useEffect(()=>{var c;(k.length!==Y.current||s!==ee.current)&&(console.log("[TronWalletLogin] çµ„ä»¶ç‹€æ…‹æ›´æ–°:",{isPWA:D,isPC:b,isMobile:E,platform:V,availableWalletsCount:k.length,availableWallets:k.map(f=>({name:f.adapter.name,detectedName:f.detectedName,readyState:f.adapter.readyState})),detectedWallets:P.map(f=>f.name),hasExtension:j,showExtensionOption:$,connecting:L,connected:s,currentWallet:(c=N==null?void 0:N.adapter)==null?void 0:c.name,address:o}),Y.current=k.length,ee.current=s)},[k.length,P.length,j,L,s,(se=N==null?void 0:N.adapter)==null?void 0:se.name,o,D,b,E,V,$]);const ve=()=>{const f=`login_${Date.now()}`,C=encodeURIComponent(window.location.origin+Q.CALLBACK_PATH);return{deepLinkUrl:`${Q.TRONWALLET_SCHEME}login?callback=${C}&requestId=${f}`,requestId:f,callbackUrl:C}},Te=async()=>{w("");try{const{deepLinkUrl:c}=ve();if(E&&!await v(Q.TRONWALLET_SCHEME)){window.confirm(t("errors.appNotInstalled"))&&window.open(Q.TRONWALLET_UNIVERSAL_LINK,"_blank");return}await p(c)||w(t("errors.cannotOpenApp"))}catch(c){console.error("APP ç™»å…¥éŒ¯èª¤:",c),w(t("errors.loginFailed"))}};g.useEffect(()=>{const c=new URLSearchParams(window.location.search),f=c.get("address"),C=c.get("requestId");f&&C&&(window.history.replaceState({},document.title,window.location.pathname),console.log("æ”¶åˆ° Deep Link å›èª¿:",{address:f,requestId:C}))},[]);const A=g.useRef(null),te=g.useRef(!0),I=g.useRef(!1),ne=g.useRef(!1);g.useEffect(()=>{var C;const c=ne.current,f=r||!1;if(c&&!f&&a&&!s){const S=(C=a==null?void 0:a.adapter)==null?void 0:C.name;S&&S!==A.current&&(console.log("[TronWalletLogin] æª¢æ¸¬åˆ°å½ˆçª—é—œé–‰ä¸”éŒ¢åŒ…è¢«é¸æ“‡ï¼Œæ¨™è¨˜ç‚ºç”¨æˆ¶é¸æ“‡:",{walletName:S,prevWalletName:A.current}),I.current=!0)}ne.current=f},[r,a,s]),g.useEffect(()=>{var f;const c=(f=a==null?void 0:a.adapter)==null?void 0:f.name;if(te.current){console.log("[TronWalletLogin] çµ„ä»¶é¦–æ¬¡æ›è¼‰ï¼ŒéŒ¢åŒ…ç‹€æ…‹:",{walletName:c,connected:s,connecting:L,isInitialMount:!0}),te.current=!1,c&&(A.current=c);return}a&&!s&&!L&&c!==A.current?I.current?(console.log("[TronWalletLogin] æª¢æ¸¬åˆ°ç”¨æˆ¶é¸æ“‡çš„æ–°éŒ¢åŒ…ï¼Œå˜—è©¦é€£æ¥:",{walletName:c,connected:s,connecting:L,prevWalletName:A.current,userSelected:!0}),I.current=!1,A.current=c,d().catch(C=>{console.error("[TronWalletLogin] è‡ªå‹•é€£æ¥å¤±æ•—:",C),w(t("errors.connectionFailed",{error:C.message||C.toString()}))})):(console.log("[TronWalletLogin] æª¢æ¸¬åˆ°éŒ¢åŒ…ç‹€æ…‹è®ŠåŒ–ï¼ˆéç”¨æˆ¶é¸æ“‡ï¼‰ï¼Œä¸è‡ªå‹•é€£æ¥:",{walletName:c,connected:s,connecting:L,prevWalletName:A.current,userSelected:!1,modalVisible:r}),A.current=c):c?A.current=c:a||(A.current=null,I.current=!1)},[a,s,L,d,w,t,r]),g.useEffect(()=>{var C,S,M;const c=X.current,f=Z.current;(s!==c||o!==f)&&console.log("[TronWalletLogin] é€£æ¥ç‹€æ…‹è®ŠåŒ–:",{wasConnected:c,connected:s,prevAddress:f,address:o,wallet:(C=a==null?void 0:a.adapter)==null?void 0:C.name,connecting:L,stackTrace:(S=new Error().stack)==null?void 0:S.split(`
`).slice(0,5).join(`
`)}),s&&o?(!c||f!==o)&&(console.log("[TronWalletLogin] è§¸ç™¼é€£æ¥æµç¨‹:",{wasConnected:c,connected:s,prevAddress:f,address:o,wallet:(M=a==null?void 0:a.adapter)==null?void 0:M.name}),w(""),x("pending"),_(O.WALLET_CONNECTED,{address:o,timestamp:Date.now()}),(!c||f!==o)&&u(o).then(()=>{x("success")}).catch(R=>{const W=(R==null?void 0:R.message)||(R==null?void 0:R.toString())||"";W.includes("å–æ¶ˆ")||W.includes("rejected")||W.includes("cancel")?x("pending"):x("failed")})):!s&&c&&(console.log("[TronWalletLogin] è§¸ç™¼æ–·é–‹æµç¨‹"),x(null),_(O.WALLET_DISCONNECTED,{timestamp:Date.now()})),X.current=s,Z.current=o},[s,o]),g.useEffect(()=>{const c=()=>{const M=document.querySelectorAll(".official-wallet-button button");if(M.length===0)return;const R=document.documentElement.getAttribute("data-theme")==="dark";M.forEach(W=>{W instanceof HTMLElement&&(R?(W.style.setProperty("background","transparent","important"),W.style.setProperty("border","2px solid #4b5563","important")):(W.style.setProperty("background","transparent","important"),W.style.setProperty("border","2px solid #e5e7eb","important")),W.style.setProperty("background-image","none","important"))})},f=setTimeout(()=>{requestAnimationFrame(c)},100),C=new MutationObserver(M=>{M.some(W=>Array.from(W.addedNodes).some(F=>{var ae,re;return F.nodeType===1&&(((ae=F.classList)==null?void 0:ae.contains("official-wallet-button"))||((re=F.querySelector)==null?void 0:re.call(F,".official-wallet-button button")))}))&&requestAnimationFrame(c)}),S=document.querySelector(".tronwallet-login");return S&&C.observe(S,{childList:!0,subtree:!0}),()=>{clearTimeout(f),C.disconnect()}},[k.length]),g.useEffect(()=>{const c=He(i);return()=>{c&&c.disconnect&&c.disconnect()}},[i]),g.useEffect(()=>{const c=Fe(f=>{switch(f.type){case O.INIT:q.current||(ie(),q.current=!0);break;case O.CLOSE:console.log("Flutter è«‹æ±‚é—œé–‰ç™»å…¥æ¨¡å¡Š");break}});return q.current||(ie(),q.current=!0),c},[]);const J=()=>!!(document.referrer&&document.referrer!==window.location.href||window.history.length>1),oe=()=>{J()&&window.history.back()};return s&&o?e.jsxs(e.Fragment,{children:[J()&&e.jsxs("button",{className:"back-button",onClick:oe,title:t("common.back"),children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7"})}),e.jsx("span",{children:t("common.back")})]}),e.jsx(ce,{}),e.jsx(Xe,{address:o,signingStatus:m}),e.jsx(de,{})]}):e.jsxs("div",{className:"tronwallet-login",children:[J()&&e.jsxs("button",{className:"back-button",onClick:oe,title:t("common.back"),children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7"})}),e.jsx("span",{children:t("common.back")})]}),e.jsx(ce,{}),e.jsx("div",{className:"login-icon",children:e.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]})}),e.jsx("h2",{className:"login-title",children:t("login.title")}),e.jsx("div",{className:"environment-info",children:e.jsxs("div",{className:"env-badge",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),e.jsx("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),e.jsx("line",{x1:"12",y1:"17",x2:"12",y2:"21"})]}),e.jsx("span",{className:"env-platform",children:V}),z&&z!=="Unknown"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"env-separator",children:"Â·"}),e.jsx("span",{className:"env-browser",children:z})]}),D&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"env-separator",children:"Â·"}),e.jsx("span",{className:"env-pwa-badge",children:"PWA"})]})]})}),e.jsx("p",{className:"login-description",children:$&&P.length>0?t("login.description.detected",{wallets:P.map(c=>c.name).join("ã€")}):t(b||D&&!E?"login.description.pc":"login.description.mobile")}),y&&e.jsxs("div",{className:"error-message",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),y]}),s&&o&&m==="pending"&&e.jsx("div",{className:"signing-prompt",children:e.jsxs("div",{className:"signing-prompt-content",children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"})}),e.jsxs("div",{className:"signing-prompt-text",children:[e.jsx("p",{className:"signing-prompt-title",children:t("signing.pendingTitle","è«‹å®Œæˆç°½åä»¥å®Œæˆç™»å…¥")}),e.jsx("p",{className:"signing-prompt-desc",children:t("signing.pendingDesc","éŒ¢åŒ…å·²é€£æ¥ï¼Œè«‹åœ¨éŒ¢åŒ…ä¸­ç¢ºèªç°½åè«‹æ±‚")})]}),e.jsx("button",{className:"signing-prompt-btn",onClick:async()=>{x("pending"),w("");try{await u(o),x("success")}catch(c){const f=(c==null?void 0:c.message)||(c==null?void 0:c.toString())||"";f.includes("å–æ¶ˆ")||f.includes("rejected")||f.includes("cancel")?x("pending"):x("failed")}},children:t("signing.retry","é‡æ–°ç°½å")})]})}),e.jsx(Ze,{availableWallets:k,onWalletClick:async c=>{var f;console.log("[TronWalletLogin] TronLink æŒ‰éˆ•è¢«é»æ“Š:",{walletName:c.adapter.name,detectedName:c.detectedName,availableWallets:k.map(C=>C.adapter.name),connecting:L,currentWallet:(f=N==null?void 0:N.adapter)==null?void 0:f.name});try{w(""),I.current=!0,console.log("[TronWalletLogin] é–‹å§‹è™•ç†å¿«é€Ÿé€£æ¥..."),await T(c),console.log("[TronWalletLogin] å¿«é€Ÿé€£æ¥æˆåŠŸ")}catch(C){console.error("[TronWalletLogin] å¿«é€Ÿé€£æ¥å¤±æ•—:",{error:C,message:C==null?void 0:C.message,stack:C==null?void 0:C.stack,walletName:c.adapter.name}),w(t("errors.connectionFailed",{error:C.message||C.toString()}))}},connecting:L,connectedWallet:N}),e.jsxs("div",{className:"login-methods",children:[e.jsx("div",{className:"official-wallet-button","data-button-text":t("login.selectWallet"),style:{"--button-text":`"${t("login.selectWallet")}"`},children:e.jsx("button",{className:"select-wallet-custom-btn",onClick:c=>{c.preventDefault(),c.stopPropagation(),console.log("[TronWalletLogin] é¸æ“‡éŒ¢åŒ…æŒ‰éˆ•è¢«é»æ“Šï¼Œæ‰“é–‹é¸æ“‡å½ˆçª—"),l(!0)},children:t("login.selectWallet")})}),$&&xe&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"method-divider",children:e.jsx("span",{children:t("login.or")})}),e.jsxs("button",{className:"login-method-btn",onClick:Te,disabled:L,children:[e.jsx("div",{className:"method-icon",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"5",y:"2",width:"14",height:"20",rx:"2",ry:"2"}),e.jsx("line",{x1:"12",y1:"18",x2:"12.01",y2:"18"})]})}),e.jsxs("div",{className:"method-content",children:[e.jsx("h3",{children:t("login.useMobileApp")}),e.jsx("p",{children:t("login.mobileAppDesc")})]})]})]})]}),e.jsxs("div",{className:"login-tips",children:[e.jsx("p",{children:t("tips.title")}),e.jsx("ul",{children:b?j?t("tips.pcWithExtension",{wallets:P.map(c=>c.name).join("ã€")}).map((c,f)=>e.jsx("li",{children:c},f)):t("tips.pcWithoutExtension").map((c,f)=>e.jsx("li",{children:c},f)):t("tips.mobile").map((c,f)=>e.jsx("li",{children:c},f))})]}),e.jsx(de,{})]})},st=()=>[new je,new Le,new Ne,new Ee],at=()=>[new We,new Se],rt=()=>[new Ae],it=()=>{const t=H.METADATA;return new Re({network:H.NETWORK,options:{projectId:H.PROJECT_ID,metadata:t}})},lt=()=>{const t=[...st(),...at(),...rt()],i=it();return i&&t.push(i),t};function ct(){return e.jsx("div",{className:"app",children:e.jsx("div",{className:"app-container",children:e.jsx(ot,{})})})}function dt(){const t=g.useMemo(()=>lt(),[]),i=o=>{console.error("éŒ¢åŒ…éŒ¯èª¤:",o)};return e.jsx(Ge,{children:e.jsx(qe,{children:e.jsx(tt,{children:e.jsx(Pe,{adapters:t,onError:i,autoConnect:!1,children:e.jsx(Me,{children:e.jsx(ct,{})})})})})})}console.log("[Main] Before importing polyfills...");console.log("[Main] After importing polyfills, checking Buffer:",typeof window<"u"?typeof window.Buffer:"window undefined");console.log("[Main] App imports complete, Buffer check:",typeof window<"u"?typeof window.Buffer:"window undefined");ye.createRoot(document.getElementById("root")).render(e.jsx(ke.StrictMode,{children:e.jsx(dt,{})}));
