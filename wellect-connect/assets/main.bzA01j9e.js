import{r as g,j as e,c as xe,R as we}from"./react-vendor.Bj0G0Oyz.js";import"./polyfills.DCfrOiPO.js";import{ab as J,ac as Te,ad as Ce,ae as ve,af as ye,ag as ke,ah as Le,ai as je,aj as be,ak as Ne,al as Ee,am as We,an as Se}from"./wallet-vendor.CHv2NQr2.js";import"./buffer-polyfill.ErO7y5re.js";const Ae=()=>{const[t,r]=g.useState(!0),s=async n=>{try{const o=`${n}test`;return new Promise(u=>{const i=document.createElement("iframe");i.style.display="none",i.src=o;let c=!1;const m=setTimeout(()=>{c||(c=!0,document.body.removeChild(i),u(!1))},1e3);i.onload=()=>{c||(c=!0,clearTimeout(m),document.body.removeChild(i),u(!0))},i.onerror=()=>{c||(c=!0,clearTimeout(m),document.body.removeChild(i),u(!1))},document.body.appendChild(i)})}catch(o){return console.error("æª¢æŸ¥ APP å®‰è£ç‹€æ…‹å¤±æ•—:",o),!1}},a=async n=>{try{const o=document.createElement("a");return o.href=n,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),await new Promise(u=>setTimeout(u,300)),!0}catch(o){return console.error("è§¸ç™¼ Deep Link å¤±æ•—:",o),!1}};return g.useEffect(()=>{const n=o=>{o.origin===window.location.origin&&o.data&&o.data.type==="TRONWALLET_CALLBACK"&&console.log("æ”¶åˆ° TronWallet å›žèª¿:",o.data)};return window.addEventListener("message",n),()=>{window.removeEventListener("message",n)}},[]),{isSupported:t,checkAppInstalled:s,triggerDeepLink:a}},ie=()=>{const[t,r]=g.useState({isPC:!1,isMobile:!1,isIOS:!1,isAndroid:!1,isTablet:!1,hasExtension:!1,detectedWallets:[],isPWA:!1,isStandalone:!1,platform:"",browser:""});return g.useEffect(()=>{const s=()=>{const o=navigator.userAgent||navigator.vendor||window.opera,u=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(o),i=/iPad|iPhone|iPod/.test(o)&&!window.MSStream,c=/Android/.test(o),m=/iPad/.test(o)||c&&!/Mobile/.test(o),d=!u,p=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://"),T=p||window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches;let f="Unknown";o.indexOf("Chrome")>-1&&o.indexOf("Edg")===-1?f="Chrome":o.indexOf("Safari")>-1&&o.indexOf("Chrome")===-1?f="Safari":o.indexOf("Firefox")>-1?f="Firefox":o.indexOf("Edg")>-1?f="Edge":(o.indexOf("Opera")>-1||o.indexOf("OPR")>-1)&&(f="Opera");let l="Web";T?i?l="iOS PWA":c?l="Android PWA":l="PWA":d?l="Web PC":i?l="iOS Web":c&&(l="Android Web");const C=[],w=!1;T&&console.log("[useEnvironment] PWAæ¨¡å¼ç’°å¢ƒæª¢æ¸¬çµæžœ:",{isPWA:T,isPC:d,isMobile:u,platform:l,browser:f}),r({isPC:d,isMobile:u,isIOS:i,isAndroid:c,isTablet:m,hasExtension:w,detectedWallets:C,isPWA:T,isStandalone:p,platform:l,browser:f})};s();let a;const n=()=>{clearTimeout(a),a=setTimeout(s,300)};return window.addEventListener("resize",n),()=>{a&&clearTimeout(a),window.removeEventListener("resize",n)}},[]),t},le={apiBaseUrl:"https://agoramarketapi.purrtechllc.com/api"};async function Pe(t){const r=await fetch(`${le.apiBaseUrl}/auth/wallet-connect/nonce`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({walletAddress:t})});if(!r.ok)throw new Error("ç²å– nonce å¤±æ•—: "+r.statusText);const s=await r.json();if(s.message&&(!s.nonce||s.nonce==="")&&s.message.includes("Nonce:")){const a=s.message.match(/Nonce:\s*([^\n]+)/);a&&a[1]&&(s.nonce=a[1].trim())}if(s.message&&!s.timestamp&&s.message.includes("Timestamp:")){const a=s.message.match(/Timestamp:\s*([^\n]+)/);if(a&&a[1]){const n=parseInt(a[1].trim());isNaN(n)||(s.timestamp=n)}}if(!s.message||s.message==="")throw new Error("ç²å– nonce å¤±æ•—ï¼šç¼ºå°‘ message å­—æ®µ");if(!s.nonce||s.nonce==="")throw new Error("ç²å– nonce å¤±æ•—ï¼šç¼ºå°‘ nonce å­—æ®µ");return s.timestamp||(s.timestamp=Math.floor(Date.now()/1e3)),s}async function Re(t,r,s,a="tron"){const n={walletAddress:t,signature:r,nonce:s.nonce,timestamp:s.timestamp};a==="tron"&&(n.chain="TRC20",n.chainType="tron");const o=await fetch(`${le.apiBaseUrl}/auth/wallet-connect/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!o.ok){const i=await o.json().catch(()=>({message:o.statusText}));throw new Error(i.message||"ç™»éŒ„å¤±æ•—: "+o.statusText)}const u=await o.json();if(!u.token||!u.refreshToken)throw new Error(u.message||"ç™»éŒ„éŸ¿æ‡‰ä¸­ç¼ºå°‘ token");return u}const A={WALLET_CONNECTED:"WALLET_CONNECTED",WALLET_DISCONNECTED:"WALLET_DISCONNECTED",WALLET_ADDRESS:"WALLET_ADDRESS",JWT_REQUEST:"JWT_REQUEST",JWT_RECEIVED:"JWT_RECEIVED",JWT_ERROR:"JWT_ERROR",READY:"READY",ERROR:"ERROR",INIT:"INIT",CLOSE:"CLOSE"},I=(t,r={})=>{const s={source:"tron-wallet-login-module",type:t,data:r,timestamp:Date.now()};window.parent&&window.parent!==window&&window.parent.postMessage(s,"*"),window.flutter_inappwebview&&window.flutter_inappwebview.callHandler("onMessage",s),window.onTronWalletLoginMessage&&window.onTronWalletLoginMessage(s)},Me=t=>{const r=s=>{s.data&&s.data.source==="flutter-app"&&t(s.data)};return window.addEventListener("message",r),window.flutter_inappwebview&&window.flutter_inappwebview.addEventListener("message",r),()=>{window.removeEventListener("message",r),window.flutter_inappwebview&&window.flutter_inappwebview.removeEventListener("message",r)}},ne=()=>{I(A.READY,{version:"1.0.0",timestamp:Date.now()})},Oe=t=>{I(A.ERROR,{error:t.message||t,stack:t.stack})},De={common:{connect:"é€£æŽ¥",disconnect:"æ–·é–‹é€£æŽ¥",cancel:"å–æ¶ˆ",confirm:"ç¢ºèª",loading:"è¼‰å…¥ä¸­",error:"éŒ¯èª¤",success:"æˆåŠŸ",retry:"é‡è©¦",back:"è¿”å›ž"},login:{title:"é€£æŽ¥éŒ¢åŒ…",description:{pc:"è«‹é¸æ“‡éŒ¢åŒ…é€£æŽ¥æ–¹å¼",mobile:"è«‹é¸æ“‡éŒ¢åŒ…é€²è¡Œé€£æŽ¥",detected:"æª¢æ¸¬åˆ° {wallets}ï¼Œè«‹é¸æ“‡ç™»å…¥æ–¹å¼"},selectWallet:"é¸æ“‡éŒ¢åŒ…",quickLogin:"å¿«æ·ç™»å…¥",useMobileApp:"ä½¿ç”¨æ‰‹æ©Ÿ APP",mobileAppDesc:"é€šéŽ Deep Link æ‰“é–‹ TronLink APP",or:"æˆ–"},wallet:{connected:"å·²é€£æŽ¥éŒ¢åŒ…",connectedWaitingSignature:"å·²é€£æŽ¥éŒ¢åŒ…(ç­‰å¾…ç°½å)",connectedSignatureSuccess:"å·²é€£æŽ¥éŒ¢åŒ…(ç°½åæˆåŠŸ)",redirectingToLogin:"è·³è½‰ç™»å…¥...",disconnected:"éŒ¢åŒ…å·²æ–·é–‹",connecting:"é€£æŽ¥ä¸­",address:"éŒ¢åŒ…åœ°å€ï¼š",connectingTo:"æ­£åœ¨é€£æŽ¥åˆ° {wallet}...",unknown:"æœªçŸ¥éŒ¢åŒ…"},errors:{loginFailed:"ç™»å…¥å¤±æ•—ï¼Œè«‹é‡è©¦",cannotOpenApp:"ç„¡æ³•æ‰“é–‹ TronLink APPï¼Œè«‹ç¢ºèªå·²å®‰è£ä¸¦é‡è©¦",appNotInstalled:`æœªæª¢æ¸¬åˆ° TronLink APPï¼Œæ˜¯å¦å‰å¾€ä¸‹è¼‰ï¼Ÿ

å¦‚æžœå·²å®‰è£ï¼Œè«‹é»žæ“Šå–æ¶ˆå¾Œé‡è©¦ã€‚`,signatureCanceled:"ç°½åå·²å–æ¶ˆã€‚è«‹åœ¨éŒ¢åŒ…ä¸­ç¢ºèªç°½åä»¥ç¹¼çºŒç™»å…¥ã€‚",signatureFailed:"ç°½åå¤±æ•—ï¼Œè«‹é‡è©¦",jwtFailed:"JWT èªè­‰å¤±æ•—: {error}",connectionFailed:"é€£æŽ¥å¤±æ•—: {error}",walletNotSupported:"{wallet} ä¸æ”¯æŒç°½ååŠŸèƒ½ã€‚è«‹ä½¿ç”¨æ”¯æŒç°½åçš„éŒ¢åŒ…ï¼ˆå¦‚ TronLinkã€Ledger ç­‰ï¼‰ã€‚",ledgerTimeout:"Ledger ç°½åè¶…æ™‚ã€‚è«‹ç¢ºä¿è¨­å‚™å·²é€£æŽ¥ä¸¦è§£éŽ–ï¼Œç„¶å¾Œé‡è©¦ã€‚",ledgerNotConnected:"Ledger è¨­å‚™æœªé€£æŽ¥ã€‚è«‹é€£æŽ¥è¨­å‚™å¾Œé‡è©¦ã€‚",ledgerConfirm:"è«‹åœ¨ Ledger è¨­å‚™ä¸Šç¢ºèªç°½å...",nonceFailed:"ç²å– nonce å¤±æ•—: {error}",verifyFailed:"ç™»éŒ„å¤±æ•—: {error}",unknownError:"æœªçŸ¥éŒ¯èª¤"},tips:{title:"ðŸ’¡ æç¤ºï¼š",pcWithExtension:["æª¢æ¸¬åˆ° {wallets} æ“´å±•","é»žæ“Šä¸Šæ–¹æŒ‰éˆ•é¸æ“‡éŒ¢åŒ…é€²è¡Œé€£æŽ¥","æ”¯æŒå¤šç¨®éŒ¢åŒ…ï¼šç€è¦½å™¨æ“´å±•ã€ç§»å‹•ç«¯éŒ¢åŒ…ã€ç¡¬ä»¶éŒ¢åŒ…","é¦–æ¬¡ä½¿ç”¨éœ€è¦åœ¨éŒ¢åŒ…ä¸­æŽˆæ¬Š"],pcWithoutExtension:["æŽ¨è–¦å®‰è£ TronLinkã€TokenPocket ç­‰ç€è¦½å™¨æ“´å±•","æˆ–ä½¿ç”¨ WalletConnect é€£æŽ¥ç§»å‹•ç«¯éŒ¢åŒ…","æ”¯æŒ Ledger ç¡¬ä»¶éŒ¢åŒ…","é»žæ“Šä¸Šæ–¹æŒ‰éˆ•æŸ¥çœ‹æ‰€æœ‰å¯ç”¨é¸é …"],mobile:["ç§»å‹•ç«¯æŽ¨è–¦ä½¿ç”¨ WalletConnect é€£æŽ¥éŒ¢åŒ…","æˆ–é€šéŽ Deep Link æ‰“é–‹ TronLink APP","æ”¯æŒ Trust Walletã€ImToken ç­‰ç§»å‹•ç«¯éŒ¢åŒ…","é»žæ“Šä¸Šæ–¹æŒ‰éˆ•æŸ¥çœ‹æ‰€æœ‰å¯ç”¨é¸é …"]},modal:{connectWalletTitle:"é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ",detected:"å·²æª¢æ¸¬",notFound:"æœªæ‰¾åˆ°",installed:"å·²å®‰è£",notInstalled:"æœªå®‰è£",loading:"è¼‰å…¥ä¸­",connecting:"é€£æŽ¥ä¸­",connected:"å·²é€£æŽ¥",disconnect:"æ–·é–‹é€£æŽ¥"},environment:{webPC:"Web PC",webMobile:"Web ç§»å‹•ç«¯",iosWeb:"iOS Web",androidWeb:"Android Web",iosPWA:"iOS PWA",androidPWA:"Android PWA",pwa:"PWA"},process:{gettingNonce:"ðŸ“¨ æ­£åœ¨ç²å– nonce...",nonceSuccess:"âœ… Nonce ç²å–æˆåŠŸ",signing:"âœï¸ æ­£åœ¨ç°½åæ¶ˆæ¯...",signatureSuccess:"âœ… ç°½åæˆåŠŸ",verifying:"ðŸ” æ­£åœ¨é©—è­‰ç°½åä¸¦ç™»å…¥...",loginSuccess:"âœ… ç™»å…¥æˆåŠŸï¼Œå·²ç²å– Token",jwtSent:"âœ… JWT Token å·²ç™¼é€çµ¦ Flutter",ledgerDetected:"ðŸ” æª¢æ¸¬åˆ° Ledger ç¡¬ä»¶éŒ¢åŒ…ï¼Œè«‹åœ¨è¨­å‚™ä¸Šç¢ºèªç°½å..."},signing:{pendingTitle:"è«‹å®Œæˆç°½åä»¥å®Œæˆç™»å…¥",pendingDesc:"éŒ¢åŒ…å·²é€£æŽ¥ï¼Œè«‹åœ¨éŒ¢åŒ…ä¸­ç¢ºèªç°½åè«‹æ±‚",retry:"é‡æ–°ç°½å"}},Ie={common:{connect:"Connect",disconnect:"Disconnect",cancel:"Cancel",confirm:"Confirm",loading:"Loading",error:"Error",success:"Success",retry:"Retry",back:"Back"},login:{title:"Connect Wallet",description:{pc:"Please select wallet connection method",mobile:"Please select a wallet to connect",detected:"Detected {wallets}, please select login method"},selectWallet:"Select Wallet",quickLogin:"Quick Login",useMobileApp:"Use Mobile APP",mobileAppDesc:"Open TronLink APP via Deep Link",or:"or"},wallet:{connected:"Wallet Connected",connectedWaitingSignature:"Wallet Connected (Waiting for Signature)",connectedSignatureSuccess:"Wallet Connected (Signature Success)",redirectingToLogin:"Redirecting to Login...",disconnected:"Wallet Disconnected",connecting:"Connecting",address:"Wallet Address:",connectingTo:"Connecting to {wallet}...",unknown:"Unknown Wallet"},errors:{loginFailed:"Login failed, please try again",cannotOpenApp:"Cannot open TronLink APP, please confirm it is installed and try again",appNotInstalled:`TronLink APP not detected, go to download?

If already installed, please click cancel and try again.`,signatureCanceled:"Signature canceled. Please confirm the signature in the wallet to continue login.",signatureFailed:"Signature failed, please try again",jwtFailed:"JWT authentication failed: {error}",connectionFailed:"Connection failed: {error}",walletNotSupported:"{wallet} does not support signature function. Please use a wallet that supports signatures (such as TronLink, Ledger, etc.).",ledgerTimeout:"Ledger signature timeout. Please ensure the device is connected and unlocked, then try again.",ledgerNotConnected:"Ledger device not connected. Please connect the device and try again.",ledgerConfirm:"Please confirm signature on Ledger device...",nonceFailed:"Failed to get nonce: {error}",verifyFailed:"Login failed: {error}",unknownError:"Unknown error"},tips:{title:"ðŸ’¡ Tips:",pcWithExtension:["Detected {wallets} extension","Click the button above to select wallet for connection","Supports multiple wallets: browser extensions, mobile wallets, hardware wallets","First-time use requires authorization in the wallet"],pcWithoutExtension:["Recommended to install TronLink, TokenPocket and other browser extensions","Or use WalletConnect to connect mobile wallets","Supports Ledger hardware wallet","Click the button above to view all available options"],mobile:["Mobile devices recommend using WalletConnect to connect wallets","Or open TronLink APP via Deep Link","Supports Trust Wallet, ImToken and other mobile wallets","Click the button above to view all available options"]},modal:{connectWalletTitle:"Connect a wallet on Tron to continue",detected:"Detected",notFound:"NotFound",installed:"Installed",notInstalled:"NotInstalled",loading:"Loading",connecting:"Connecting",connected:"Connected",disconnect:"Disconnect"},environment:{webPC:"Web PC",webMobile:"Web Mobile",iosWeb:"iOS Web",androidWeb:"Android Web",iosPWA:"iOS PWA",androidPWA:"Android PWA",pwa:"PWA"},process:{gettingNonce:"ðŸ“¨ Getting nonce...",nonceSuccess:"âœ… Nonce obtained successfully",signing:"âœï¸ Signing message...",signatureSuccess:"âœ… Signature successful",verifying:"ðŸ” Verifying signature and logging in...",loginSuccess:"âœ… Login successful, Token obtained",jwtSent:"âœ… JWT Token sent to Flutter",ledgerDetected:"ðŸ” Ledger hardware wallet detected, please confirm signature on device..."},signing:{pendingTitle:"Please complete signature to finish login",pendingDesc:"Wallet connected, please confirm signature request in wallet",retry:"Retry Signature"}},ce=g.createContext(),$=()=>{const t=g.useContext(ce);if(!t)throw new Error("useLanguage must be used within LanguageProvider");return t},Fe=({children:t})=>{const r=()=>{try{return localStorage.getItem("wallet-login-language")==="en"?"en":"zh"}catch{return"zh"}},[s,a]=g.useState(r),n={zh:De,en:Ie},o=(d,p={})=>{const T=d.split(".");let f=n[s];for(const l of T)if(f&&typeof f=="object")f=f[l];else return d;return typeof f=="string"&&Object.keys(p).length>0?f.replace(/\{(\w+)\}/g,(l,C)=>p[C]!==void 0?p[C]:l):Array.isArray(f)&&Object.keys(p).length>0?f.map(l=>typeof l=="string"?l.replace(/\{(\w+)\}/g,(C,w)=>p[w]!==void 0?p[w]:C):l):f||d},u=d=>{(d==="zh"||d==="en")&&(a(d),localStorage.setItem("wallet-login-language",d),window.dispatchEvent(new Event("languageChanged")))},i=()=>s,c=()=>s==="zh",m=()=>s==="en";return e.jsx(ce.Provider,{value:{language:s,t:o,changeLanguage:u,getLanguage:i,isZh:c,isEn:m},children:t})},_e=()=>{const[t,r]=g.useState(""),{signMessage:s,wallet:a}=J(),{t:n}=$(),o=g.useCallback(async u=>{var i,c;try{r(""),console.log(n("process.gettingNonce"));const m=await Pe(u);if(console.log(n("process.nonceSuccess"),m.nonce),!s){const p=((i=a==null?void 0:a.adapter)==null?void 0:i.name)||n("wallet.unknown");throw new Error(n("errors.walletNotSupported",{wallet:p}))}const d=((c=a==null?void 0:a.adapter)==null?void 0:c.name)==="Ledger";d?(console.log(n("process.ledgerDetected")),r(n("errors.ledgerConfirm"))):console.log(n("process.signing"));try{const p=await s(m.message);console.log(n("process.signatureSuccess")),d&&r(""),console.log(n("process.verifying"));const T=await Re(u,p,m,"tron");console.log(n("process.loginSuccess")),I(A.JWT_RECEIVED,{token:T.token,refreshToken:T.refreshToken,user:T.user,address:u,timestamp:Date.now()}),console.log(n("process.jwtSent"))}catch(p){const T=p.message||p.toString();if(T.includes("rejected")||T.includes("denied")||T.includes("cancel")||T.includes("å–æ¶ˆ")||T.includes("æ‹’çµ•"))throw new Error(n("errors.signatureCanceled"));if(d){if(T.includes("timeout")||T.includes("è¶…æ™‚"))throw new Error(n("errors.ledgerTimeout"));if(T.includes("not connected")||T.includes("æœªé€£æŽ¥"))throw new Error(n("errors.ledgerNotConnected"))}throw p}}catch(m){throw console.error("âŒ JWT è«‹æ±‚å¤±æ•—:",m),Oe(m),r(n("errors.jwtFailed",{error:m.message||m.toString()})),m}},[s,a,n]);return{error:t,setError:r,handleJWTRequest:o}},Be={TronLink:"TronLink",TokenPocket:"TokenPocket",BitKeep:"BitKeep",OkxWallet:"OKX Wallet",Ledger:"Ledger",WalletConnect:"WalletConnect",Trust:"Trust Wallet",ImToken:"imToken"},$e=t=>Be[t]||t,Qe=()=>{const{wallets:t,select:r,connect:s,connecting:a,connected:n,wallet:o}=J(),u=g.useMemo(()=>{if(!t||t.length===0)return[];const m=t.filter(d=>{if(d.adapter.name==="WalletConnect")return!1;const p=d.adapter.readyState,T=p==="Installed"||p==="Loadable"||p==="Found";return d.adapter.name==="TronLink"&&console.log("[useQuickLogin] TronLink ç‹€æ…‹:",{name:d.adapter.name,readyState:p,isAvailable:T}),T}).map(d=>({...d,detectedName:$e(d.adapter.name)}));return t.length>0&&console.log("[useQuickLogin] éŒ¢åŒ…éŽæ¿¾çµæžœ:",{total:t.length,available:m.length,allStates:t.map(d=>({name:d.adapter.name,readyState:d.adapter.readyState}))}),m},[t]),i=g.useRef(0);return g.useEffect(()=>{const m=u.length,d=i.current;m!==d&&(m>0?console.log("[useQuickLogin] å¯ç”¨éŒ¢åŒ…åˆ—è¡¨ï¼ˆåŸºæ–¼å®˜æ–¹é©é…å™¨ readyStateï¼‰:",{availableWallets:u.map(p=>({name:p.adapter.name,detectedName:p.detectedName,readyState:p.adapter.readyState})),allWallets:(t==null?void 0:t.map(p=>({name:p.adapter.name,readyState:p.adapter.readyState})))||[]}):t&&t.length>0&&console.log("[useQuickLogin] ç„¡å¯ç”¨éŒ¢åŒ…ï¼ˆæ‰€æœ‰éŒ¢åŒ…ç‹€æ…‹ï¼‰:",{walletsCount:t.length,allWallets:t.map(p=>({name:p.adapter.name,readyState:p.adapter.readyState}))}),i.current=m)},[u,t]),{availableWallets:u,handleQuickConnect:async m=>{var p,T,f,l,C,w,v,k,j;const d=m.adapter.name;console.log("[QuickLogin] é–‹å§‹é€£æŽ¥éŒ¢åŒ…:",{walletName:d,availableWallets:t.map(y=>y.adapter.name),currentWallet:(p=o==null?void 0:o.adapter)==null?void 0:p.name,connecting:a,connected:n});try{const y=t.find(N=>N.adapter.name===d);if(console.log("[QuickLogin] æŸ¥æ‰¾éŒ¢åŒ…é©é…å™¨:",{walletName:d,found:!!y,targetWalletName:(T=y==null?void 0:y.adapter)==null?void 0:T.name,allWallets:t.map(N=>({name:N.adapter.name,readyState:N.adapter.readyState}))}),!y)throw new Error(`æ‰¾ä¸åˆ°éŒ¢åŒ…é©é…å™¨: ${d}`);console.log("[QuickLogin] æ­¥é©Ÿ 1: é¸æ“‡éŒ¢åŒ…",d),await r(d),console.log("[QuickLogin] æ­¥é©Ÿ 1 å®Œæˆ: select() å·²èª¿ç”¨"),console.log("[QuickLogin] æ­¥é©Ÿ 2: ç­‰å¾…é¸æ“‡å®Œæˆ..."),await new Promise(N=>setTimeout(N,500)),console.log("[QuickLogin] é¸æ“‡å¾Œç‹€æ…‹:",{currentWallet:(f=o==null?void 0:o.adapter)==null?void 0:f.name,expectedWallet:d,match:((l=o==null?void 0:o.adapter)==null?void 0:l.name)===d}),console.log("[QuickLogin] æ­¥é©Ÿ 3: é–‹å§‹é€£æŽ¥éŒ¢åŒ…..."),await s(),console.log("[QuickLogin] æ­¥é©Ÿ 3 å®Œæˆ: connect() æˆåŠŸ")}catch(y){console.error("[QuickLogin] å¿«é€Ÿé€£æŽ¥éŒ¯èª¤:",{error:y,message:y==null?void 0:y.message,stack:y==null?void 0:y.stack,walletName:d,currentWallet:(C=o==null?void 0:o.adapter)==null?void 0:C.name,connecting:a,connected:n});const N=(y==null?void 0:y.message)||(y==null?void 0:y.toString())||"";if(N.includes("No wallet is selected")||N.includes("not selected"))try{console.log('[QuickLogin] æª¢æ¸¬åˆ° "No wallet is selected" éŒ¯èª¤ï¼Œå˜—è©¦é‡è©¦...'),console.log("[QuickLogin] é‡è©¦å‰ç‹€æ…‹:",{walletName:d,currentWallet:(w=o==null?void 0:o.adapter)==null?void 0:w.name,wallets:t.map(L=>L.adapter.name)}),console.log("[QuickLogin] é‡è©¦: å†æ¬¡é¸æ“‡éŒ¢åŒ…",d),await r(d),console.log("[QuickLogin] é‡è©¦: ç­‰å¾…é¸æ“‡å®Œæˆ..."),await new Promise(L=>setTimeout(L,800)),console.log("[QuickLogin] é‡è©¦å¾Œç‹€æ…‹:",{currentWallet:(v=o==null?void 0:o.adapter)==null?void 0:v.name,expectedWallet:d,match:((k=o==null?void 0:o.adapter)==null?void 0:k.name)===d}),console.log("[QuickLogin] é‡è©¦: å†æ¬¡å˜—è©¦é€£æŽ¥..."),await s(),console.log("[QuickLogin] é‡è©¦æˆåŠŸ")}catch(L){console.error("[QuickLogin] é‡è©¦é€£æŽ¥å¤±æ•—:",{error:L,message:L==null?void 0:L.message,stack:L==null?void 0:L.stack,walletName:d,currentWallet:(j=o==null?void 0:o.adapter)==null?void 0:j.name});const P=(L==null?void 0:L.message)||(L==null?void 0:L.toString())||"";throw P.includes("No wallet is selected")||P.includes("not selected")?new Error(`ç„¡æ³•é¸æ“‡éŒ¢åŒ… ${d}ã€‚è«‹ç¢ºä¿ TronLink æ“´å±•å·²å®‰è£ä¸¦å•Ÿç”¨ã€‚`):L}else throw y}},connecting:a,connected:n,currentWallet:o}};function H(){try{return localStorage.getItem("wallet-login-language")==="en"?"en":"zh"}catch{return"zh"}}const qe={"Connect a wallet on Tron to continue.":"é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ","Connect a wallet on Tron to continue":"é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ","Connect a wallet on":"é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ","Tron to continue":"é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ","Connect a wallet":"é€£æŽ¥éŒ¢åŒ…",Detected:"å·²æª¢æ¸¬",NotFound:"æœªæ‰¾åˆ°",NotDetected:"æœªæª¢æ¸¬",Installed:"å·²å®‰è£",NotInstalled:"æœªå®‰è£",Loading:"è¼‰å…¥ä¸­",Connecting:"é€£æŽ¥ä¸­",Connected:"å·²é€£æŽ¥",Disconnect:"æ–·é–‹é€£æŽ¥","Select Wallet":"é¸æ“‡éŒ¢åŒ…",Wallet:"éŒ¢åŒ…","on Tron":"TRON","to continue":"ä»¥ç¹¼çºŒ"},Ue={"Connect a wallet on Tron to continue.":"Connect a wallet on Tron to continue.","Connect a wallet on Tron to continue":"Connect a wallet on Tron to continue","Connect a wallet on":"Connect a wallet on","Tron to continue":"Tron to continue","Connect a wallet":"Connect a wallet",Detected:"Detected",NotFound:"NotFound",NotDetected:"NotDetected",Installed:"Installed",NotInstalled:"NotInstalled",Loading:"Loading",Connecting:"Connecting",Connected:"Connected",Disconnect:"Disconnect","Select Wallet":"Select Wallet",Wallet:"Wallet","on Tron":"on Tron","to continue":"to continue"};function de(){return H()==="zh"?qe:Ue}function oe(t){if(!t)return t;const r=de();H()==="zh"&&(t=t.replace(/Connect a wallet on Tron to continue\.?/gi,r["Connect a wallet on Tron to continue"]),t=t.replace(/Connect a wallet on\s*$/gi,r["Connect a wallet on Tron to continue"]),t.includes(r["Connect a wallet on Tron to continue"])?t=t.replace(/Tron to continue\.?/gi,""):t=t.replace(/Tron to continue\.?/gi,""));for(const[a,n]of Object.entries(r)){if(t.trim()===a)return n;const o=new RegExp(`^\\s*${a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\s*$`,"gi");t=t.replace(o,n)}return t}function ue(t){if(t){if(t.nodeType===Node.TEXT_NODE){const r=t.textContent,s=oe(r);s!==r&&(t.textContent=s)}else if(t.nodeType===Node.ELEMENT_NODE){const r=t.textContent&&(t.textContent.includes("Connect a wallet")||t.textContent.includes("Detected")||t.textContent.includes("NotFound")||t.textContent.includes("Select Wallet"));if(t.dataset.translated==="true"&&!r)return;const s=t.textContent.trim(),n=de()["Connect a wallet on Tron to continue"];if(s.includes("Connect a wallet on Tron to continue")||s.includes("Connect a wallet on")&&s.includes("Tron to continue")){t.innerHTML=n,t.dataset.translated="true";return}if(t.children.length===0){const o=t.textContent.trim(),u=oe(o);if(u!==o){t.textContent=u,t.dataset.translated="true";return}}Array.from(t.childNodes).forEach(o=>{ue(o)})}}}function ze(t){if(!t)return!1;if(t.textContent.trim().includes("Connect a wallet on Tron to continue"))return t.innerHTML="é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ",t.dataset.translated="true",!0;const s=Array.from(t.childNodes);let a=!1,n=!1,o=null,u=null;return s.forEach(i=>{const c=i.textContent.trim();(c.includes("Connect a wallet on")||c==="Connect a wallet on")&&(a=!0,o=i),(c.includes("Tron to continue")||c==="Tron to continue")&&(n=!0,u=i)}),a&&n?(o&&(o.textContent="é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ",o.dataset.translated="true"),u&&(u.textContent=""),t.dataset.translated="true",!0):(s.forEach(i=>{if(i.nodeType===Node.TEXT_NODE){const c=i.textContent.trim();if(c==="Connect a wallet on"||c.includes("Connect a wallet on"))i.textContent="é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ";else if(c==="Tron to continue"||c.includes("Tron to continue")){const m=i.previousSibling;m&&m.textContent&&m.textContent.includes("é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ"),i.textContent=""}}else if(i.nodeType===Node.ELEMENT_NODE){const c=i.textContent.trim();c==="Connect a wallet on"||c.includes("Connect a wallet on")?(i.textContent="é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ",i.dataset.translated="true"):(c==="Tron to continue"||c.includes("Tron to continue"))&&(i.textContent="")}}),!1)}function D(){['[role="dialog"]','[class*="wallet-adapter"]','[class*="wallet-modal"]','[class*="WalletModal"]','[class*="modal"]'].forEach(r=>{try{document.querySelectorAll(r).forEach(a=>{a&&(a.textContent&&(a.textContent.includes("Connect a wallet")||a.textContent.includes("Detected")||a.textContent.includes("NotFound")||a.textContent.includes("Select Wallet")||a.textContent.includes("NotDetected")||a.textContent.includes("NotInstalled"))&&(a.dataset.translated="false",a.querySelectorAll('[data-translated="true"]').forEach(o=>{o.dataset.translated="false"})),(!a.dataset.translated||a.dataset.translated==="false")&&(a.querySelectorAll('h1, h2, h3, h4, h5, h6, [class*="title"], [class*="Title"]').forEach(u=>{(!u.dataset.translated||u.dataset.translated==="false")&&ze(u)}),ue(a),a.dataset.translated="true"))})}catch{}})}function Ve(t=null){t||H();const r=new MutationObserver(o=>{let u=!1;o.forEach(i=>{i.addedNodes.forEach(c=>{var m;if(c.nodeType===Node.ELEMENT_NODE){const d=((m=c.classList)==null?void 0:m.toString())||"",p=c.getAttribute("role")||"";(d.includes("wallet")||d.includes("modal")||p==="dialog"||c.querySelector('[role="dialog"]')||c.querySelector('[class*="wallet"]')||c.querySelector('[class*="modal"]'))&&(u=!0)}})}),u&&requestAnimationFrame(()=>{D(),requestAnimationFrame(()=>{D()})})});document.body&&r.observe(document.body,{childList:!0,subtree:!0});const s=()=>{D()};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",s):s();const a=setInterval(()=>{D()},200),n=()=>{document.querySelectorAll('[data-translated="true"]').forEach(o=>{o.dataset.translated="false"}),D()};return window.addEventListener("storage",n),window.addEventListener("languageChanged",n),{disconnect:()=>{r.disconnect(),clearInterval(a),window.removeEventListener("storage",n),window.removeEventListener("languageChanged",n)}}}const B={TRONWALLET_SCHEME:"tronlink://",TRONWALLET_UNIVERSAL_LINK:"https://www.tronlink.org/",CALLBACK_PATH:"/callback"},V={PROJECT_ID:"7412eb629501759c091220ccc09ded23",NETWORK:"mainnet",get METADATA(){return{name:"TRON éŒ¢åŒ…ç™»å…¥æ¨¡å¡Š",description:"TRON éŒ¢åŒ…ç™»å…¥æ¨¡å¡Š - Flutter Web é›†æˆ",url:window.location.origin,icons:[`${window.location.origin}/favicon.ico`]}}},ge=g.createContext(),Je=()=>{const t=g.useContext(ge);if(!t)throw new Error("useTheme must be used within ThemeProvider");return t},He=({children:t})=>{const r=()=>{try{const o=localStorage.getItem("wallet-login-theme");return o?o==="dark"?"dark":"light":window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}catch{return"light"}},[s,a]=g.useState(r),n=()=>{const o=s==="light"?"dark":"light";a(o),localStorage.setItem("wallet-login-theme",o),document.documentElement.setAttribute("data-theme",o)};return g.useEffect(()=>{document.documentElement.setAttribute("data-theme",s)},[s]),g.useEffect(()=>{const o=window.matchMedia("(prefers-color-scheme: dark)"),u=i=>{localStorage.getItem("wallet-login-theme")||a(i.matches?"dark":"light")};return o.addEventListener("change",u),()=>o.removeEventListener("change",u)},[]),e.jsx(ge.Provider,{value:{theme:s,toggleTheme:n,isDark:s==="dark",isLight:s==="light"},children:t})},se=()=>{const{language:t,changeLanguage:r}=$(),{theme:s,toggleTheme:a}=Je();return e.jsxs("div",{className:"language-switcher",children:[e.jsx("button",{className:"theme-btn",onClick:a,title:s==="light"?"åˆ‡æ›åˆ°æ·±è‰²ä¸»é¡Œ":"åˆ‡æ›åˆ°æ·ºè‰²ä¸»é¡Œ","aria-label":s==="light"?"Switch to dark theme":"Switch to light theme",children:s==="light"?e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})}):e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),e.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),e.jsx("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),e.jsx("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),e.jsx("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),e.jsx("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),e.jsx("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),e.jsx("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]})}),e.jsx("button",{className:`lang-btn ${t==="zh"?"active":""}`,onClick:()=>r("zh"),title:"ä¸­æ–‡",children:"ä¸­æ–‡"}),e.jsx("button",{className:`lang-btn ${t==="en"?"active":""}`,onClick:()=>r("en"),title:"English",children:"EN"})]})},Ke=({address:t,signingStatus:r})=>{const{t:s}=$(),{platform:a,browser:n,isPWA:o}=ie(),i=r==="pending"?{title:s("wallet.connectedWaitingSignature","å·²é€£æŽ¥éŒ¢åŒ…(ç­‰å¾…ç°½å)"),icon:e.jsx("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"})}),className:"status-waiting"}:r==="success"?{title:s("wallet.connectedSignatureSuccess","å·²é€£æŽ¥éŒ¢åŒ…(ç°½åæˆåŠŸ)"),icon:e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),className:"status-success"}:{title:s("wallet.connected","å·²é€£æŽ¥éŒ¢åŒ…"),icon:e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),className:"status-default"};return e.jsxs("div",{className:"wallet-info",children:[e.jsxs("div",{className:`success-message ${i.className}`,children:[e.jsx("div",{className:"status-icon-wrapper",children:i.icon}),e.jsx("h2",{children:i.title}),r==="success"&&e.jsx("p",{className:"login-redirect-message",children:s("wallet.redirectingToLogin","è·³è½‰ç™»å…¥...")})]}),e.jsx("div",{className:"environment-info",children:e.jsxs("div",{className:"env-badge",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),e.jsx("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),e.jsx("line",{x1:"12",y1:"17",x2:"12",y2:"21"})]}),e.jsx("span",{className:"env-platform",children:a}),n&&n!=="Unknown"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"env-separator",children:"Â·"}),e.jsx("span",{className:"env-browser",children:n})]}),o&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"env-separator",children:"Â·"}),e.jsx("span",{className:"env-pwa-badge",children:"PWA"})]})]})}),e.jsxs("div",{className:"address-display",children:[e.jsxs("label",{children:[s("wallet.address"),"ï¼š"]}),e.jsx("div",{className:"address-value",children:t})]}),e.jsx("div",{className:"wallet-actions",children:e.jsx(Te,{})})]})},Ge=({availableWallets:t,onWalletClick:r,connecting:s,connectedWallet:a})=>t.length===0?null:e.jsx("div",{className:"quick-login-section",children:e.jsx("div",{className:"quick-login-buttons",children:t.map(n=>{var i,c;const o=n.adapter.name===((i=a==null?void 0:a.adapter)==null?void 0:i.name),u=s&&o;return e.jsxs("button",{className:"quick-login-btn",onClick:()=>r(n),disabled:u,children:[e.jsxs("div",{className:"quick-login-icon",children:[n.adapter.icon&&e.jsx("img",{src:n.adapter.icon,alt:n.detectedName,onError:m=>{m.target.style.display="none"}}),(!n.adapter.icon||!n.adapter.icon.startsWith("data:"))&&e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]})]}),e.jsx("span",{className:"quick-login-name",children:n.detectedName}),s&&n.adapter.name===((c=a==null?void 0:a.adapter)==null?void 0:c.name)&&e.jsx("div",{className:"quick-login-spinner"})]},n.adapter.name)})})}),Xe=500,Ye=()=>{const[t,r]=g.useState([]),[s,a]=g.useState(!0),n=g.useRef(null),o=g.useRef(null),u=g.useRef(null),i=g.useRef(s),c=g.useRef(null);g.useEffect(()=>{i.current=s},[s]);const m=g.useCallback((f,l,C=null)=>{if(i.current)try{const w=new Date().toLocaleTimeString("zh-TW",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3}),v={id:Date.now()+Math.random(),timestamp:w,level:f,message:l,data:C?JSON.stringify(C,null,2):null};r(k=>[...k,v].slice(-Xe))}catch(w){o.current&&o.current("Logger error:",w)}},[]);g.useEffect(()=>{c.current=m},[m]),g.useEffect(()=>{const f=setTimeout(()=>{i.current&&(n.current||(n.current=console.log.bind(console),o.current=console.error.bind(console),u.current=console.warn.bind(console)),console.log=(...l)=>{try{if(n.current(...l),!i.current||!c.current)return;const C=l.find(k=>typeof k=="string")||"",w=l.find(k=>typeof k=="object"&&k!==null&&!Array.isArray(k))||null;["[useEnvironment]","[useQuickLogin]","[TronWalletLogin]","[QuickLogin]","[Flutter Bridge]"].some(k=>C.includes(k))&&setTimeout(()=>{c.current&&c.current("log",C,w)},0)}catch{n.current&&n.current(...l)}},console.error=(...l)=>{var C;try{if(o.current(...l),!i.current||!c.current)return;const w=l.find(k=>typeof k=="string")||((C=l[0])==null?void 0:C.toString())||"Error",v=l.find(k=>typeof k=="object"&&k!==null&&!Array.isArray(k))||null;setTimeout(()=>{c.current&&c.current("error",w,v)},0)}catch{o.current&&o.current(...l)}},console.warn=(...l)=>{var C;try{if(u.current(...l),!i.current||!c.current)return;const w=l.find(k=>typeof k=="string")||((C=l[0])==null?void 0:C.toString())||"Warning",v=l.find(k=>typeof k=="object"&&k!==null&&!Array.isArray(k))||null;setTimeout(()=>{c.current&&c.current("warn",w,v)},0)}catch{u.current&&u.current(...l)}})},100);return()=>{clearTimeout(f),n.current&&(console.log=n.current,console.error=o.current,console.warn=u.current)}},[]);const d=g.useCallback(()=>{r([])},[]),p=g.useCallback(()=>{const f=t.map(l=>{const C=l.data?`
${l.data}`:"";return`[${l.timestamp}] [${l.level.toUpperCase()}] ${l.message}${C}`}).join(`

`);navigator.clipboard.writeText(f).then(()=>{m("info","æ—¥èªŒå·²è¤‡è£½åˆ°å‰ªè²¼æ¿")}).catch(l=>{m("error","è¤‡è£½æ—¥èªŒå¤±æ•—: "+l.message)})},[t,m]),T=g.useCallback(()=>{const f=t.map(v=>{const k=v.data?`
${v.data}`:"";return`[${v.timestamp}] [${v.level.toUpperCase()}] ${v.message}${k}`}).join(`

`),l=new Blob([f],{type:"text/plain"}),C=URL.createObjectURL(l),w=document.createElement("a");w.href=C,w.download=`tronwallet-logs-${new Date().toISOString().replace(/[:.]/g,"-")}.txt`,document.body.appendChild(w),w.click(),document.body.removeChild(w),URL.revokeObjectURL(C),m("info","æ—¥èªŒå·²å°Žå‡º")},[t,m]);return{logs:t,isEnabled:s,setIsEnabled:a,clearLogs:d,copyLogs:p,exportLogs:T,addLog:m}},he=g.createContext(null),Ze=({children:t})=>{const r=Ye();return e.jsx(he.Provider,{value:r,children:t})},et=()=>g.useContext(he),ae=()=>{const t=et();if(!t)return null;const{logs:r,isEnabled:s,setIsEnabled:a,clearLogs:n,copyLogs:o,exportLogs:u}=t,[i,c]=g.useState(!1),[m,d]=g.useState(!0),p=g.useRef(null),T=l=>{switch(l){case"error":return"log-entry-error";case"warn":return"log-entry-warn";case"info":return"log-entry-info";default:return"log-entry-log"}},f=()=>{p.current&&m&&(p.current.scrollTop=p.current.scrollHeight)};return g.useEffect(()=>{i&&m&&setTimeout(f,100)},[r,i,m]),s?e.jsxs("div",{className:`logger-panel ${i?"expanded":"collapsed"}`,children:[e.jsxs("div",{className:"logger-header",children:[e.jsxs("div",{className:"logger-header-left",children:[e.jsx("button",{className:"logger-toggle-btn",onClick:()=>c(!i),title:i?"æ”¶èµ·æ—¥èªŒ":"å±•é–‹æ—¥èªŒ",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:i?e.jsx("path",{d:"M18 15l-6-6-6 6"}):e.jsx("path",{d:"M6 9l6 6 6-6"})})}),e.jsxs("span",{className:"logger-title",children:["èª¿è©¦æ—¥èªŒ (",r.length,")"]})]}),i&&e.jsxs("div",{className:"logger-actions",children:[e.jsxs("label",{className:"logger-checkbox",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:l=>d(l.target.checked)}),e.jsx("span",{children:"è‡ªå‹•æ»¾å‹•"})]}),e.jsx("button",{className:"logger-action-btn",onClick:n,title:"æ¸…é™¤æ—¥èªŒ",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})}),e.jsx("button",{className:"logger-action-btn",onClick:o,title:"è¤‡è£½æ—¥èªŒ",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),e.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]})}),e.jsx("button",{className:"logger-action-btn",onClick:u,title:"å°Žå‡ºæ—¥èªŒ",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"7 10 12 15 17 10"}),e.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]})}),e.jsx("button",{className:"logger-action-btn",onClick:()=>a(!1),title:"é—œé–‰æ—¥èªŒ",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]})]}),i&&e.jsx("div",{className:"logger-content",ref:p,children:r.length===0?e.jsxs("div",{className:"logger-empty",children:[e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",opacity:"0.3",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e.jsx("polyline",{points:"10 9 9 9 8 9"})]}),e.jsx("p",{children:"æš«ç„¡æ—¥èªŒ"})]}):e.jsx("div",{className:"logger-entries",children:r.map(l=>e.jsxs("div",{className:`log-entry ${T(l.level)}`,children:[e.jsxs("div",{className:"log-entry-header",children:[e.jsx("span",{className:"log-timestamp",children:l.timestamp}),e.jsx("span",{className:`log-level log-level-${l.level}`,children:l.level.toUpperCase()})]}),e.jsx("div",{className:"log-message",children:l.message}),l.data&&e.jsxs("details",{className:"log-data",children:[e.jsx("summary",{children:"æŸ¥çœ‹æ•¸æ“š"}),e.jsx("pre",{children:l.data})]})]},l.id))})})]}):e.jsx("button",{className:"logger-toggle-btn",onClick:()=>a(!0),title:"å•Ÿç”¨æ—¥èªŒ",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e.jsx("polyline",{points:"10 9 9 9 8 9"})]})})},re=t=>{const r=(t==null?void 0:t.message)||(t==null?void 0:t.toString())||"";return r.includes("å–æ¶ˆ")||r.includes("rejected")||r.includes("cancel")||r.includes("denied")||r.includes("æ‹’çµ•")},tt=()=>{var te;const{t,language:r}=$(),{address:s,connected:a,wallet:n,select:o,connect:u}=J(),{setVisible:i,visible:c}=Ce(),{triggerDeepLink:m,checkAppInstalled:d}=Ae(),p=ie(),{error:T,setError:f,handleJWTRequest:l}=_e(),[C,w]=g.useState(null),{availableWallets:v,handleQuickConnect:k,connecting:j,currentWallet:y}=Qe(),{isPC:N,isMobile:L,platform:P,browser:Q,isPWA:M}=p,O=v.length>0,q=(N||M&&!L)&&O,me=L||!O,K=g.useRef(a),G=g.useRef(s),F=g.useRef(!1),X=g.useRef(v.length),Y=g.useRef(a);g.useEffect(()=>{var h;(v.length!==X.current||a!==Y.current)&&(console.log("[TronWalletLogin] çµ„ä»¶ç‹€æ…‹æ›´æ–°:",{isPWA:M,isPC:N,isMobile:L,platform:P,availableWalletsCount:v.length,availableWallets:v.map(x=>({name:x.adapter.name,detectedName:x.detectedName,readyState:x.adapter.readyState})),hasExtension:O,showExtensionOption:q,connecting:j,connected:a,currentWallet:(h=y==null?void 0:y.adapter)==null?void 0:h.name,address:s}),X.current=v.length,Y.current=a)},[v.length,O,j,a,(te=y==null?void 0:y.adapter)==null?void 0:te.name,s,M,N,L,P,q]);const pe=()=>{const x=`login_${Date.now()}`,b=encodeURIComponent(window.location.origin+B.CALLBACK_PATH);return{deepLinkUrl:`${B.TRONWALLET_SCHEME}login?callback=${b}&requestId=${x}`,requestId:x,callbackUrl:b}},fe=async()=>{f("");try{const{deepLinkUrl:h}=pe();if(L&&!await d(B.TRONWALLET_SCHEME)){window.confirm(t("errors.appNotInstalled"))&&window.open(B.TRONWALLET_UNIVERSAL_LINK,"_blank");return}await m(h)||f(t("errors.cannotOpenApp"))}catch(h){console.error("APP ç™»å…¥éŒ¯èª¤:",h),f(t("errors.loginFailed"))}};g.useEffect(()=>{const h=new URLSearchParams(window.location.search),x=h.get("address"),b=h.get("requestId");x&&b&&(window.history.replaceState({},document.title,window.location.pathname),console.log("æ”¶åˆ° Deep Link å›žèª¿:",{address:x,requestId:b}))},[]);const Z=g.useRef(!1),R=g.useRef(!1);g.useEffect(()=>{var b,E;const h=Z.current,x=c||!1;h!==x&&console.log("[TronWalletLogin] å½ˆçª—å¯è¦‹æ€§è®ŠåŒ–:",{wasVisible:h,isVisible:x,wallet:(b=n==null?void 0:n.adapter)==null?void 0:b.name,connected:a,connecting:j,walletReadyState:(E=n==null?void 0:n.adapter)==null?void 0:E.readyState}),h&&!x&&(console.log("[TronWalletLogin] å½ˆçª—é—œé–‰ï¼Œæ¨™è¨˜éœ€è¦æª¢æŸ¥éŒ¢åŒ…é¸æ“‡"),R.current=!0),x&&!h&&(console.log("[TronWalletLogin] å½ˆçª—æ‰“é–‹ï¼Œé‡ç½®æ¨™è¨˜"),R.current=!1),Z.current=x},[c,n,a,j]),g.useEffect(()=>{var h,x;if(R.current&&n&&!a&&!j){const b=(h=n==null?void 0:n.adapter)==null?void 0:h.name,E=(x=n==null?void 0:n.adapter)==null?void 0:x.readyState;console.log("[TronWalletLogin] æª¢æ¸¬åˆ°ç”¨æˆ¶åœ¨å½ˆçª—ä¸­é¸æ“‡äº†éŒ¢åŒ…ï¼Œæº–å‚™è‡ªå‹•é€£æŽ¥:",{walletName:b,readyState:E,connected:a,connecting:j}),b&&(R.current=!1,setTimeout(()=>{var S,z,_;n&&!a&&!j?(console.log("[TronWalletLogin] é–‹å§‹è‡ªå‹•é€£æŽ¥é¸ä¸­çš„éŒ¢åŒ…:",{walletName:(S=n==null?void 0:n.adapter)==null?void 0:S.name,readyState:(z=n==null?void 0:n.adapter)==null?void 0:z.readyState}),u().catch(W=>{console.error("[TronWalletLogin] å½ˆçª—é¸æ“‡å¾Œè‡ªå‹•é€£æŽ¥å¤±æ•—:",W),f(t("errors.connectionFailed",{error:W.message||W.toString()}))})):console.log("[TronWalletLogin] ç‹€æ…‹å·²è®ŠåŒ–ï¼Œè·³éŽè‡ªå‹•é€£æŽ¥:",{wallet:(_=n==null?void 0:n.adapter)==null?void 0:_.name,connected:a,connecting:j})},200))}a&&R.current&&(console.log("[TronWalletLogin] é€£æŽ¥æˆåŠŸï¼Œæ¸…é™¤æ¨™è¨˜"),R.current=!1)},[n,a,j,u,f,t]),g.useEffect(()=>{var h,x;n&&console.log("[TronWalletLogin] éŒ¢åŒ…ç‹€æ…‹è®ŠåŒ–:",{walletName:(h=n==null?void 0:n.adapter)==null?void 0:h.name,readyState:(x=n==null?void 0:n.adapter)==null?void 0:x.readyState,connected:a,connecting:j})},[n,a,j]),g.useEffect(()=>{var E;const h=K.current,x=G.current;(a!==h||s!==x)&&(console.log("[TronWalletLogin] é€£æŽ¥ç‹€æ…‹è®ŠåŒ–:",{wasConnected:h,connected:a,prevAddress:x,address:s,wallet:(E=n==null?void 0:n.adapter)==null?void 0:E.name,connecting:j}),a&&s?(console.log("[TronWalletLogin] è§¸ç™¼é€£æŽ¥æµç¨‹"),f(""),w("pending"),I(A.WALLET_CONNECTED,{address:s,timestamp:Date.now()}),l(s).then(()=>{w("success")}).catch(S=>{re(S)?w("pending"):w("failed")})):!a&&h&&(console.log("[TronWalletLogin] è§¸ç™¼æ–·é–‹æµç¨‹"),w(null),I(A.WALLET_DISCONNECTED,{timestamp:Date.now()})),K.current=a,G.current=s)},[a,s]),g.useEffect(()=>{const h=()=>{const S=document.querySelectorAll(".official-wallet-button button");if(S.length===0)return;const _=document.documentElement.getAttribute("data-theme")==="dark"?"#4b5563":"#e5e7eb";S.forEach(W=>{W instanceof HTMLElement&&(W.style.setProperty("background","transparent","important"),W.style.setProperty("border",`2px solid ${_}`,"important"),W.style.setProperty("background-image","none","important"))})},x=setTimeout(()=>{requestAnimationFrame(h)},100),b=new MutationObserver(()=>{requestAnimationFrame(h)}),E=document.querySelector(".tronwallet-login");return E&&b.observe(E,{childList:!0,subtree:!0}),()=>{clearTimeout(x),b.disconnect()}},[v.length]),g.useEffect(()=>{const h=Ve(r);return()=>{h&&h.disconnect&&h.disconnect()}},[r]),g.useEffect(()=>(F.current||(ne(),F.current=!0),Me(x=>{switch(x.type){case A.INIT:F.current||(ne(),F.current=!0);break;case A.CLOSE:console.log("Flutter è«‹æ±‚é—œé–‰ç™»å…¥æ¨¡å¡Š");break}})),[]);const U=g.useMemo(()=>document.referrer&&document.referrer!==window.location.href?!0:window.history.length>1,[]),ee=()=>{U&&window.history.back()};return a&&s?e.jsxs(e.Fragment,{children:[U()&&e.jsxs("button",{className:"back-button",onClick:ee,title:t("common.back"),children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7"})}),e.jsx("span",{children:t("common.back")})]}),e.jsx(se,{}),e.jsx(Ke,{address:s,signingStatus:C}),e.jsx(ae,{})]}):e.jsxs("div",{className:"tronwallet-login",children:[U&&e.jsxs("button",{className:"back-button",onClick:ee,title:t("common.back"),children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7"})}),e.jsx("span",{children:t("common.back")})]}),e.jsx(se,{}),e.jsx("div",{className:"login-icon",children:e.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]})}),e.jsx("h2",{className:"login-title",children:t("login.title")}),e.jsx("div",{className:"environment-info",children:e.jsxs("div",{className:"env-badge",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),e.jsx("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),e.jsx("line",{x1:"12",y1:"17",x2:"12",y2:"21"})]}),e.jsx("span",{className:"env-platform",children:P}),Q&&Q!=="Unknown"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"env-separator",children:"Â·"}),e.jsx("span",{className:"env-browser",children:Q})]}),M&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"env-separator",children:"Â·"}),e.jsx("span",{className:"env-pwa-badge",children:"PWA"})]})]})}),e.jsx("p",{className:"login-description",children:v.length>0?t("login.description.detected",{wallets:v.map(h=>h.detectedName).join("ã€")}):t(N||M&&!L?"login.description.pc":"login.description.mobile")}),T&&e.jsxs("div",{className:"error-message",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),T]}),a&&s&&C==="pending"&&e.jsx("div",{className:"signing-prompt",children:e.jsxs("div",{className:"signing-prompt-content",children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"})}),e.jsxs("div",{className:"signing-prompt-text",children:[e.jsx("p",{className:"signing-prompt-title",children:t("signing.pendingTitle","è«‹å®Œæˆç°½åä»¥å®Œæˆç™»å…¥")}),e.jsx("p",{className:"signing-prompt-desc",children:t("signing.pendingDesc","éŒ¢åŒ…å·²é€£æŽ¥ï¼Œè«‹åœ¨éŒ¢åŒ…ä¸­ç¢ºèªç°½åè«‹æ±‚")})]}),e.jsx("button",{className:"signing-prompt-btn",onClick:async()=>{w("pending"),f("");try{await l(s),w("success")}catch(h){re(h)?w("pending"):w("failed")}},children:t("signing.retry","é‡æ–°ç°½å")})]})}),v.length>0&&e.jsx(Ge,{availableWallets:v,onWalletClick:async h=>{console.log("[TronWalletLogin] å¿«æ·ç™»å…¥æŒ‰éˆ•è¢«é»žæ“Š:",{walletName:h.adapter.name,detectedName:h.detectedName});try{f(""),await k(h),console.log("[TronWalletLogin] å¿«æ·ç™»å…¥æˆåŠŸ")}catch(x){console.error("[TronWalletLogin] å¿«æ·ç™»å…¥å¤±æ•—:",x),f(t("errors.connectionFailed",{error:x.message||x.toString()}))}},connecting:j,connectedWallet:y}),e.jsxs("div",{className:"login-methods",children:[v.length>0&&e.jsx("div",{className:"method-divider",children:e.jsx("span",{children:t("login.or")})}),e.jsx("div",{className:"official-wallet-button","data-button-text":t("login.selectWallet"),style:{"--button-text":`"${t("login.selectWallet")}"`},children:e.jsx("button",{className:"select-wallet-custom-btn",onClick:h=>{h.preventDefault(),h.stopPropagation(),console.log("[TronWalletLogin] æ‰“é–‹å®˜æ–¹éŒ¢åŒ…é¸æ“‡å½ˆçª—"),i(!0)},children:t("login.selectWallet")})}),q&&me&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"method-divider",children:e.jsx("span",{children:t("login.or")})}),e.jsxs("button",{className:"login-method-btn",onClick:fe,disabled:j,children:[e.jsx("div",{className:"method-icon",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"5",y:"2",width:"14",height:"20",rx:"2",ry:"2"}),e.jsx("line",{x1:"12",y1:"18",x2:"12.01",y2:"18"})]})}),e.jsxs("div",{className:"method-content",children:[e.jsx("h3",{children:t("login.useMobileApp")}),e.jsx("p",{children:t("login.mobileAppDesc")})]})]})]})]}),e.jsxs("div",{className:"login-tips",children:[e.jsx("p",{children:t("tips.title")}),e.jsx("ul",{children:N?O?t("tips.pcWithExtension",{wallets:v.map(h=>h.detectedName).join("ã€")}).map((h,x)=>e.jsx("li",{children:h},x)):t("tips.pcWithoutExtension").map((h,x)=>e.jsx("li",{children:h},x)):t("tips.mobile").map((h,x)=>e.jsx("li",{children:h},x))})]}),e.jsx(ae,{})]})},nt=()=>[new ve,new ye,new ke,new Le],ot=()=>[new je,new be],st=()=>[new Ne],at=()=>{const t=V.METADATA;return new Ee({network:V.NETWORK,options:{projectId:V.PROJECT_ID,metadata:t}})},rt=()=>{const t=[...nt(),...ot(),...st()],r=at();return r&&t.push(r),t};function it(){return e.jsx("div",{className:"app",children:e.jsx("div",{className:"app-container",children:e.jsx(tt,{})})})}function lt(){const t=g.useMemo(()=>rt(),[]),r=s=>{console.error("éŒ¢åŒ…éŒ¯èª¤:",s)};return e.jsx(He,{children:e.jsx(Fe,{children:e.jsx(Ze,{children:e.jsx(We,{adapters:t,onError:r,autoConnect:!1,children:e.jsx(Se,{children:e.jsx(it,{})})})})})})}console.log("[Main] Before importing polyfills...");console.log("[Main] After importing polyfills, checking Buffer:",typeof window<"u"?typeof window.Buffer:"window undefined");console.log("[Main] App imports complete, Buffer check:",typeof window<"u"?typeof window.Buffer:"window undefined");xe.createRoot(document.getElementById("root")).render(e.jsx(we.StrictMode,{children:e.jsx(lt,{})}));
