import{r as g,j as e,c as Ce,R as ye}from"./react-vendor.Bj0G0Oyz.js";import"./polyfills.DCfrOiPO.js";import{ab as G,ac as Le,ad as be,ae as je,af as Ne,ag as Ee,ah as We,ai as Ae,aj as Se,ak as Pe,al as Re,am as Me,an as Oe}from"./wallet-vendor.CHv2NQr2.js";import"./buffer-polyfill.ErO7y5re.js";const De=()=>{const[t,a]=g.useState(!0),n=async s=>{try{const o=`${s}test`;return new Promise(u=>{const c=document.createElement("iframe");c.style.display="none",c.src=o;let i=!1;const m=setTimeout(()=>{i||(i=!0,document.body.removeChild(c),u(!1))},1e3);c.onload=()=>{i||(i=!0,clearTimeout(m),document.body.removeChild(c),u(!0))},c.onerror=()=>{i||(i=!0,clearTimeout(m),document.body.removeChild(c),u(!1))},document.body.appendChild(c)})}catch(o){return console.error("æª¢æŸ¥ APP å®‰è£ç‹€æ…‹å¤±æ•—:",o),!1}},r=async s=>{try{const o=document.createElement("a");return o.href=s,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),await new Promise(u=>setTimeout(u,300)),!0}catch(o){return console.error("è§¸ç™¼ Deep Link å¤±æ•—:",o),!1}};return g.useEffect(()=>{const s=o=>{o.origin===window.location.origin&&o.data&&o.data.type==="TRONWALLET_CALLBACK"&&console.log("æ”¶åˆ° TronWallet å›èª¿:",o.data)};return window.addEventListener("message",s),()=>{window.removeEventListener("message",s)}},[]),{isSupported:t,checkAppInstalled:n,triggerDeepLink:r}},X=()=>{const[t,a]=g.useState({isPC:!1,isMobile:!1,isIOS:!1,isAndroid:!1,isTablet:!1,hasExtension:!1,detectedWallets:[],isPWA:!1,isStandalone:!1,platform:"",browser:""});return g.useEffect(()=>{const n=()=>{const i=navigator.userAgent||navigator.vendor||window.opera,m=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(i),y=/iPad|iPhone|iPod/.test(i)&&!window.MSStream,w=/Android/.test(i),h=/iPad/.test(i)||w&&!/Mobile/.test(i),p=!m,d=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://"),f=d||window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches;let T="Unknown";i.indexOf("Chrome")>-1&&i.indexOf("Edg")===-1?T="Chrome":i.indexOf("Safari")>-1&&i.indexOf("Chrome")===-1?T="Safari":i.indexOf("Firefox")>-1?T="Firefox":i.indexOf("Edg")>-1?T="Edge":(i.indexOf("Opera")>-1||i.indexOf("OPR")>-1)&&(T="Opera");let C="Web";f?y?C="iOS PWA":w?C="Android PWA":C="PWA":p?C="Web PC":y?C="iOS Web":w&&(C="Android Web");const k=[],j=p||f&&!m;j&&((window.tronWeb||window.tronLink||window.tron&&window.tron.tronWeb)&&k.push({name:"TronLink",type:"extension",installed:!0}),window.tokenpocket&&k.push({name:"TokenPocket",type:"extension",installed:!0}),window.bitkeep&&(window.bitkeep.tronLink||window.bitkeep.tron)&&k.push({name:"BitKeep",type:"extension",installed:!0}),window.okxwallet&&k.push({name:"OKX Wallet",type:"extension",installed:!0}));const N=k.length>0;f&&console.log("[useEnvironment] PWAæ¨¡å¼æª¢æ¸¬çµæœ:",{isPWA:f,isPC:p,isMobile:m,isIOS:y,isAndroid:w,platform:C,shouldDetectExtensions:j,detectedWallets:k.map(S=>S.name),hasExtension:N,windowTronWeb:!!window.tronWeb,windowTronLink:!!window.tronLink,windowTron:!!window.tron,windowTokenPocket:!!window.tokenpocket,windowBitKeep:!!window.bitkeep,windowOkxWallet:!!window.okxwallet,userAgent:i.substring(0,100)}),a({isPC:p,isMobile:m,isIOS:y,isAndroid:w,isTablet:h,hasExtension:N,detectedWallets:k,isPWA:f,isStandalone:d,platform:C,browser:T})};n();let r=0;const s=10;let o=setInterval(()=>{n(),r++,r>=s&&(clearInterval(o),o=setInterval(n,3e3))},1e3),u;const c=()=>{clearTimeout(u),u=setTimeout(n,300)};return window.addEventListener("resize",c),()=>{o&&clearInterval(o),u&&clearTimeout(u),window.removeEventListener("resize",c)}},[]),t},pe={apiBaseUrl:"https://agoramarketapi.purrtechllc.com/api"};async function Ie(t){const a=await fetch(`${pe.apiBaseUrl}/auth/wallet-connect/nonce`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({walletAddress:t})});if(!a.ok)throw new Error("ç²å– nonce å¤±æ•—: "+a.statusText);const n=await a.json();if(n.message&&(!n.nonce||n.nonce==="")&&n.message.includes("Nonce:")){const r=n.message.match(/Nonce:\s*([^\n]+)/);r&&r[1]&&(n.nonce=r[1].trim())}if(n.message&&!n.timestamp&&n.message.includes("Timestamp:")){const r=n.message.match(/Timestamp:\s*([^\n]+)/);if(r&&r[1]){const s=parseInt(r[1].trim());isNaN(s)||(n.timestamp=s)}}if(!n.message||n.message==="")throw new Error("ç²å– nonce å¤±æ•—ï¼šç¼ºå°‘ message å­—æ®µ");if(!n.nonce||n.nonce==="")throw new Error("ç²å– nonce å¤±æ•—ï¼šç¼ºå°‘ nonce å­—æ®µ");return n.timestamp||(n.timestamp=Math.floor(Date.now()/1e3)),n}async function _e(t,a,n,r="tron"){const s={walletAddress:t,signature:a,nonce:n.nonce,timestamp:n.timestamp};r==="tron"&&(s.chain="TRC20",s.chainType="tron");const o=await fetch(`${pe.apiBaseUrl}/auth/wallet-connect/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!o.ok){const c=await o.json().catch(()=>({message:o.statusText}));throw new Error(c.message||"ç™»éŒ„å¤±æ•—: "+o.statusText)}const u=await o.json();if(!u.token||!u.refreshToken)throw new Error(u.message||"ç™»éŒ„éŸ¿æ‡‰ä¸­ç¼ºå°‘ token");return u}const D={WALLET_CONNECTED:"WALLET_CONNECTED",WALLET_DISCONNECTED:"WALLET_DISCONNECTED",WALLET_ADDRESS:"WALLET_ADDRESS",JWT_REQUEST:"JWT_REQUEST",JWT_RECEIVED:"JWT_RECEIVED",JWT_ERROR:"JWT_ERROR",READY:"READY",ERROR:"ERROR",INIT:"INIT",CLOSE:"CLOSE"},q=(t,a={})=>{const n={source:"tron-wallet-login-module",type:t,data:a,timestamp:Date.now()};window.parent&&window.parent!==window&&window.parent.postMessage(n,"*"),window.flutter_inappwebview&&window.flutter_inappwebview.callHandler("onMessage",n),window.onTronWalletLoginMessage&&window.onTronWalletLoginMessage(n)},Be=t=>{const a=n=>{n.data&&n.data.source==="flutter-app"&&t(n.data)};return window.addEventListener("message",a),window.flutter_inappwebview&&window.flutter_inappwebview.addEventListener("message",a),()=>{window.removeEventListener("message",a),window.flutter_inappwebview&&window.flutter_inappwebview.removeEventListener("message",a)}},de=()=>{q(D.READY,{version:"1.0.0",timestamp:Date.now()})},Fe=t=>{q(D.ERROR,{error:t.message||t,stack:t.stack})},$e={common:{connect:"é€£æ¥",disconnect:"æ–·é–‹é€£æ¥",cancel:"å–æ¶ˆ",confirm:"ç¢ºèª",loading:"è¼‰å…¥ä¸­",error:"éŒ¯èª¤",success:"æˆåŠŸ",retry:"é‡è©¦",back:"è¿”å›"},login:{title:"é€£æ¥éŒ¢åŒ…",description:{pc:"è«‹é¸æ“‡éŒ¢åŒ…é€£æ¥æ–¹å¼",mobile:"è«‹é¸æ“‡éŒ¢åŒ…é€²è¡Œé€£æ¥",detected:"æª¢æ¸¬åˆ° {wallets}ï¼Œè«‹é¸æ“‡ç™»å…¥æ–¹å¼"},selectWallet:"é¸æ“‡éŒ¢åŒ…",quickLogin:"å¿«æ·ç™»å…¥",useMobileApp:"ä½¿ç”¨æ‰‹æ©Ÿ APP",mobileAppDesc:"é€šé Deep Link æ‰“é–‹ TronLink APP",or:"æˆ–"},wallet:{connected:"å·²é€£æ¥éŒ¢åŒ…",connectedWaitingSignature:"å·²é€£æ¥éŒ¢åŒ…(ç­‰å¾…ç°½å)",connectedSignatureSuccess:"å·²é€£æ¥éŒ¢åŒ…(ç°½åæˆåŠŸ)",redirectingToLogin:"è·³è½‰ç™»å…¥...",disconnected:"éŒ¢åŒ…å·²æ–·é–‹",connecting:"é€£æ¥ä¸­",address:"éŒ¢åŒ…åœ°å€ï¼š",connectingTo:"æ­£åœ¨é€£æ¥åˆ° {wallet}...",unknown:"æœªçŸ¥éŒ¢åŒ…"},errors:{loginFailed:"ç™»å…¥å¤±æ•—ï¼Œè«‹é‡è©¦",cannotOpenApp:"ç„¡æ³•æ‰“é–‹ TronLink APPï¼Œè«‹ç¢ºèªå·²å®‰è£ä¸¦é‡è©¦",appNotInstalled:`æœªæª¢æ¸¬åˆ° TronLink APPï¼Œæ˜¯å¦å‰å¾€ä¸‹è¼‰ï¼Ÿ

å¦‚æœå·²å®‰è£ï¼Œè«‹é»æ“Šå–æ¶ˆå¾Œé‡è©¦ã€‚`,signatureCanceled:"ç°½åå·²å–æ¶ˆã€‚è«‹åœ¨éŒ¢åŒ…ä¸­ç¢ºèªç°½åä»¥ç¹¼çºŒç™»å…¥ã€‚",signatureFailed:"ç°½åå¤±æ•—ï¼Œè«‹é‡è©¦",jwtFailed:"JWT èªè­‰å¤±æ•—: {error}",connectionFailed:"é€£æ¥å¤±æ•—: {error}",walletNotSupported:"{wallet} ä¸æ”¯æŒç°½ååŠŸèƒ½ã€‚è«‹ä½¿ç”¨æ”¯æŒç°½åçš„éŒ¢åŒ…ï¼ˆå¦‚ TronLinkã€Ledger ç­‰ï¼‰ã€‚",ledgerTimeout:"Ledger ç°½åè¶…æ™‚ã€‚è«‹ç¢ºä¿è¨­å‚™å·²é€£æ¥ä¸¦è§£é–ï¼Œç„¶å¾Œé‡è©¦ã€‚",ledgerNotConnected:"Ledger è¨­å‚™æœªé€£æ¥ã€‚è«‹é€£æ¥è¨­å‚™å¾Œé‡è©¦ã€‚",ledgerConfirm:"è«‹åœ¨ Ledger è¨­å‚™ä¸Šç¢ºèªç°½å...",nonceFailed:"ç²å– nonce å¤±æ•—: {error}",verifyFailed:"ç™»éŒ„å¤±æ•—: {error}",unknownError:"æœªçŸ¥éŒ¯èª¤"},tips:{title:"ğŸ’¡ æç¤ºï¼š",pcWithExtension:["æª¢æ¸¬åˆ° {wallets} æ“´å±•","é»æ“Šä¸Šæ–¹æŒ‰éˆ•é¸æ“‡éŒ¢åŒ…é€²è¡Œé€£æ¥","æ”¯æŒå¤šç¨®éŒ¢åŒ…ï¼šç€è¦½å™¨æ“´å±•ã€ç§»å‹•ç«¯éŒ¢åŒ…ã€ç¡¬ä»¶éŒ¢åŒ…","é¦–æ¬¡ä½¿ç”¨éœ€è¦åœ¨éŒ¢åŒ…ä¸­æˆæ¬Š"],pcWithoutExtension:["æ¨è–¦å®‰è£ TronLinkã€TokenPocket ç­‰ç€è¦½å™¨æ“´å±•","æˆ–ä½¿ç”¨ WalletConnect é€£æ¥ç§»å‹•ç«¯éŒ¢åŒ…","æ”¯æŒ Ledger ç¡¬ä»¶éŒ¢åŒ…","é»æ“Šä¸Šæ–¹æŒ‰éˆ•æŸ¥çœ‹æ‰€æœ‰å¯ç”¨é¸é …"],mobile:["ç§»å‹•ç«¯æ¨è–¦ä½¿ç”¨ WalletConnect é€£æ¥éŒ¢åŒ…","æˆ–é€šé Deep Link æ‰“é–‹ TronLink APP","æ”¯æŒ Trust Walletã€ImToken ç­‰ç§»å‹•ç«¯éŒ¢åŒ…","é»æ“Šä¸Šæ–¹æŒ‰éˆ•æŸ¥çœ‹æ‰€æœ‰å¯ç”¨é¸é …"]},modal:{connectWalletTitle:"é€£æ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ",detected:"å·²æª¢æ¸¬",notFound:"æœªæ‰¾åˆ°",installed:"å·²å®‰è£",notInstalled:"æœªå®‰è£",loading:"è¼‰å…¥ä¸­",connecting:"é€£æ¥ä¸­",connected:"å·²é€£æ¥",disconnect:"æ–·é–‹é€£æ¥"},environment:{webPC:"Web PC",webMobile:"Web ç§»å‹•ç«¯",iosWeb:"iOS Web",androidWeb:"Android Web",iosPWA:"iOS PWA",androidPWA:"Android PWA",pwa:"PWA"},process:{gettingNonce:"ğŸ“¨ æ­£åœ¨ç²å– nonce...",nonceSuccess:"âœ… Nonce ç²å–æˆåŠŸ",signing:"âœï¸ æ­£åœ¨ç°½åæ¶ˆæ¯...",signatureSuccess:"âœ… ç°½åæˆåŠŸ",verifying:"ğŸ” æ­£åœ¨é©—è­‰ç°½åä¸¦ç™»å…¥...",loginSuccess:"âœ… ç™»å…¥æˆåŠŸï¼Œå·²ç²å– Token",jwtSent:"âœ… JWT Token å·²ç™¼é€çµ¦ Flutter",ledgerDetected:"ğŸ” æª¢æ¸¬åˆ° Ledger ç¡¬ä»¶éŒ¢åŒ…ï¼Œè«‹åœ¨è¨­å‚™ä¸Šç¢ºèªç°½å..."},signing:{pendingTitle:"è«‹å®Œæˆç°½åä»¥å®Œæˆç™»å…¥",pendingDesc:"éŒ¢åŒ…å·²é€£æ¥ï¼Œè«‹åœ¨éŒ¢åŒ…ä¸­ç¢ºèªç°½åè«‹æ±‚",retry:"é‡æ–°ç°½å"}},qe={common:{connect:"Connect",disconnect:"Disconnect",cancel:"Cancel",confirm:"Confirm",loading:"Loading",error:"Error",success:"Success",retry:"Retry",back:"Back"},login:{title:"Connect Wallet",description:{pc:"Please select wallet connection method",mobile:"Please select a wallet to connect",detected:"Detected {wallets}, please select login method"},selectWallet:"Select Wallet",quickLogin:"Quick Login",useMobileApp:"Use Mobile APP",mobileAppDesc:"Open TronLink APP via Deep Link",or:"or"},wallet:{connected:"Wallet Connected",connectedWaitingSignature:"Wallet Connected (Waiting for Signature)",connectedSignatureSuccess:"Wallet Connected (Signature Success)",redirectingToLogin:"Redirecting to Login...",disconnected:"Wallet Disconnected",connecting:"Connecting",address:"Wallet Address:",connectingTo:"Connecting to {wallet}...",unknown:"Unknown Wallet"},errors:{loginFailed:"Login failed, please try again",cannotOpenApp:"Cannot open TronLink APP, please confirm it is installed and try again",appNotInstalled:`TronLink APP not detected, go to download?

If already installed, please click cancel and try again.`,signatureCanceled:"Signature canceled. Please confirm the signature in the wallet to continue login.",signatureFailed:"Signature failed, please try again",jwtFailed:"JWT authentication failed: {error}",connectionFailed:"Connection failed: {error}",walletNotSupported:"{wallet} does not support signature function. Please use a wallet that supports signatures (such as TronLink, Ledger, etc.).",ledgerTimeout:"Ledger signature timeout. Please ensure the device is connected and unlocked, then try again.",ledgerNotConnected:"Ledger device not connected. Please connect the device and try again.",ledgerConfirm:"Please confirm signature on Ledger device...",nonceFailed:"Failed to get nonce: {error}",verifyFailed:"Login failed: {error}",unknownError:"Unknown error"},tips:{title:"ğŸ’¡ Tips:",pcWithExtension:["Detected {wallets} extension","Click the button above to select wallet for connection","Supports multiple wallets: browser extensions, mobile wallets, hardware wallets","First-time use requires authorization in the wallet"],pcWithoutExtension:["Recommended to install TronLink, TokenPocket and other browser extensions","Or use WalletConnect to connect mobile wallets","Supports Ledger hardware wallet","Click the button above to view all available options"],mobile:["Mobile devices recommend using WalletConnect to connect wallets","Or open TronLink APP via Deep Link","Supports Trust Wallet, ImToken and other mobile wallets","Click the button above to view all available options"]},modal:{connectWalletTitle:"Connect a wallet on Tron to continue",detected:"Detected",notFound:"NotFound",installed:"Installed",notInstalled:"NotInstalled",loading:"Loading",connecting:"Connecting",connected:"Connected",disconnect:"Disconnect"},environment:{webPC:"Web PC",webMobile:"Web Mobile",iosWeb:"iOS Web",androidWeb:"Android Web",iosPWA:"iOS PWA",androidPWA:"Android PWA",pwa:"PWA"},process:{gettingNonce:"ğŸ“¨ Getting nonce...",nonceSuccess:"âœ… Nonce obtained successfully",signing:"âœï¸ Signing message...",signatureSuccess:"âœ… Signature successful",verifying:"ğŸ” Verifying signature and logging in...",loginSuccess:"âœ… Login successful, Token obtained",jwtSent:"âœ… JWT Token sent to Flutter",ledgerDetected:"ğŸ” Ledger hardware wallet detected, please confirm signature on device..."},signing:{pendingTitle:"Please complete signature to finish login",pendingDesc:"Wallet connected, please confirm signature request in wallet",retry:"Retry Signature"}},me=g.createContext(),z=()=>{const t=g.useContext(me);if(!t)throw new Error("useLanguage must be used within LanguageProvider");return t},Qe=({children:t})=>{const a=()=>{try{return localStorage.getItem("wallet-login-language")==="en"?"en":"zh"}catch{return"zh"}},[n,r]=g.useState(a),s={zh:$e,en:qe},o=(y,w={})=>{const h=y.split(".");let p=s[n];for(const d of h)if(p&&typeof p=="object")p=p[d];else return y;return typeof p=="string"&&Object.keys(w).length>0?p.replace(/\{(\w+)\}/g,(d,f)=>w[f]!==void 0?w[f]:d):Array.isArray(p)&&Object.keys(w).length>0?p.map(d=>typeof d=="string"?d.replace(/\{(\w+)\}/g,(f,T)=>w[T]!==void 0?w[T]:f):d):p||y},u=y=>{(y==="zh"||y==="en")&&(r(y),localStorage.setItem("wallet-login-language",y),window.dispatchEvent(new Event("languageChanged")))},c=()=>n,i=()=>n==="zh",m=()=>n==="en";return e.jsx(me.Provider,{value:{language:n,t:o,changeLanguage:u,getLanguage:c,isZh:i,isEn:m},children:t})},Ue=()=>{const[t,a]=g.useState(""),{signMessage:n,wallet:r}=G(),{t:s}=z(),o=g.useCallback(async u=>{var c,i;try{a(""),console.log(s("process.gettingNonce"));const m=await Ie(u);if(console.log(s("process.nonceSuccess"),m.nonce),!n){const w=((c=r==null?void 0:r.adapter)==null?void 0:c.name)||s("wallet.unknown");throw new Error(s("errors.walletNotSupported",{wallet:w}))}const y=((i=r==null?void 0:r.adapter)==null?void 0:i.name)==="Ledger";y?(console.log(s("process.ledgerDetected")),a(s("errors.ledgerConfirm"))):console.log(s("process.signing"));try{const w=await n(m.message);console.log(s("process.signatureSuccess")),y&&a(""),console.log(s("process.verifying"));const h=await _e(u,w,m,"tron");console.log(s("process.loginSuccess")),q(D.JWT_RECEIVED,{token:h.token,refreshToken:h.refreshToken,user:h.user,address:u,timestamp:Date.now()}),console.log(s("process.jwtSent"))}catch(w){const h=w.message||w.toString();if(h.includes("rejected")||h.includes("denied")||h.includes("cancel")||h.includes("å–æ¶ˆ")||h.includes("æ‹’çµ•"))throw new Error(s("errors.signatureCanceled"));if(y){if(h.includes("timeout")||h.includes("è¶…æ™‚"))throw new Error(s("errors.ledgerTimeout"));if(h.includes("not connected")||h.includes("æœªé€£æ¥"))throw new Error(s("errors.ledgerNotConnected"))}throw w}}catch(m){throw console.error("âŒ JWT è«‹æ±‚å¤±æ•—:",m),Fe(m),a(s("errors.jwtFailed",{error:m.message||m.toString()})),m}},[n,r,s]);return{error:t,setError:a,handleJWTRequest:o}},V={TRONWALLET_SCHEME:"tronlink://",TRONWALLET_UNIVERSAL_LINK:"https://www.tronlink.org/",CALLBACK_PATH:"/callback"},K={PROJECT_ID:"7412eb629501759c091220ccc09ded23",NETWORK:"mainnet",get METADATA(){return{name:"TRON éŒ¢åŒ…ç™»å…¥æ¨¡å¡Š",description:"TRON éŒ¢åŒ…ç™»å…¥æ¨¡å¡Š - Flutter Web é›†æˆ",url:window.location.origin,icons:[`${window.location.origin}/favicon.ico`]}}},Ve={TronLink:"TronLink",TokenPocket:"TokenPocket",BitKeep:"BitKeep","OKX Wallet":"OkxWallet"},ze=()=>{const{wallets:t,select:a,connect:n,connecting:r,connected:s,wallet:o}=G(),{detectedWallets:u}=X(),c=g.useMemo(()=>!t||t.length===0?[]:t.filter(h=>{const p=h.adapter.readyState;return p==="Installed"||p==="Found"||p==="Loadable"}).map(h=>{const p=u.find(d=>Ve[d.name]===h.adapter.name);return{...h,detectedName:(p==null?void 0:p.name)||h.adapter.name,detectedType:(p==null?void 0:p.type)||"extension"}}),[t,u]),i=g.useRef(0),m=g.useRef(0);return g.useEffect(()=>{const w=c.length,h=u.length,p=i.current,d=m.current;(w!==p||h!==d)&&(w>0?console.log("[useQuickLogin] å¯ç”¨éŒ¢åŒ…åˆ—è¡¨:",{detectedWallets:u.map(f=>f.name),availableWallets:c.map(f=>({name:f.adapter.name,detectedName:f.detectedName}))}):t&&t.length>0&&h===0&&console.log("[useQuickLogin] ç„¡å¯ç”¨éŒ¢åŒ…:",{hasWallets:!0,walletsCount:t.length,detectedWalletsCount:0,allWallets:t.map(f=>f.adapter.name)}),i.current=w,m.current=h)},[c,u,t]),{availableWallets:c,handleQuickConnect:async w=>{var d,f,T,C,k,j,N,S,R;const h=w.adapter.name,p=w.isApp||w.detectedType==="app";if(console.log("[QuickLogin] é–‹å§‹é€£æ¥éŒ¢åŒ…:",{walletName:h,isApp:p,detectedType:w.detectedType,availableWallets:t.map(L=>L.adapter.name),currentWallet:(d=o==null?void 0:o.adapter)==null?void 0:d.name,connecting:r,connected:s}),p)throw new Error("APP_TYPE_WALLET");try{const L=t.find(E=>E.adapter.name===h);if(console.log("[QuickLogin] æŸ¥æ‰¾éŒ¢åŒ…é©é…å™¨:",{walletName:h,found:!!L,targetWalletName:(f=L==null?void 0:L.adapter)==null?void 0:f.name,allWallets:t.map(E=>({name:E.adapter.name,readyState:E.adapter.readyState}))}),!L)throw new Error(`æ‰¾ä¸åˆ°éŒ¢åŒ…é©é…å™¨: ${h}`);console.log("[QuickLogin] æ­¥é©Ÿ 1: é¸æ“‡éŒ¢åŒ…",h),await a(h),console.log("[QuickLogin] æ­¥é©Ÿ 1 å®Œæˆ: select() å·²èª¿ç”¨"),console.log("[QuickLogin] æ­¥é©Ÿ 2: ç­‰å¾…é¸æ“‡å®Œæˆ..."),await new Promise(E=>setTimeout(E,500)),console.log("[QuickLogin] é¸æ“‡å¾Œç‹€æ…‹:",{currentWallet:(T=o==null?void 0:o.adapter)==null?void 0:T.name,expectedWallet:h,match:((C=o==null?void 0:o.adapter)==null?void 0:C.name)===h}),console.log("[QuickLogin] æ­¥é©Ÿ 3: é–‹å§‹é€£æ¥éŒ¢åŒ…..."),await n(),console.log("[QuickLogin] æ­¥é©Ÿ 3 å®Œæˆ: connect() æˆåŠŸ")}catch(L){console.error("[QuickLogin] å¿«é€Ÿé€£æ¥éŒ¯èª¤:",{error:L,message:L==null?void 0:L.message,stack:L==null?void 0:L.stack,walletName:h,currentWallet:(k=o==null?void 0:o.adapter)==null?void 0:k.name,connecting:r,connected:s});const E=(L==null?void 0:L.message)||(L==null?void 0:L.toString())||"";if(E.includes("No wallet is selected")||E.includes("not selected"))try{console.log('[QuickLogin] æª¢æ¸¬åˆ° "No wallet is selected" éŒ¯èª¤ï¼Œå˜—è©¦é‡è©¦...'),console.log("[QuickLogin] é‡è©¦å‰ç‹€æ…‹:",{walletName:h,currentWallet:(j=o==null?void 0:o.adapter)==null?void 0:j.name,wallets:t.map(b=>b.adapter.name)}),console.log("[QuickLogin] é‡è©¦: å†æ¬¡é¸æ“‡éŒ¢åŒ…",h),await a(h),console.log("[QuickLogin] é‡è©¦: ç­‰å¾…é¸æ“‡å®Œæˆ..."),await new Promise(b=>setTimeout(b,800)),console.log("[QuickLogin] é‡è©¦å¾Œç‹€æ…‹:",{currentWallet:(N=o==null?void 0:o.adapter)==null?void 0:N.name,expectedWallet:h,match:((S=o==null?void 0:o.adapter)==null?void 0:S.name)===h}),console.log("[QuickLogin] é‡è©¦: å†æ¬¡å˜—è©¦é€£æ¥..."),await n(),console.log("[QuickLogin] é‡è©¦æˆåŠŸ")}catch(b){console.error("[QuickLogin] é‡è©¦é€£æ¥å¤±æ•—:",{error:b,message:b==null?void 0:b.message,stack:b==null?void 0:b.stack,walletName:h,currentWallet:(R=o==null?void 0:o.adapter)==null?void 0:R.name});const I=(b==null?void 0:b.message)||(b==null?void 0:b.toString())||"";throw I.includes("No wallet is selected")||I.includes("not selected")?new Error(`ç„¡æ³•é¸æ“‡éŒ¢åŒ… ${h}ã€‚è«‹ç¢ºä¿ TronLink æ“´å±•å·²å®‰è£ä¸¦å•Ÿç”¨ã€‚`):b}else throw L}},connecting:r,connected:s,currentWallet:o}};function Y(){try{return localStorage.getItem("wallet-login-language")==="en"?"en":"zh"}catch{return"zh"}}const Je={"Connect a wallet on Tron to continue.":"é€£æ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ","Connect a wallet on Tron to continue":"é€£æ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ","Connect a wallet on":"é€£æ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ","Tron to continue":"é€£æ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ","Connect a wallet":"é€£æ¥éŒ¢åŒ…",Detected:"å·²æª¢æ¸¬",NotFound:"æœªæ‰¾åˆ°",NotDetected:"æœªæª¢æ¸¬",Installed:"å·²å®‰è£",NotInstalled:"æœªå®‰è£",Loading:"è¼‰å…¥ä¸­",Connecting:"é€£æ¥ä¸­",Connected:"å·²é€£æ¥",Disconnect:"æ–·é–‹é€£æ¥","Select Wallet":"é¸æ“‡éŒ¢åŒ…",Wallet:"éŒ¢åŒ…","on Tron":"TRON","to continue":"ä»¥ç¹¼çºŒ"},He={"Connect a wallet on Tron to continue.":"Connect a wallet on Tron to continue.","Connect a wallet on Tron to continue":"Connect a wallet on Tron to continue","Connect a wallet on":"Connect a wallet on","Tron to continue":"Tron to continue","Connect a wallet":"Connect a wallet",Detected:"Detected",NotFound:"NotFound",NotDetected:"NotDetected",Installed:"Installed",NotInstalled:"NotInstalled",Loading:"Loading",Connecting:"Connecting",Connected:"Connected",Disconnect:"Disconnect","Select Wallet":"Select Wallet",Wallet:"Wallet","on Tron":"on Tron","to continue":"to continue"};function fe(){return Y()==="zh"?Je:He}function ue(t){if(!t)return t;const a=fe();Y()==="zh"&&(t=t.replace(/Connect a wallet on Tron to continue\.?/gi,a["Connect a wallet on Tron to continue"]),t=t.replace(/Connect a wallet on\s*$/gi,a["Connect a wallet on Tron to continue"]),t.includes(a["Connect a wallet on Tron to continue"])?t=t.replace(/Tron to continue\.?/gi,""):t=t.replace(/Tron to continue\.?/gi,""));for(const[r,s]of Object.entries(a)){if(t.trim()===r)return s;const o=new RegExp(`^\\s*${r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\s*$`,"gi");t=t.replace(o,s)}return t}function we(t){if(t){if(t.nodeType===Node.TEXT_NODE){const a=t.textContent,n=ue(a);n!==a&&(t.textContent=n)}else if(t.nodeType===Node.ELEMENT_NODE){const a=t.textContent&&(t.textContent.includes("Connect a wallet")||t.textContent.includes("Detected")||t.textContent.includes("NotFound")||t.textContent.includes("Select Wallet"));if(t.dataset.translated==="true"&&!a)return;const n=t.textContent.trim(),s=fe()["Connect a wallet on Tron to continue"];if(n.includes("Connect a wallet on Tron to continue")||n.includes("Connect a wallet on")&&n.includes("Tron to continue")){t.innerHTML=s,t.dataset.translated="true";return}if(t.children.length===0){const o=t.textContent.trim(),u=ue(o);if(u!==o){t.textContent=u,t.dataset.translated="true";return}}Array.from(t.childNodes).forEach(o=>{we(o)})}}}function Ke(t){if(!t)return!1;if(t.textContent.trim().includes("Connect a wallet on Tron to continue"))return t.innerHTML="é€£æ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ",t.dataset.translated="true",!0;const n=Array.from(t.childNodes);let r=!1,s=!1,o=null,u=null;return n.forEach(c=>{const i=c.textContent.trim();(i.includes("Connect a wallet on")||i==="Connect a wallet on")&&(r=!0,o=c),(i.includes("Tron to continue")||i==="Tron to continue")&&(s=!0,u=c)}),r&&s?(o&&(o.textContent="é€£æ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ",o.dataset.translated="true"),u&&(u.textContent=""),t.dataset.translated="true",!0):(n.forEach(c=>{if(c.nodeType===Node.TEXT_NODE){const i=c.textContent.trim();if(i==="Connect a wallet on"||i.includes("Connect a wallet on"))c.textContent="é€£æ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ";else if(i==="Tron to continue"||i.includes("Tron to continue")){const m=c.previousSibling;m&&m.textContent&&m.textContent.includes("é€£æ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ"),c.textContent=""}}else if(c.nodeType===Node.ELEMENT_NODE){const i=c.textContent.trim();i==="Connect a wallet on"||i.includes("Connect a wallet on")?(c.textContent="é€£æ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ",c.dataset.translated="true"):(i==="Tron to continue"||i.includes("Tron to continue"))&&(c.textContent="")}}),!1)}function $(){['[role="dialog"]','[class*="wallet-adapter"]','[class*="wallet-modal"]','[class*="WalletModal"]','[class*="modal"]'].forEach(a=>{try{document.querySelectorAll(a).forEach(r=>{r&&(r.textContent&&(r.textContent.includes("Connect a wallet")||r.textContent.includes("Detected")||r.textContent.includes("NotFound")||r.textContent.includes("Select Wallet")||r.textContent.includes("NotDetected")||r.textContent.includes("NotInstalled"))&&(r.dataset.translated="false",r.querySelectorAll('[data-translated="true"]').forEach(o=>{o.dataset.translated="false"})),(!r.dataset.translated||r.dataset.translated==="false")&&(r.querySelectorAll('h1, h2, h3, h4, h5, h6, [class*="title"], [class*="Title"]').forEach(u=>{(!u.dataset.translated||u.dataset.translated==="false")&&Ke(u)}),we(r),r.dataset.translated="true"))})}catch{}})}function Ge(t=null){t||Y();const a=new MutationObserver(o=>{let u=!1;o.forEach(c=>{c.addedNodes.forEach(i=>{var m;if(i.nodeType===Node.ELEMENT_NODE){const y=((m=i.classList)==null?void 0:m.toString())||"",w=i.getAttribute("role")||"";(y.includes("wallet")||y.includes("modal")||w==="dialog"||i.querySelector('[role="dialog"]')||i.querySelector('[class*="wallet"]')||i.querySelector('[class*="modal"]'))&&(u=!0)}})}),u&&requestAnimationFrame(()=>{$(),requestAnimationFrame(()=>{$()})})});document.body&&a.observe(document.body,{childList:!0,subtree:!0});const n=()=>{$()};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n):n();const r=setInterval(()=>{$()},200),s=()=>{document.querySelectorAll('[data-translated="true"]').forEach(o=>{o.dataset.translated="false"}),$()};return window.addEventListener("storage",s),window.addEventListener("languageChanged",s),{disconnect:()=>{a.disconnect(),clearInterval(r),window.removeEventListener("storage",s),window.removeEventListener("languageChanged",s)}}}const xe=g.createContext(),Xe=()=>{const t=g.useContext(xe);if(!t)throw new Error("useTheme must be used within ThemeProvider");return t},Ye=({children:t})=>{const a=()=>{try{const o=localStorage.getItem("wallet-login-theme");return o?o==="dark"?"dark":"light":window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}catch{return"light"}},[n,r]=g.useState(a),s=()=>{const o=n==="light"?"dark":"light";r(o),localStorage.setItem("wallet-login-theme",o),document.documentElement.setAttribute("data-theme",o)};return g.useEffect(()=>{document.documentElement.setAttribute("data-theme",n)},[n]),g.useEffect(()=>{const o=window.matchMedia("(prefers-color-scheme: dark)"),u=c=>{localStorage.getItem("wallet-login-theme")||r(c.matches?"dark":"light")};return o.addEventListener("change",u),()=>o.removeEventListener("change",u)},[]),e.jsx(xe.Provider,{value:{theme:n,toggleTheme:s,isDark:n==="dark",isLight:n==="light"},children:t})},ge=()=>{const{language:t,changeLanguage:a}=z(),{theme:n,toggleTheme:r}=Xe();return e.jsxs("div",{className:"language-switcher",children:[e.jsx("button",{className:"theme-btn",onClick:r,title:n==="light"?"åˆ‡æ›åˆ°æ·±è‰²ä¸»é¡Œ":"åˆ‡æ›åˆ°æ·ºè‰²ä¸»é¡Œ","aria-label":n==="light"?"Switch to dark theme":"Switch to light theme",children:n==="light"?e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})}):e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),e.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),e.jsx("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),e.jsx("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),e.jsx("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),e.jsx("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),e.jsx("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),e.jsx("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]})}),e.jsx("button",{className:`lang-btn ${t==="zh"?"active":""}`,onClick:()=>a("zh"),title:"ä¸­æ–‡",children:"ä¸­æ–‡"}),e.jsx("button",{className:`lang-btn ${t==="en"?"active":""}`,onClick:()=>a("en"),title:"English",children:"EN"})]})},Ze=({address:t,signingStatus:a})=>{const{t:n}=z(),{platform:r,browser:s,isPWA:o}=X(),c=a==="pending"?{title:n("wallet.connectedWaitingSignature","å·²é€£æ¥éŒ¢åŒ…(ç­‰å¾…ç°½å)"),icon:e.jsx("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"})}),className:"status-waiting"}:a==="success"?{title:n("wallet.connectedSignatureSuccess","å·²é€£æ¥éŒ¢åŒ…(ç°½åæˆåŠŸ)"),icon:e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),className:"status-success"}:{title:n("wallet.connected","å·²é€£æ¥éŒ¢åŒ…"),icon:e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),className:"status-default"};return e.jsxs("div",{className:"wallet-info",children:[e.jsxs("div",{className:`success-message ${c.className}`,children:[e.jsx("div",{className:"status-icon-wrapper",children:c.icon}),e.jsx("h2",{children:c.title}),a==="success"&&e.jsx("p",{className:"login-redirect-message",children:n("wallet.redirectingToLogin","è·³è½‰ç™»å…¥...")})]}),e.jsx("div",{className:"environment-info",children:e.jsxs("div",{className:"env-badge",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),e.jsx("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),e.jsx("line",{x1:"12",y1:"17",x2:"12",y2:"21"})]}),e.jsx("span",{className:"env-platform",children:r}),s&&s!=="Unknown"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"env-separator",children:"Â·"}),e.jsx("span",{className:"env-browser",children:s})]}),o&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"env-separator",children:"Â·"}),e.jsx("span",{className:"env-pwa-badge",children:"PWA"})]})]})}),e.jsxs("div",{className:"address-display",children:[e.jsxs("label",{children:[n("wallet.address"),"ï¼š"]}),e.jsx("div",{className:"address-value",children:t})]}),e.jsx("div",{className:"wallet-actions",children:e.jsx(Le,{})})]})},et=({availableWallets:t,onWalletClick:a,connecting:n,connectedWallet:r})=>t.length===0?null:e.jsx("div",{className:"quick-login-section",children:e.jsx("div",{className:"quick-login-buttons",children:t.map(s=>{var c,i;const o=s.adapter.name===((c=r==null?void 0:r.adapter)==null?void 0:c.name),u=n&&o;return e.jsxs("button",{className:"quick-login-btn",onClick:()=>a(s),disabled:u,children:[e.jsxs("div",{className:"quick-login-icon",children:[s.adapter.icon&&e.jsx("img",{src:s.adapter.icon,alt:s.detectedName,onError:m=>{m.target.style.display="none"}}),(!s.adapter.icon||!s.adapter.icon.startsWith("data:"))&&e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]})]}),e.jsx("span",{className:"quick-login-name",children:s.detectedName}),n&&s.adapter.name===((i=r==null?void 0:r.adapter)==null?void 0:i.name)&&e.jsx("div",{className:"quick-login-spinner"})]},s.adapter.name)})})}),tt=500,nt=()=>{const[t,a]=g.useState([]),[n,r]=g.useState(!0),s=g.useRef(null),o=g.useRef(null),u=g.useRef(null),c=g.useRef(n),i=g.useRef(null);g.useEffect(()=>{c.current=n},[n]);const m=g.useCallback((p,d,f=null)=>{if(c.current)try{const T=new Date().toLocaleTimeString("zh-TW",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3}),C={id:Date.now()+Math.random(),timestamp:T,level:p,message:d,data:f?JSON.stringify(f,null,2):null};a(k=>[...k,C].slice(-tt))}catch(T){o.current&&o.current("Logger error:",T)}},[]);g.useEffect(()=>{i.current=m},[m]),g.useEffect(()=>{const p=setTimeout(()=>{c.current&&(s.current||(s.current=console.log.bind(console),o.current=console.error.bind(console),u.current=console.warn.bind(console)),console.log=(...d)=>{try{if(s.current(...d),!c.current||!i.current)return;const f=d.find(k=>typeof k=="string")||"",T=d.find(k=>typeof k=="object"&&k!==null&&!Array.isArray(k))||null;["[useEnvironment]","[useQuickLogin]","[TronWalletLogin]","[QuickLogin]","[Flutter Bridge]"].some(k=>f.includes(k))&&setTimeout(()=>{i.current&&i.current("log",f,T)},0)}catch{s.current&&s.current(...d)}},console.error=(...d)=>{var f;try{if(o.current(...d),!c.current||!i.current)return;const T=d.find(k=>typeof k=="string")||((f=d[0])==null?void 0:f.toString())||"Error",C=d.find(k=>typeof k=="object"&&k!==null&&!Array.isArray(k))||null;setTimeout(()=>{i.current&&i.current("error",T,C)},0)}catch{o.current&&o.current(...d)}},console.warn=(...d)=>{var f;try{if(u.current(...d),!c.current||!i.current)return;const T=d.find(k=>typeof k=="string")||((f=d[0])==null?void 0:f.toString())||"Warning",C=d.find(k=>typeof k=="object"&&k!==null&&!Array.isArray(k))||null;setTimeout(()=>{i.current&&i.current("warn",T,C)},0)}catch{u.current&&u.current(...d)}})},100);return()=>{clearTimeout(p),s.current&&(console.log=s.current,console.error=o.current,console.warn=u.current)}},[]);const y=g.useCallback(()=>{a([])},[]),w=g.useCallback(()=>{const p=t.map(d=>{const f=d.data?`
${d.data}`:"";return`[${d.timestamp}] [${d.level.toUpperCase()}] ${d.message}${f}`}).join(`

`);navigator.clipboard.writeText(p).then(()=>{m("info","æ—¥èªŒå·²è¤‡è£½åˆ°å‰ªè²¼æ¿")}).catch(d=>{m("error","è¤‡è£½æ—¥èªŒå¤±æ•—: "+d.message)})},[t,m]),h=g.useCallback(()=>{const p=t.map(C=>{const k=C.data?`
${C.data}`:"";return`[${C.timestamp}] [${C.level.toUpperCase()}] ${C.message}${k}`}).join(`

`),d=new Blob([p],{type:"text/plain"}),f=URL.createObjectURL(d),T=document.createElement("a");T.href=f,T.download=`tronwallet-logs-${new Date().toISOString().replace(/[:.]/g,"-")}.txt`,document.body.appendChild(T),T.click(),document.body.removeChild(T),URL.revokeObjectURL(f),m("info","æ—¥èªŒå·²å°å‡º")},[t,m]);return{logs:t,isEnabled:n,setIsEnabled:r,clearLogs:y,copyLogs:w,exportLogs:h,addLog:m}},Te=g.createContext(null),ot=({children:t})=>{const a=nt();return e.jsx(Te.Provider,{value:a,children:t})},st=()=>g.useContext(Te),he=()=>{const t=st();if(!t)return null;const{logs:a,isEnabled:n,setIsEnabled:r,clearLogs:s,copyLogs:o,exportLogs:u}=t,[c,i]=g.useState(!1),[m,y]=g.useState(!0),w=g.useRef(null),h=d=>{switch(d){case"error":return"log-entry-error";case"warn":return"log-entry-warn";case"info":return"log-entry-info";default:return"log-entry-log"}},p=()=>{w.current&&m&&(w.current.scrollTop=w.current.scrollHeight)};return g.useEffect(()=>{c&&m&&setTimeout(p,100)},[a,c,m]),n?e.jsxs("div",{className:`logger-panel ${c?"expanded":"collapsed"}`,children:[e.jsxs("div",{className:"logger-header",children:[e.jsxs("div",{className:"logger-header-left",children:[e.jsx("button",{className:"logger-toggle-btn",onClick:()=>i(!c),title:c?"æ”¶èµ·æ—¥èªŒ":"å±•é–‹æ—¥èªŒ",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:c?e.jsx("path",{d:"M18 15l-6-6-6 6"}):e.jsx("path",{d:"M6 9l6 6 6-6"})})}),e.jsxs("span",{className:"logger-title",children:["èª¿è©¦æ—¥èªŒ (",a.length,")"]})]}),c&&e.jsxs("div",{className:"logger-actions",children:[e.jsxs("label",{className:"logger-checkbox",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:d=>y(d.target.checked)}),e.jsx("span",{children:"è‡ªå‹•æ»¾å‹•"})]}),e.jsx("button",{className:"logger-action-btn",onClick:s,title:"æ¸…é™¤æ—¥èªŒ",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})}),e.jsx("button",{className:"logger-action-btn",onClick:o,title:"è¤‡è£½æ—¥èªŒ",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),e.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]})}),e.jsx("button",{className:"logger-action-btn",onClick:u,title:"å°å‡ºæ—¥èªŒ",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"7 10 12 15 17 10"}),e.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]})}),e.jsx("button",{className:"logger-action-btn",onClick:()=>r(!1),title:"é—œé–‰æ—¥èªŒ",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]})]}),c&&e.jsx("div",{className:"logger-content",ref:w,children:a.length===0?e.jsxs("div",{className:"logger-empty",children:[e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",opacity:"0.3",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e.jsx("polyline",{points:"10 9 9 9 8 9"})]}),e.jsx("p",{children:"æš«ç„¡æ—¥èªŒ"})]}):e.jsx("div",{className:"logger-entries",children:a.map(d=>e.jsxs("div",{className:`log-entry ${h(d.level)}`,children:[e.jsxs("div",{className:"log-entry-header",children:[e.jsx("span",{className:"log-timestamp",children:d.timestamp}),e.jsx("span",{className:`log-level log-level-${d.level}`,children:d.level.toUpperCase()})]}),e.jsx("div",{className:"log-message",children:d.message}),d.data&&e.jsxs("details",{className:"log-data",children:[e.jsx("summary",{children:"æŸ¥çœ‹æ•¸æ“š"}),e.jsx("pre",{children:d.data})]})]},d.id))})})]}):e.jsx("button",{className:"logger-toggle-btn",onClick:()=>r(!0),title:"å•Ÿç”¨æ—¥èªŒ",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e.jsx("polyline",{points:"10 9 9 9 8 9"})]})})},rt=()=>{var ae;const{t,language:a}=z(),{address:n,connected:r,wallet:s,select:o,connect:u}=G(),{setVisible:c,visible:i}=be(),{triggerDeepLink:m,checkAppInstalled:y}=De(),w=X(),{error:h,setError:p,handleJWTRequest:d}=Ue(),[f,T]=g.useState(null),{availableWallets:C,handleQuickConnect:k,connecting:j,currentWallet:N}=ze(),{isPC:S,isMobile:R,isIOS:L,hasExtension:E,detectedWallets:b,platform:I,browser:J,isPWA:_}=w,Q=(S||_&&!R||_&&L)&&E,ke=R||!E,Z=g.useRef(r),ee=g.useRef(n),U=g.useRef(!1),te=g.useRef(C.length),ne=g.useRef(r);g.useEffect(()=>{var l;(C.length!==te.current||r!==ne.current)&&(console.log("[TronWalletLogin] çµ„ä»¶ç‹€æ…‹æ›´æ–°:",{isPWA:_,isPC:S,isMobile:R,platform:I,availableWalletsCount:C.length,availableWallets:C.map(x=>({name:x.adapter.name,detectedName:x.detectedName,readyState:x.adapter.readyState})),detectedWallets:b.map(x=>x.name),hasExtension:E,showExtensionOption:Q,connecting:j,connected:r,currentWallet:(l=N==null?void 0:N.adapter)==null?void 0:l.name,address:n}),te.current=C.length,ne.current=r)},[C.length,b.length,E,j,r,(ae=N==null?void 0:N.adapter)==null?void 0:ae.name,n,_,S,R,I,Q]);const oe=()=>{const x=`login_${Date.now()}`,v=encodeURIComponent(window.location.origin+V.CALLBACK_PATH);return{deepLinkUrl:`${V.TRONWALLET_SCHEME}login?callback=${v}&requestId=${x}`,requestId:x,callbackUrl:v}},ve=async()=>{p("");try{const{deepLinkUrl:l}=oe();if(R&&!await y(V.TRONWALLET_SCHEME)){window.confirm(t("errors.appNotInstalled"))&&window.open(V.TRONWALLET_UNIVERSAL_LINK,"_blank");return}await m(l)||p(t("errors.cannotOpenApp"))}catch(l){console.error("APP ç™»å…¥éŒ¯èª¤:",l),p(t("errors.loginFailed"))}};g.useEffect(()=>{const l=new URLSearchParams(window.location.search),x=l.get("address"),v=l.get("requestId");x&&v&&(window.history.replaceState({},document.title,window.location.pathname),console.log("æ”¶åˆ° Deep Link å›èª¿:",{address:x,requestId:v}))},[]);const P=g.useRef(null),se=g.useRef(!0),B=g.useRef(!1),re=g.useRef(!1);g.useEffect(()=>{var v;const l=re.current,x=i||!1;if(l&&!x&&s&&!r){const W=(v=s==null?void 0:s.adapter)==null?void 0:v.name;W&&W!==P.current&&(console.log("[TronWalletLogin] æª¢æ¸¬åˆ°å½ˆçª—é—œé–‰ä¸”éŒ¢åŒ…è¢«é¸æ“‡ï¼Œæ¨™è¨˜ç‚ºç”¨æˆ¶é¸æ“‡:",{walletName:W,prevWalletName:P.current}),B.current=!0)}re.current=x},[i,s,r]),g.useEffect(()=>{var x;const l=(x=s==null?void 0:s.adapter)==null?void 0:x.name;if(se.current){console.log("[TronWalletLogin] çµ„ä»¶é¦–æ¬¡æ›è¼‰ï¼ŒéŒ¢åŒ…ç‹€æ…‹:",{walletName:l,connected:r,connecting:j,isInitialMount:!0}),se.current=!1,l&&(P.current=l);return}s&&!r&&!j&&l!==P.current?B.current?(console.log("[TronWalletLogin] æª¢æ¸¬åˆ°ç”¨æˆ¶é¸æ“‡çš„æ–°éŒ¢åŒ…ï¼Œå˜—è©¦é€£æ¥:",{walletName:l,connected:r,connecting:j,prevWalletName:P.current,userSelected:!0}),B.current=!1,P.current=l,u().catch(v=>{console.error("[TronWalletLogin] è‡ªå‹•é€£æ¥å¤±æ•—:",v),p(t("errors.connectionFailed",{error:v.message||v.toString()}))})):(console.log("[TronWalletLogin] æª¢æ¸¬åˆ°éŒ¢åŒ…ç‹€æ…‹è®ŠåŒ–ï¼ˆéç”¨æˆ¶é¸æ“‡ï¼‰ï¼Œä¸è‡ªå‹•é€£æ¥:",{walletName:l,connected:r,connecting:j,prevWalletName:P.current,userSelected:!1,modalVisible:i}),P.current=l):l?P.current=l:s||(P.current=null,B.current=!1)},[s,r,j,u,p,t,i]),g.useEffect(()=>{var v,W,O;const l=Z.current,x=ee.current;(r!==l||n!==x)&&console.log("[TronWalletLogin] é€£æ¥ç‹€æ…‹è®ŠåŒ–:",{wasConnected:l,connected:r,prevAddress:x,address:n,wallet:(v=s==null?void 0:s.adapter)==null?void 0:v.name,connecting:j,stackTrace:(W=new Error().stack)==null?void 0:W.split(`
`).slice(0,5).join(`
`)}),r&&n?(!l||x!==n)&&(console.log("[TronWalletLogin] è§¸ç™¼é€£æ¥æµç¨‹:",{wasConnected:l,connected:r,prevAddress:x,address:n,wallet:(O=s==null?void 0:s.adapter)==null?void 0:O.name}),p(""),T("pending"),q(D.WALLET_CONNECTED,{address:n,timestamp:Date.now()}),(!l||x!==n)&&d(n).then(()=>{T("success")}).catch(M=>{const A=(M==null?void 0:M.message)||(M==null?void 0:M.toString())||"";A.includes("å–æ¶ˆ")||A.includes("rejected")||A.includes("cancel")?T("pending"):T("failed")})):!r&&l&&(console.log("[TronWalletLogin] è§¸ç™¼æ–·é–‹æµç¨‹"),T(null),q(D.WALLET_DISCONNECTED,{timestamp:Date.now()})),Z.current=r,ee.current=n},[r,n]),g.useEffect(()=>{const l=()=>{const O=document.querySelectorAll(".official-wallet-button button");if(O.length===0)return;const M=document.documentElement.getAttribute("data-theme")==="dark";O.forEach(A=>{A instanceof HTMLElement&&(M?(A.style.setProperty("background","transparent","important"),A.style.setProperty("border","2px solid #4b5563","important")):(A.style.setProperty("background","transparent","important"),A.style.setProperty("border","2px solid #e5e7eb","important")),A.style.setProperty("background-image","none","important"))})},x=setTimeout(()=>{requestAnimationFrame(l)},100),v=new MutationObserver(O=>{O.some(A=>Array.from(A.addedNodes).some(F=>{var le,ce;return F.nodeType===1&&(((le=F.classList)==null?void 0:le.contains("official-wallet-button"))||((ce=F.querySelector)==null?void 0:ce.call(F,".official-wallet-button button")))}))&&requestAnimationFrame(l)}),W=document.querySelector(".tronwallet-login");return W&&v.observe(W,{childList:!0,subtree:!0}),()=>{clearTimeout(x),v.disconnect()}},[C.length]),g.useEffect(()=>{const l=Ge(a);return()=>{l&&l.disconnect&&l.disconnect()}},[a]),g.useEffect(()=>{const l=Be(x=>{switch(x.type){case D.INIT:U.current||(de(),U.current=!0);break;case D.CLOSE:console.log("Flutter è«‹æ±‚é—œé–‰ç™»å…¥æ¨¡å¡Š");break}});return U.current||(de(),U.current=!0),l},[]);const H=()=>!!(document.referrer&&document.referrer!==window.location.href||window.history.length>1),ie=()=>{H()&&window.history.back()};return r&&n?e.jsxs(e.Fragment,{children:[H()&&e.jsxs("button",{className:"back-button",onClick:ie,title:t("common.back"),children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7"})}),e.jsx("span",{children:t("common.back")})]}),e.jsx(ge,{}),e.jsx(Ze,{address:n,signingStatus:f}),e.jsx(he,{})]}):e.jsxs("div",{className:"tronwallet-login",children:[H()&&e.jsxs("button",{className:"back-button",onClick:ie,title:t("common.back"),children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7"})}),e.jsx("span",{children:t("common.back")})]}),e.jsx(ge,{}),e.jsx("div",{className:"login-icon",children:e.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]})}),e.jsx("h2",{className:"login-title",children:t("login.title")}),e.jsx("div",{className:"environment-info",children:e.jsxs("div",{className:"env-badge",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),e.jsx("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),e.jsx("line",{x1:"12",y1:"17",x2:"12",y2:"21"})]}),e.jsx("span",{className:"env-platform",children:I}),J&&J!=="Unknown"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"env-separator",children:"Â·"}),e.jsx("span",{className:"env-browser",children:J})]}),_&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"env-separator",children:"Â·"}),e.jsx("span",{className:"env-pwa-badge",children:"PWA"})]})]})}),e.jsx("p",{className:"login-description",children:Q&&b.length>0?t("login.description.detected",{wallets:b.map(l=>l.name).join("ã€")}):t(S||_&&!R?"login.description.pc":"login.description.mobile")}),h&&e.jsxs("div",{className:"error-message",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),h]}),r&&n&&f==="pending"&&e.jsx("div",{className:"signing-prompt",children:e.jsxs("div",{className:"signing-prompt-content",children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"})}),e.jsxs("div",{className:"signing-prompt-text",children:[e.jsx("p",{className:"signing-prompt-title",children:t("signing.pendingTitle","è«‹å®Œæˆç°½åä»¥å®Œæˆç™»å…¥")}),e.jsx("p",{className:"signing-prompt-desc",children:t("signing.pendingDesc","éŒ¢åŒ…å·²é€£æ¥ï¼Œè«‹åœ¨éŒ¢åŒ…ä¸­ç¢ºèªç°½åè«‹æ±‚")})]}),e.jsx("button",{className:"signing-prompt-btn",onClick:async()=>{T("pending"),p("");try{await d(n),T("success")}catch(l){const x=(l==null?void 0:l.message)||(l==null?void 0:l.toString())||"";x.includes("å–æ¶ˆ")||x.includes("rejected")||x.includes("cancel")?T("pending"):T("failed")}},children:t("signing.retry","é‡æ–°ç°½å")})]})}),e.jsx(et,{availableWallets:C,onWalletClick:async l=>{var x;console.log("[TronWalletLogin] éŒ¢åŒ…æŒ‰éˆ•è¢«é»æ“Š:",{walletName:l.adapter.name,detectedName:l.detectedName,isApp:l.isApp,detectedType:l.detectedType,availableWallets:C.map(v=>v.adapter.name),connecting:j,currentWallet:(x=N==null?void 0:N.adapter)==null?void 0:x.name});try{if(p(""),l.isApp||l.detectedType==="app"){console.log("[TronWalletLogin] æª¢æ¸¬åˆ° APP é¡å‹éŒ¢åŒ…ï¼Œä½¿ç”¨ deep link æ‰“é–‹");let v="tronlink://";l.adapter.name==="TokenPocket"?v="tpoutside://":l.adapter.name==="BitKeep"&&(v="bitkeep://");const{deepLinkUrl:W}=oe();await m(W)||p(t("errors.cannotOpenApp"));return}B.current=!0,console.log("[TronWalletLogin] é–‹å§‹è™•ç†å¿«é€Ÿé€£æ¥..."),await k(l),console.log("[TronWalletLogin] å¿«é€Ÿé€£æ¥æˆåŠŸ")}catch(v){if(v.message==="APP_TYPE_WALLET")return;console.error("[TronWalletLogin] å¿«é€Ÿé€£æ¥å¤±æ•—:",{error:v,message:v==null?void 0:v.message,stack:v==null?void 0:v.stack,walletName:l.adapter.name}),p(t("errors.connectionFailed",{error:v.message||v.toString()}))}},connecting:j,connectedWallet:N}),e.jsxs("div",{className:"login-methods",children:[e.jsx("div",{className:"official-wallet-button","data-button-text":t("login.selectWallet"),style:{"--button-text":`"${t("login.selectWallet")}"`},children:e.jsx("button",{className:"select-wallet-custom-btn",onClick:l=>{l.preventDefault(),l.stopPropagation(),console.log("[TronWalletLogin] é¸æ“‡éŒ¢åŒ…æŒ‰éˆ•è¢«é»æ“Šï¼Œæ‰“é–‹é¸æ“‡å½ˆçª—"),c(!0)},children:t("login.selectWallet")})}),Q&&ke&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"method-divider",children:e.jsx("span",{children:t("login.or")})}),e.jsxs("button",{className:"login-method-btn",onClick:ve,disabled:j,children:[e.jsx("div",{className:"method-icon",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"5",y:"2",width:"14",height:"20",rx:"2",ry:"2"}),e.jsx("line",{x1:"12",y1:"18",x2:"12.01",y2:"18"})]})}),e.jsxs("div",{className:"method-content",children:[e.jsx("h3",{children:t("login.useMobileApp")}),e.jsx("p",{children:t("login.mobileAppDesc")})]})]})]})]}),e.jsxs("div",{className:"login-tips",children:[e.jsx("p",{children:t("tips.title")}),e.jsx("ul",{children:S?E?t("tips.pcWithExtension",{wallets:b.map(l=>l.name).join("ã€")}).map((l,x)=>e.jsx("li",{children:l},x)):t("tips.pcWithoutExtension").map((l,x)=>e.jsx("li",{children:l},x)):t("tips.mobile").map((l,x)=>e.jsx("li",{children:l},x))})]}),e.jsx(he,{})]})},it=()=>[new je,new Ne,new Ee,new We],at=()=>[new Ae,new Se],lt=()=>[new Pe],ct=()=>{const t=K.METADATA;return new Re({network:K.NETWORK,options:{projectId:K.PROJECT_ID,metadata:t}})},dt=()=>{const t=[...it(),...at(),...lt()],a=ct();return a&&t.push(a),t};function ut(){return e.jsx("div",{className:"app",children:e.jsx("div",{className:"app-container",children:e.jsx(rt,{})})})}function gt(){const t=g.useMemo(()=>dt(),[]),a=n=>{console.error("éŒ¢åŒ…éŒ¯èª¤:",n)};return e.jsx(Ye,{children:e.jsx(Qe,{children:e.jsx(ot,{children:e.jsx(Me,{adapters:t,onError:a,autoConnect:!1,children:e.jsx(Oe,{children:e.jsx(ut,{})})})})})})}console.log("[Main] Before importing polyfills...");console.log("[Main] After importing polyfills, checking Buffer:",typeof window<"u"?typeof window.Buffer:"window undefined");console.log("[Main] App imports complete, Buffer check:",typeof window<"u"?typeof window.Buffer:"window undefined");Ce.createRoot(document.getElementById("root")).render(e.jsx(ye.StrictMode,{children:e.jsx(gt,{})}));
