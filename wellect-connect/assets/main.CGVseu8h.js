import{r as h,j as e,c as me,R as pe}from"./react-vendor.CY-G_Z4Y.js";import"./polyfills.CS0q3YOE.js";import{ab as U,ac as he,ad as fe,ae as we,af as xe,ag as Te,ah as Ce,ai as Le,aj as ke,ak as ve,al as Ne,am as Ee,an as We}from"./wallet-vendor.BYI0E9G4.js";import"./buffer-polyfill.D4-N1JiB.js";const ye=()=>{const[t,i]=h.useState(!0),n=async a=>{try{const o=`${a}test`;return new Promise(c=>{const r=document.createElement("iframe");r.style.display="none",r.src=o;let u=!1;const p=setTimeout(()=>{u||(u=!0,document.body.removeChild(r),c(!1))},1e3);r.onload=()=>{u||(u=!0,clearTimeout(p),document.body.removeChild(r),c(!0))},r.onerror=()=>{u||(u=!0,clearTimeout(p),document.body.removeChild(r),c(!1))},document.body.appendChild(r)})}catch(o){return console.error("æª¢æŸ¥ APP å®‰è£ç‹€æ…‹å¤±æ•—:",o),!1}},s=async a=>{try{const o=document.createElement("a");return o.href=a,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),await new Promise(c=>setTimeout(c,300)),!0}catch(o){return console.error("è§¸ç™¼ Deep Link å¤±æ•—:",o),!1}};return h.useEffect(()=>{const a=o=>{o.origin===window.location.origin&&o.data&&o.data.type==="TRONWALLET_CALLBACK"&&console.log("æ”¶åˆ° TronWallet å›žèª¿:",o.data)};return window.addEventListener("message",a),()=>{window.removeEventListener("message",a)}},[]),{isSupported:t,checkAppInstalled:n,triggerDeepLink:s}},$=()=>{const[t,i]=h.useState({isPC:!1,isMobile:!1,isIOS:!1,isAndroid:!1,isTablet:!1,hasExtension:!1,detectedWallets:[],isPWA:!1,isStandalone:!1,platform:"",browser:""});return h.useEffect(()=>{const n=()=>{const r=navigator.userAgent||navigator.vendor||window.opera,u=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(r),p=/iPad|iPhone|iPod/.test(r)&&!window.MSStream,d=/Android/.test(r),w=/iPad/.test(r)||d&&!/Mobile/.test(r),m=!u,k=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://"),v=k||window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches;let T="Unknown";r.indexOf("Chrome")>-1&&r.indexOf("Edg")===-1?T="Chrome":r.indexOf("Safari")>-1&&r.indexOf("Chrome")===-1?T="Safari":r.indexOf("Firefox")>-1?T="Firefox":r.indexOf("Edg")>-1?T="Edge":(r.indexOf("Opera")>-1||r.indexOf("OPR")>-1)&&(T="Opera");let L="Web";v?p?L="iOS PWA":d?L="Android PWA":L="PWA":m?L="Web PC":p?L="iOS Web":d&&(L="Android Web");const b=[];(window.tronWeb||window.tronLink)&&b.push({name:"TronLink",type:"extension",installed:!0}),window.tokenpocket&&b.push({name:"TokenPocket",type:"extension",installed:!0}),window.bitkeep&&window.bitkeep.tronLink&&b.push({name:"BitKeep",type:"extension",installed:!0}),window.okxwallet&&b.push({name:"OKX Wallet",type:"extension",installed:!0});const N=b.length>0;i({isPC:m,isMobile:u,isIOS:p,isAndroid:d,isTablet:w,hasExtension:N,detectedWallets:b,isPWA:v,isStandalone:k,platform:L,browser:T})};n();let s=0,a=setInterval(()=>{n(),s++,s>=5&&(clearInterval(a),a=setInterval(n,3e3))},1e3),o;const c=()=>{clearTimeout(o),o=setTimeout(n,300)};return window.addEventListener("resize",c),()=>{a&&clearInterval(a),o&&clearTimeout(o),window.removeEventListener("resize",c)}},[]),t},oe={apiBaseUrl:"https://agoramarketapi.purrtechllc.com/api"};async function be(t){const i=await fetch(`${oe.apiBaseUrl}/auth/wallet-connect/nonce`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({walletAddress:t})});if(!i.ok)throw new Error("ç²å– nonce å¤±æ•—: "+i.statusText);const n=await i.json();if(n.message&&(!n.nonce||n.nonce==="")&&n.message.includes("Nonce:")){const s=n.message.match(/Nonce:\s*([^\n]+)/);s&&s[1]&&(n.nonce=s[1].trim())}if(n.message&&!n.timestamp&&n.message.includes("Timestamp:")){const s=n.message.match(/Timestamp:\s*([^\n]+)/);if(s&&s[1]){const a=parseInt(s[1].trim());isNaN(a)||(n.timestamp=a)}}if(!n.message||n.message==="")throw new Error("ç²å– nonce å¤±æ•—ï¼šç¼ºå°‘ message å­—æ®µ");if(!n.nonce||n.nonce==="")throw new Error("ç²å– nonce å¤±æ•—ï¼šç¼ºå°‘ nonce å­—æ®µ");return n.timestamp||(n.timestamp=Math.floor(Date.now()/1e3)),n}async function je(t,i,n,s="tron"){const a={walletAddress:t,signature:i,nonce:n.nonce,timestamp:n.timestamp};s==="tron"&&(a.chain="TRC20",a.chainType="tron");const o=await fetch(`${oe.apiBaseUrl}/auth/wallet-connect/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!o.ok){const r=await o.json().catch(()=>({message:o.statusText}));throw new Error(r.message||"ç™»éŒ„å¤±æ•—: "+o.statusText)}const c=await o.json();if(!c.token||!c.refreshToken)throw new Error(c.message||"ç™»éŒ„éŸ¿æ‡‰ä¸­ç¼ºå°‘ token");return c}const O={WALLET_CONNECTED:"WALLET_CONNECTED",WALLET_DISCONNECTED:"WALLET_DISCONNECTED",WALLET_ADDRESS:"WALLET_ADDRESS",JWT_REQUEST:"JWT_REQUEST",JWT_RECEIVED:"JWT_RECEIVED",JWT_ERROR:"JWT_ERROR",READY:"READY",ERROR:"ERROR",INIT:"INIT",CLOSE:"CLOSE"},I=(t,i={})=>{const n={source:"tron-wallet-login-module",type:t,data:i,timestamp:Date.now()};window.parent&&window.parent!==window&&window.parent.postMessage(n,"*"),window.flutter_inappwebview&&window.flutter_inappwebview.callHandler("onMessage",n),window.onTronWalletLoginMessage&&window.onTronWalletLoginMessage(n)},Ae=t=>{const i=n=>{n.data&&n.data.source==="flutter-app"&&t(n.data)};return window.addEventListener("message",i),window.flutter_inappwebview&&window.flutter_inappwebview.addEventListener("message",i),()=>{window.removeEventListener("message",i),window.flutter_inappwebview&&window.flutter_inappwebview.removeEventListener("message",i)}},ee=()=>{I(O.READY,{version:"1.0.0",timestamp:Date.now()})},Se=t=>{I(O.ERROR,{error:t.message||t,stack:t.stack})},Pe={common:{connect:"é€£æŽ¥",disconnect:"æ–·é–‹é€£æŽ¥",cancel:"å–æ¶ˆ",confirm:"ç¢ºèª",loading:"è¼‰å…¥ä¸­",error:"éŒ¯èª¤",success:"æˆåŠŸ",retry:"é‡è©¦"},login:{title:"é€£æŽ¥éŒ¢åŒ…",description:{pc:"è«‹é¸æ“‡éŒ¢åŒ…é€£æŽ¥æ–¹å¼",mobile:"è«‹é¸æ“‡éŒ¢åŒ…é€²è¡Œé€£æŽ¥",detected:"æª¢æ¸¬åˆ° {wallets}ï¼Œè«‹é¸æ“‡ç™»å…¥æ–¹å¼"},selectWallet:"é¸æ“‡éŒ¢åŒ…",quickLogin:"å¿«æ·ç™»å…¥",useMobileApp:"ä½¿ç”¨æ‰‹æ©Ÿ APP",mobileAppDesc:"é€šéŽ Deep Link æ‰“é–‹ TronLink APP",or:"æˆ–"},wallet:{connected:"å·²é€£æŽ¥éŒ¢åŒ…",connectedWaitingSignature:"å·²é€£æŽ¥éŒ¢åŒ…(ç­‰å¾…ç°½å)",connectedSignatureSuccess:"å·²é€£æŽ¥éŒ¢åŒ…(ç°½åæˆåŠŸ)",redirectingToLogin:"è·³è½‰ç™»å…¥...",disconnected:"éŒ¢åŒ…å·²æ–·é–‹",connecting:"é€£æŽ¥ä¸­",address:"éŒ¢åŒ…åœ°å€ï¼š",connectingTo:"æ­£åœ¨é€£æŽ¥åˆ° {wallet}...",unknown:"æœªçŸ¥éŒ¢åŒ…"},errors:{loginFailed:"ç™»å…¥å¤±æ•—ï¼Œè«‹é‡è©¦",cannotOpenApp:"ç„¡æ³•æ‰“é–‹ TronLink APPï¼Œè«‹ç¢ºèªå·²å®‰è£ä¸¦é‡è©¦",appNotInstalled:`æœªæª¢æ¸¬åˆ° TronLink APPï¼Œæ˜¯å¦å‰å¾€ä¸‹è¼‰ï¼Ÿ

å¦‚æžœå·²å®‰è£ï¼Œè«‹é»žæ“Šå–æ¶ˆå¾Œé‡è©¦ã€‚`,signatureCanceled:"ç°½åå·²å–æ¶ˆã€‚è«‹åœ¨éŒ¢åŒ…ä¸­ç¢ºèªç°½åä»¥ç¹¼çºŒç™»å…¥ã€‚",signatureFailed:"ç°½åå¤±æ•—ï¼Œè«‹é‡è©¦",jwtFailed:"JWT èªè­‰å¤±æ•—: {error}",connectionFailed:"é€£æŽ¥å¤±æ•—: {error}",walletNotSupported:"{wallet} ä¸æ”¯æŒç°½ååŠŸèƒ½ã€‚è«‹ä½¿ç”¨æ”¯æŒç°½åçš„éŒ¢åŒ…ï¼ˆå¦‚ TronLinkã€Ledger ç­‰ï¼‰ã€‚",ledgerTimeout:"Ledger ç°½åè¶…æ™‚ã€‚è«‹ç¢ºä¿è¨­å‚™å·²é€£æŽ¥ä¸¦è§£éŽ–ï¼Œç„¶å¾Œé‡è©¦ã€‚",ledgerNotConnected:"Ledger è¨­å‚™æœªé€£æŽ¥ã€‚è«‹é€£æŽ¥è¨­å‚™å¾Œé‡è©¦ã€‚",ledgerConfirm:"è«‹åœ¨ Ledger è¨­å‚™ä¸Šç¢ºèªç°½å...",nonceFailed:"ç²å– nonce å¤±æ•—: {error}",verifyFailed:"ç™»éŒ„å¤±æ•—: {error}",unknownError:"æœªçŸ¥éŒ¯èª¤"},tips:{title:"ðŸ’¡ æç¤ºï¼š",pcWithExtension:["æª¢æ¸¬åˆ° {wallets} æ“´å±•","é»žæ“Šä¸Šæ–¹æŒ‰éˆ•é¸æ“‡éŒ¢åŒ…é€²è¡Œé€£æŽ¥","æ”¯æŒå¤šç¨®éŒ¢åŒ…ï¼šç€è¦½å™¨æ“´å±•ã€ç§»å‹•ç«¯éŒ¢åŒ…ã€ç¡¬ä»¶éŒ¢åŒ…","é¦–æ¬¡ä½¿ç”¨éœ€è¦åœ¨éŒ¢åŒ…ä¸­æŽˆæ¬Š"],pcWithoutExtension:["æŽ¨è–¦å®‰è£ TronLinkã€TokenPocket ç­‰ç€è¦½å™¨æ“´å±•","æˆ–ä½¿ç”¨ WalletConnect é€£æŽ¥ç§»å‹•ç«¯éŒ¢åŒ…","æ”¯æŒ Ledger ç¡¬ä»¶éŒ¢åŒ…","é»žæ“Šä¸Šæ–¹æŒ‰éˆ•æŸ¥çœ‹æ‰€æœ‰å¯ç”¨é¸é …"],mobile:["ç§»å‹•ç«¯æŽ¨è–¦ä½¿ç”¨ WalletConnect é€£æŽ¥éŒ¢åŒ…","æˆ–é€šéŽ Deep Link æ‰“é–‹ TronLink APP","æ”¯æŒ Trust Walletã€ImToken ç­‰ç§»å‹•ç«¯éŒ¢åŒ…","é»žæ“Šä¸Šæ–¹æŒ‰éˆ•æŸ¥çœ‹æ‰€æœ‰å¯ç”¨é¸é …"]},modal:{connectWalletTitle:"é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ",detected:"å·²æª¢æ¸¬",notFound:"æœªæ‰¾åˆ°",installed:"å·²å®‰è£",notInstalled:"æœªå®‰è£",loading:"è¼‰å…¥ä¸­",connecting:"é€£æŽ¥ä¸­",connected:"å·²é€£æŽ¥",disconnect:"æ–·é–‹é€£æŽ¥"},environment:{webPC:"Web PC",webMobile:"Web ç§»å‹•ç«¯",iosWeb:"iOS Web",androidWeb:"Android Web",iosPWA:"iOS PWA",androidPWA:"Android PWA",pwa:"PWA"},process:{gettingNonce:"ðŸ“¨ æ­£åœ¨ç²å– nonce...",nonceSuccess:"âœ… Nonce ç²å–æˆåŠŸ",signing:"âœï¸ æ­£åœ¨ç°½åæ¶ˆæ¯...",signatureSuccess:"âœ… ç°½åæˆåŠŸ",verifying:"ðŸ” æ­£åœ¨é©—è­‰ç°½åä¸¦ç™»å…¥...",loginSuccess:"âœ… ç™»å…¥æˆåŠŸï¼Œå·²ç²å– Token",jwtSent:"âœ… JWT Token å·²ç™¼é€çµ¦ Flutter",ledgerDetected:"ðŸ” æª¢æ¸¬åˆ° Ledger ç¡¬ä»¶éŒ¢åŒ…ï¼Œè«‹åœ¨è¨­å‚™ä¸Šç¢ºèªç°½å..."},signing:{pendingTitle:"è«‹å®Œæˆç°½åä»¥å®Œæˆç™»å…¥",pendingDesc:"éŒ¢åŒ…å·²é€£æŽ¥ï¼Œè«‹åœ¨éŒ¢åŒ…ä¸­ç¢ºèªç°½åè«‹æ±‚",retry:"é‡æ–°ç°½å"}},Oe={common:{connect:"Connect",disconnect:"Disconnect",cancel:"Cancel",confirm:"Confirm",loading:"Loading",error:"Error",success:"Success",retry:"Retry"},login:{title:"Connect Wallet",description:{pc:"Please select wallet connection method",mobile:"Please select a wallet to connect",detected:"Detected {wallets}, please select login method"},selectWallet:"Select Wallet",quickLogin:"Quick Login",useMobileApp:"Use Mobile APP",mobileAppDesc:"Open TronLink APP via Deep Link",or:"or"},wallet:{connected:"Wallet Connected",connectedWaitingSignature:"Wallet Connected (Waiting for Signature)",connectedSignatureSuccess:"Wallet Connected (Signature Success)",redirectingToLogin:"Redirecting to Login...",disconnected:"Wallet Disconnected",connecting:"Connecting",address:"Wallet Address:",connectingTo:"Connecting to {wallet}...",unknown:"Unknown Wallet"},errors:{loginFailed:"Login failed, please try again",cannotOpenApp:"Cannot open TronLink APP, please confirm it is installed and try again",appNotInstalled:`TronLink APP not detected, go to download?

If already installed, please click cancel and try again.`,signatureCanceled:"Signature canceled. Please confirm the signature in the wallet to continue login.",signatureFailed:"Signature failed, please try again",jwtFailed:"JWT authentication failed: {error}",connectionFailed:"Connection failed: {error}",walletNotSupported:"{wallet} does not support signature function. Please use a wallet that supports signatures (such as TronLink, Ledger, etc.).",ledgerTimeout:"Ledger signature timeout. Please ensure the device is connected and unlocked, then try again.",ledgerNotConnected:"Ledger device not connected. Please connect the device and try again.",ledgerConfirm:"Please confirm signature on Ledger device...",nonceFailed:"Failed to get nonce: {error}",verifyFailed:"Login failed: {error}",unknownError:"Unknown error"},tips:{title:"ðŸ’¡ Tips:",pcWithExtension:["Detected {wallets} extension","Click the button above to select wallet for connection","Supports multiple wallets: browser extensions, mobile wallets, hardware wallets","First-time use requires authorization in the wallet"],pcWithoutExtension:["Recommended to install TronLink, TokenPocket and other browser extensions","Or use WalletConnect to connect mobile wallets","Supports Ledger hardware wallet","Click the button above to view all available options"],mobile:["Mobile devices recommend using WalletConnect to connect wallets","Or open TronLink APP via Deep Link","Supports Trust Wallet, ImToken and other mobile wallets","Click the button above to view all available options"]},modal:{connectWalletTitle:"Connect a wallet on Tron to continue",detected:"Detected",notFound:"NotFound",installed:"Installed",notInstalled:"NotInstalled",loading:"Loading",connecting:"Connecting",connected:"Connected",disconnect:"Disconnect"},environment:{webPC:"Web PC",webMobile:"Web Mobile",iosWeb:"iOS Web",androidWeb:"Android Web",iosPWA:"iOS PWA",androidPWA:"Android PWA",pwa:"PWA"},process:{gettingNonce:"ðŸ“¨ Getting nonce...",nonceSuccess:"âœ… Nonce obtained successfully",signing:"âœï¸ Signing message...",signatureSuccess:"âœ… Signature successful",verifying:"ðŸ” Verifying signature and logging in...",loginSuccess:"âœ… Login successful, Token obtained",jwtSent:"âœ… JWT Token sent to Flutter",ledgerDetected:"ðŸ” Ledger hardware wallet detected, please confirm signature on device..."},signing:{pendingTitle:"Please complete signature to finish login",pendingDesc:"Wallet connected, please confirm signature request in wallet",retry:"Retry Signature"}},se=h.createContext(),B=()=>{const t=h.useContext(se);if(!t)throw new Error("useLanguage must be used within LanguageProvider");return t},Me=({children:t})=>{const i=()=>{try{return localStorage.getItem("wallet-login-language")==="en"?"en":"zh"}catch{return"zh"}},[n,s]=h.useState(i),a={zh:Pe,en:Oe},o=(d,w={})=>{const m=d.split(".");let k=a[n];for(const v of m)if(k&&typeof k=="object")k=k[v];else return d;return typeof k=="string"&&Object.keys(w).length>0?k.replace(/\{(\w+)\}/g,(v,T)=>w[T]!==void 0?w[T]:v):Array.isArray(k)&&Object.keys(w).length>0?k.map(v=>typeof v=="string"?v.replace(/\{(\w+)\}/g,(T,L)=>w[L]!==void 0?w[L]:T):v):k||d},c=d=>{(d==="zh"||d==="en")&&(s(d),localStorage.setItem("wallet-login-language",d),window.dispatchEvent(new Event("languageChanged")))},r=()=>n,u=()=>n==="zh",p=()=>n==="en";return e.jsx(se.Provider,{value:{language:n,t:o,changeLanguage:c,getLanguage:r,isZh:u,isEn:p},children:t})},Re=()=>{const[t,i]=h.useState(""),{signMessage:n,wallet:s}=U(),{t:a}=B(),o=h.useCallback(async c=>{var r,u;try{i(""),console.log(a("process.gettingNonce"));const p=await be(c);if(console.log(a("process.nonceSuccess"),p.nonce),!n){const w=((r=s==null?void 0:s.adapter)==null?void 0:r.name)||a("wallet.unknown");throw new Error(a("errors.walletNotSupported",{wallet:w}))}const d=((u=s==null?void 0:s.adapter)==null?void 0:u.name)==="Ledger";d?(console.log(a("process.ledgerDetected")),i(a("errors.ledgerConfirm"))):console.log(a("process.signing"));try{const w=await n(p.message);console.log(a("process.signatureSuccess")),d&&i(""),console.log(a("process.verifying"));const m=await je(c,w,p,"tron");console.log(a("process.loginSuccess")),I(O.JWT_RECEIVED,{token:m.token,refreshToken:m.refreshToken,user:m.user,address:c,timestamp:Date.now()}),console.log(a("process.jwtSent"))}catch(w){const m=w.message||w.toString();if(m.includes("rejected")||m.includes("denied")||m.includes("cancel")||m.includes("å–æ¶ˆ")||m.includes("æ‹’çµ•"))throw new Error(a("errors.signatureCanceled"));if(d){if(m.includes("timeout")||m.includes("è¶…æ™‚"))throw new Error(a("errors.ledgerTimeout"));if(m.includes("not connected")||m.includes("æœªé€£æŽ¥"))throw new Error(a("errors.ledgerNotConnected"))}throw w}}catch(p){throw console.error("âŒ JWT è«‹æ±‚å¤±æ•—:",p),Se(p),i(a("errors.jwtFailed",{error:p.message||p.toString()})),p}},[n,s,a]);return{error:t,setError:i,handleJWTRequest:o}},_={TRONWALLET_SCHEME:"tronlink://",TRONWALLET_UNIVERSAL_LINK:"https://www.tronlink.org/",CALLBACK_PATH:"/callback"},Q={PROJECT_ID:"7412eb629501759c091220ccc09ded23",NETWORK:"mainnet",METADATA:{name:"TRON éŒ¢åŒ…ç™»å…¥æ¨¡å¡Š",description:"TRON éŒ¢åŒ…ç™»å…¥æ¨¡å¡Š - Flutter Web é›†æˆ",get url(){return window.location.origin},get icons(){return[`${window.location.origin}/favicon.ico`]}}},De={TronLink:"TronLink",TokenPocket:"TokenPocket",BitKeep:"BitKeep","OKX Wallet":"OkxWallet"},Ie=()=>{const{wallets:t,select:i,connect:n,connecting:s,connected:a,wallet:o}=U(),{detectedWallets:c}=$();return{availableWallets:h.useMemo(()=>!t||c.length===0?[]:c.map(d=>{const w=De[d.name];if(!w)return null;const m=t.find(k=>k.adapter.name===w||k.adapter.name.toLowerCase().includes(d.name.toLowerCase()));return m?{...m,detectedName:d.name}:null}).filter(Boolean),[t,c]),handleQuickConnect:async p=>{var w,m,k,v,T,L,b,N,E;const d=p.adapter.name;console.log("[QuickLogin] é–‹å§‹é€£æŽ¥éŒ¢åŒ…:",{walletName:d,availableWallets:t.map(x=>x.adapter.name),currentWallet:(w=o==null?void 0:o.adapter)==null?void 0:w.name,connecting:s,connected:a});try{const x=t.find(W=>W.adapter.name===d);if(console.log("[QuickLogin] æŸ¥æ‰¾éŒ¢åŒ…é©é…å™¨:",{walletName:d,found:!!x,targetWalletName:(m=x==null?void 0:x.adapter)==null?void 0:m.name,allWallets:t.map(W=>({name:W.adapter.name,readyState:W.adapter.readyState}))}),!x)throw new Error(`æ‰¾ä¸åˆ°éŒ¢åŒ…é©é…å™¨: ${d}`);console.log("[QuickLogin] æ­¥é©Ÿ 1: é¸æ“‡éŒ¢åŒ…",d),await i(d),console.log("[QuickLogin] æ­¥é©Ÿ 1 å®Œæˆ: select() å·²èª¿ç”¨"),console.log("[QuickLogin] æ­¥é©Ÿ 2: ç­‰å¾…é¸æ“‡å®Œæˆ..."),await new Promise(W=>setTimeout(W,500)),console.log("[QuickLogin] é¸æ“‡å¾Œç‹€æ…‹:",{currentWallet:(k=o==null?void 0:o.adapter)==null?void 0:k.name,expectedWallet:d,match:((v=o==null?void 0:o.adapter)==null?void 0:v.name)===d}),console.log("[QuickLogin] æ­¥é©Ÿ 3: é–‹å§‹é€£æŽ¥éŒ¢åŒ…..."),await n(),console.log("[QuickLogin] æ­¥é©Ÿ 3 å®Œæˆ: connect() æˆåŠŸ")}catch(x){console.error("[QuickLogin] å¿«é€Ÿé€£æŽ¥éŒ¯èª¤:",{error:x,message:x==null?void 0:x.message,stack:x==null?void 0:x.stack,walletName:d,currentWallet:(T=o==null?void 0:o.adapter)==null?void 0:T.name,connecting:s,connected:a});const W=(x==null?void 0:x.message)||(x==null?void 0:x.toString())||"";if(W.includes("No wallet is selected")||W.includes("not selected"))try{console.log('[QuickLogin] æª¢æ¸¬åˆ° "No wallet is selected" éŒ¯èª¤ï¼Œå˜—è©¦é‡è©¦...'),console.log("[QuickLogin] é‡è©¦å‰ç‹€æ…‹:",{walletName:d,currentWallet:(L=o==null?void 0:o.adapter)==null?void 0:L.name,wallets:t.map(C=>C.adapter.name)}),console.log("[QuickLogin] é‡è©¦: å†æ¬¡é¸æ“‡éŒ¢åŒ…",d),await i(d),console.log("[QuickLogin] é‡è©¦: ç­‰å¾…é¸æ“‡å®Œæˆ..."),await new Promise(C=>setTimeout(C,800)),console.log("[QuickLogin] é‡è©¦å¾Œç‹€æ…‹:",{currentWallet:(b=o==null?void 0:o.adapter)==null?void 0:b.name,expectedWallet:d,match:((N=o==null?void 0:o.adapter)==null?void 0:N.name)===d}),console.log("[QuickLogin] é‡è©¦: å†æ¬¡å˜—è©¦é€£æŽ¥..."),await n(),console.log("[QuickLogin] é‡è©¦æˆåŠŸ")}catch(C){console.error("[QuickLogin] é‡è©¦é€£æŽ¥å¤±æ•—:",{error:C,message:C==null?void 0:C.message,stack:C==null?void 0:C.stack,walletName:d,currentWallet:(E=o==null?void 0:o.adapter)==null?void 0:E.name});const A=(C==null?void 0:C.message)||(C==null?void 0:C.toString())||"";throw A.includes("No wallet is selected")||A.includes("not selected")?new Error(`ç„¡æ³•é¸æ“‡éŒ¢åŒ… ${d}ã€‚è«‹ç¢ºä¿ TronLink æ“´å±•å·²å®‰è£ä¸¦å•Ÿç”¨ã€‚`):C}else throw x}},connecting:s,connected:a,currentWallet:o}};function J(){try{return localStorage.getItem("wallet-login-language")==="en"?"en":"zh"}catch{return"zh"}}const Fe={"Connect a wallet on Tron to continue.":"é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ","Connect a wallet on Tron to continue":"é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ","Connect a wallet on":"é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ","Tron to continue":"é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ","Connect a wallet":"é€£æŽ¥éŒ¢åŒ…",Detected:"å·²æª¢æ¸¬",NotFound:"æœªæ‰¾åˆ°",NotDetected:"æœªæª¢æ¸¬",Installed:"å·²å®‰è£",NotInstalled:"æœªå®‰è£",Loading:"è¼‰å…¥ä¸­",Connecting:"é€£æŽ¥ä¸­",Connected:"å·²é€£æŽ¥",Disconnect:"æ–·é–‹é€£æŽ¥","Select Wallet":"é¸æ“‡éŒ¢åŒ…",Wallet:"éŒ¢åŒ…","on Tron":"TRON","to continue":"ä»¥ç¹¼çºŒ"},_e={"Connect a wallet on Tron to continue.":"Connect a wallet on Tron to continue.","Connect a wallet on Tron to continue":"Connect a wallet on Tron to continue","Connect a wallet on":"Connect a wallet on","Tron to continue":"Tron to continue","Connect a wallet":"Connect a wallet",Detected:"Detected",NotFound:"NotFound",NotDetected:"NotDetected",Installed:"Installed",NotInstalled:"NotInstalled",Loading:"Loading",Connecting:"Connecting",Connected:"Connected",Disconnect:"Disconnect","Select Wallet":"Select Wallet",Wallet:"Wallet","on Tron":"on Tron","to continue":"to continue"};function ae(){return J()==="zh"?Fe:_e}function te(t){if(!t)return t;const i=ae();J()==="zh"&&(t=t.replace(/Connect a wallet on Tron to continue\.?/gi,i["Connect a wallet on Tron to continue"]),t=t.replace(/Connect a wallet on\s*$/gi,i["Connect a wallet on Tron to continue"]),t.includes(i["Connect a wallet on Tron to continue"])?t=t.replace(/Tron to continue\.?/gi,""):t=t.replace(/Tron to continue\.?/gi,""));for(const[s,a]of Object.entries(i)){if(t.trim()===s)return a;const o=new RegExp(`^\\s*${s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\s*$`,"gi");t=t.replace(o,a)}return t}function ie(t){if(t){if(t.nodeType===Node.TEXT_NODE){const i=t.textContent,n=te(i);n!==i&&(t.textContent=n)}else if(t.nodeType===Node.ELEMENT_NODE){const i=t.textContent&&(t.textContent.includes("Connect a wallet")||t.textContent.includes("Detected")||t.textContent.includes("NotFound")||t.textContent.includes("Select Wallet"));if(t.dataset.translated==="true"&&!i)return;const n=t.textContent.trim(),a=ae()["Connect a wallet on Tron to continue"];if(n.includes("Connect a wallet on Tron to continue")||n.includes("Connect a wallet on")&&n.includes("Tron to continue")){t.innerHTML=a,t.dataset.translated="true";return}if(t.children.length===0){const o=t.textContent.trim(),c=te(o);if(c!==o){t.textContent=c,t.dataset.translated="true";return}}Array.from(t.childNodes).forEach(o=>{ie(o)})}}}function Be(t){if(!t)return!1;if(t.textContent.trim().includes("Connect a wallet on Tron to continue"))return t.innerHTML="é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ",t.dataset.translated="true",!0;const n=Array.from(t.childNodes);let s=!1,a=!1,o=null,c=null;return n.forEach(r=>{const u=r.textContent.trim();(u.includes("Connect a wallet on")||u==="Connect a wallet on")&&(s=!0,o=r),(u.includes("Tron to continue")||u==="Tron to continue")&&(a=!0,c=r)}),s&&a?(o&&(o.textContent="é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ",o.dataset.translated="true"),c&&(c.textContent=""),t.dataset.translated="true",!0):(n.forEach(r=>{if(r.nodeType===Node.TEXT_NODE){const u=r.textContent.trim();if(u==="Connect a wallet on"||u.includes("Connect a wallet on"))r.textContent="é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ";else if(u==="Tron to continue"||u.includes("Tron to continue")){const p=r.previousSibling;p&&p.textContent&&p.textContent.includes("é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ"),r.textContent=""}}else if(r.nodeType===Node.ELEMENT_NODE){const u=r.textContent.trim();u==="Connect a wallet on"||u.includes("Connect a wallet on")?(r.textContent="é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ",r.dataset.translated="true"):(u==="Tron to continue"||u.includes("Tron to continue"))&&(r.textContent="")}}),!1)}function D(){['[role="dialog"]','[class*="wallet-adapter"]','[class*="wallet-modal"]','[class*="WalletModal"]','[class*="modal"]'].forEach(i=>{try{document.querySelectorAll(i).forEach(s=>{s&&(s.textContent&&(s.textContent.includes("Connect a wallet")||s.textContent.includes("Detected")||s.textContent.includes("NotFound")||s.textContent.includes("Select Wallet")||s.textContent.includes("NotDetected")||s.textContent.includes("NotInstalled"))&&(s.dataset.translated="false",s.querySelectorAll('[data-translated="true"]').forEach(o=>{o.dataset.translated="false"})),(!s.dataset.translated||s.dataset.translated==="false")&&(s.querySelectorAll('h1, h2, h3, h4, h5, h6, [class*="title"], [class*="Title"]').forEach(c=>{(!c.dataset.translated||c.dataset.translated==="false")&&Be(c)}),ie(s),s.dataset.translated="true"))})}catch{}})}function qe(t=null){t||J();const i=new MutationObserver(o=>{let c=!1;o.forEach(r=>{r.addedNodes.forEach(u=>{var p;if(u.nodeType===Node.ELEMENT_NODE){const d=((p=u.classList)==null?void 0:p.toString())||"",w=u.getAttribute("role")||"";(d.includes("wallet")||d.includes("modal")||w==="dialog"||u.querySelector('[role="dialog"]')||u.querySelector('[class*="wallet"]')||u.querySelector('[class*="modal"]'))&&(c=!0)}})}),c&&requestAnimationFrame(()=>{D(),requestAnimationFrame(()=>{D()})})});document.body&&i.observe(document.body,{childList:!0,subtree:!0});const n=()=>{D()};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n):n();const s=setInterval(()=>{D()},200),a=()=>{document.querySelectorAll('[data-translated="true"]').forEach(o=>{o.dataset.translated="false"}),D()};return window.addEventListener("storage",a),window.addEventListener("languageChanged",a),{disconnect:()=>{i.disconnect(),clearInterval(s),window.removeEventListener("storage",a),window.removeEventListener("languageChanged",a)}}}const re=h.createContext(),Qe=()=>{const t=h.useContext(re);if(!t)throw new Error("useTheme must be used within ThemeProvider");return t},Ue=({children:t})=>{const i=()=>{try{const o=localStorage.getItem("wallet-login-theme");return o?o==="dark"?"dark":"light":window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}catch{return"light"}},[n,s]=h.useState(i),a=()=>{const o=n==="light"?"dark":"light";s(o),localStorage.setItem("wallet-login-theme",o),document.documentElement.setAttribute("data-theme",o)};return h.useEffect(()=>{document.documentElement.setAttribute("data-theme",n)},[n]),h.useEffect(()=>{const o=window.matchMedia("(prefers-color-scheme: dark)"),c=r=>{localStorage.getItem("wallet-login-theme")||s(r.matches?"dark":"light")};return o.addEventListener("change",c),()=>o.removeEventListener("change",c)},[]),e.jsx(re.Provider,{value:{theme:n,toggleTheme:a,isDark:n==="dark",isLight:n==="light"},children:t})},ne=()=>{const{language:t,changeLanguage:i}=B(),{theme:n,toggleTheme:s}=Qe();return e.jsxs("div",{className:"language-switcher",children:[e.jsx("button",{className:"theme-btn",onClick:s,title:n==="light"?"åˆ‡æ›åˆ°æ·±è‰²ä¸»é¡Œ":"åˆ‡æ›åˆ°æ·ºè‰²ä¸»é¡Œ","aria-label":n==="light"?"Switch to dark theme":"Switch to light theme",children:n==="light"?e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})}):e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),e.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),e.jsx("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),e.jsx("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),e.jsx("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),e.jsx("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),e.jsx("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),e.jsx("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]})}),e.jsx("button",{className:`lang-btn ${t==="zh"?"active":""}`,onClick:()=>i("zh"),title:"ä¸­æ–‡",children:"ä¸­æ–‡"}),e.jsx("button",{className:`lang-btn ${t==="en"?"active":""}`,onClick:()=>i("en"),title:"English",children:"EN"})]})},$e=({address:t,signingStatus:i})=>{const{t:n}=B(),{platform:s,browser:a,isPWA:o}=$(),r=i==="pending"?{title:n("wallet.connectedWaitingSignature","å·²é€£æŽ¥éŒ¢åŒ…(ç­‰å¾…ç°½å)"),icon:e.jsx("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"})}),className:"status-waiting"}:i==="success"?{title:n("wallet.connectedSignatureSuccess","å·²é€£æŽ¥éŒ¢åŒ…(ç°½åæˆåŠŸ)"),icon:e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),className:"status-success"}:{title:n("wallet.connected","å·²é€£æŽ¥éŒ¢åŒ…"),icon:e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),className:"status-default"};return e.jsxs("div",{className:"wallet-info",children:[e.jsxs("div",{className:`success-message ${r.className}`,children:[e.jsx("div",{className:"status-icon-wrapper",children:r.icon}),e.jsx("h2",{children:r.title}),i==="success"&&e.jsx("p",{className:"login-redirect-message",children:n("wallet.redirectingToLogin","è·³è½‰ç™»å…¥...")})]}),e.jsx("div",{className:"environment-info",children:e.jsxs("div",{className:"env-badge",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),e.jsx("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),e.jsx("line",{x1:"12",y1:"17",x2:"12",y2:"21"})]}),e.jsx("span",{className:"env-platform",children:s}),a&&a!=="Unknown"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"env-separator",children:"Â·"}),e.jsx("span",{className:"env-browser",children:a})]}),o&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"env-separator",children:"Â·"}),e.jsx("span",{className:"env-pwa-badge",children:"PWA"})]})]})}),e.jsxs("div",{className:"address-display",children:[e.jsxs("label",{children:[n("wallet.address"),"ï¼š"]}),e.jsx("div",{className:"address-value",children:t})]}),e.jsx("div",{className:"wallet-actions",children:e.jsx(he,{})})]})},Je=({availableWallets:t,onWalletClick:i,connecting:n,connectedWallet:s})=>t.length===0?null:e.jsx("div",{className:"quick-login-section",children:e.jsx("div",{className:"quick-login-buttons",children:t.map(a=>{var r,u;const o=a.adapter.name===((r=s==null?void 0:s.adapter)==null?void 0:r.name),c=n&&o;return e.jsxs("button",{className:"quick-login-btn",onClick:()=>i(a),disabled:c,children:[e.jsxs("div",{className:"quick-login-icon",children:[a.adapter.icon&&e.jsx("img",{src:a.adapter.icon,alt:a.detectedName,onError:p=>{p.target.style.display="none"}}),(!a.adapter.icon||!a.adapter.icon.startsWith("data:"))&&e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]})]}),e.jsx("span",{className:"quick-login-name",children:a.detectedName}),n&&a.adapter.name===((u=s==null?void 0:s.adapter)==null?void 0:u.name)&&e.jsx("div",{className:"quick-login-spinner"})]},a.adapter.name)})})}),ze=()=>{var X;const{t,language:i}=B(),{address:n,connected:s,wallet:a,select:o,connect:c}=U(),{setVisible:r}=fe(),{triggerDeepLink:u,checkAppInstalled:p}=ye(),d=$(),{error:w,setError:m,handleJWTRequest:k}=Re(),[v,T]=h.useState(null),{availableWallets:L,handleQuickConnect:b,connecting:N,currentWallet:E}=Ie(),{isPC:x,isMobile:W,hasExtension:C,detectedWallets:A,platform:le,browser:q,isPWA:ce}=d,z=h.useRef(s),K=h.useRef(n),F=h.useRef(!1),V=h.useRef(L.length),H=h.useRef(s);h.useEffect(()=>{var l;(L.length!==V.current||s!==H.current)&&(console.log("[TronWalletLogin] çµ„ä»¶ç‹€æ…‹æ›´æ–°:",{availableWalletsCount:L.length,availableWallets:L.map(g=>({name:g.adapter.name,detectedName:g.detectedName})),detectedWallets:A.map(g=>g.name),hasExtension:C,connecting:N,connected:s,currentWallet:(l=E==null?void 0:E.adapter)==null?void 0:l.name,address:n}),V.current=L.length,H.current=s)},[L.length,A.length,C,N,s,(X=E==null?void 0:E.adapter)==null?void 0:X.name,n]);const de=()=>{const g=`login_${Date.now()}`,f=encodeURIComponent(window.location.origin+_.CALLBACK_PATH);return{deepLinkUrl:`${_.TRONWALLET_SCHEME}login?callback=${f}&requestId=${g}`,requestId:g,callbackUrl:f}},ue=async()=>{m("");try{const{deepLinkUrl:l}=de();if(W&&!await p(_.TRONWALLET_SCHEME)){window.confirm(t("errors.appNotInstalled"))&&window.open(_.TRONWALLET_UNIVERSAL_LINK,"_blank");return}await u(l)||m(t("errors.cannotOpenApp"))}catch(l){console.error("APP ç™»å…¥éŒ¯èª¤:",l),m(t("errors.loginFailed"))}};h.useEffect(()=>{const l=new URLSearchParams(window.location.search),g=l.get("address"),f=l.get("requestId");g&&f&&(window.history.replaceState({},document.title,window.location.pathname),console.log("æ”¶åˆ° Deep Link å›žèª¿:",{address:g,requestId:f}))},[]);const M=h.useRef(null);h.useEffect(()=>{var g;const l=(g=a==null?void 0:a.adapter)==null?void 0:g.name;a&&!s&&!N&&l!==M.current?(console.log("[TronWalletLogin] æª¢æ¸¬åˆ°æ–°éŒ¢åŒ…è¢«é¸æ“‡ï¼Œå˜—è©¦é€£æŽ¥:",{walletName:l,connected:s,connecting:N,prevWalletName:M.current}),M.current=l,c().catch(f=>{console.error("[TronWalletLogin] è‡ªå‹•é€£æŽ¥å¤±æ•—:",f),m(t("errors.connectionFailed",{error:f.message||f.toString()}))})):l?M.current=l:a||(M.current=null)},[a,s,N,c,m,t]),h.useEffect(()=>{var f,S,P;const l=z.current,g=K.current;(s!==l||n!==g)&&console.log("[TronWalletLogin] é€£æŽ¥ç‹€æ…‹è®ŠåŒ–:",{wasConnected:l,connected:s,prevAddress:g,address:n,wallet:(f=a==null?void 0:a.adapter)==null?void 0:f.name,connecting:N,stackTrace:(S=new Error().stack)==null?void 0:S.split(`
`).slice(0,5).join(`
`)}),s&&n?(!l||g!==n)&&(console.log("[TronWalletLogin] è§¸ç™¼é€£æŽ¥æµç¨‹:",{wasConnected:l,connected:s,prevAddress:g,address:n,wallet:(P=a==null?void 0:a.adapter)==null?void 0:P.name}),m(""),T("pending"),I(O.WALLET_CONNECTED,{address:n,timestamp:Date.now()}),(!l||g!==n)&&k(n).then(()=>{T("success")}).catch(j=>{const y=(j==null?void 0:j.message)||(j==null?void 0:j.toString())||"";y.includes("å–æ¶ˆ")||y.includes("rejected")||y.includes("cancel")?T("pending"):T("failed")})):!s&&l&&(console.log("[TronWalletLogin] è§¸ç™¼æ–·é–‹æµç¨‹"),T(null),I(O.WALLET_DISCONNECTED,{timestamp:Date.now()})),z.current=s,K.current=n},[s,n]),h.useEffect(()=>{const l=()=>{const P=document.querySelectorAll(".official-wallet-button button");if(P.length===0)return;const j=document.documentElement.getAttribute("data-theme")==="dark";P.forEach(y=>{y instanceof HTMLElement&&(j?(y.style.setProperty("background","transparent","important"),y.style.setProperty("border","2px solid #4b5563","important")):(y.style.setProperty("background","transparent","important"),y.style.setProperty("border","2px solid #e5e7eb","important")),y.style.setProperty("background-image","none","important"))})},g=setTimeout(()=>{requestAnimationFrame(l)},100),f=new MutationObserver(P=>{P.some(y=>Array.from(y.addedNodes).some(R=>{var Z,Y;return R.nodeType===1&&(((Z=R.classList)==null?void 0:Z.contains("official-wallet-button"))||((Y=R.querySelector)==null?void 0:Y.call(R,".official-wallet-button button")))}))&&requestAnimationFrame(l)}),S=document.querySelector(".tronwallet-login");return S&&f.observe(S,{childList:!0,subtree:!0}),()=>{clearTimeout(g),f.disconnect()}},[L.length]),h.useEffect(()=>{const l=qe(i);return()=>{l&&l.disconnect&&l.disconnect()}},[i]),h.useEffect(()=>{const l=Ae(g=>{switch(g.type){case O.INIT:F.current||(ee(),F.current=!0);break;case O.CLOSE:console.log("Flutter è«‹æ±‚é—œé–‰ç™»å…¥æ¨¡å¡Š");break}});return F.current||(ee(),F.current=!0),l},[]);const G=x&&C,ge=W||!C;return s&&n?e.jsxs(e.Fragment,{children:[e.jsx(ne,{}),e.jsx($e,{address:n,signingStatus:v})]}):e.jsxs("div",{className:"tronwallet-login",children:[e.jsx(ne,{}),e.jsx("div",{className:"login-icon",children:e.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]})}),e.jsx("h2",{className:"login-title",children:t("login.title")}),e.jsx("div",{className:"environment-info",children:e.jsxs("div",{className:"env-badge",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),e.jsx("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),e.jsx("line",{x1:"12",y1:"17",x2:"12",y2:"21"})]}),e.jsx("span",{className:"env-platform",children:le}),q&&q!=="Unknown"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"env-separator",children:"Â·"}),e.jsx("span",{className:"env-browser",children:q})]}),ce&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"env-separator",children:"Â·"}),e.jsx("span",{className:"env-pwa-badge",children:"PWA"})]})]})}),e.jsx("p",{className:"login-description",children:G&&A.length>0?t("login.description.detected",{wallets:A.map(l=>l.name).join("ã€")}):t(x?"login.description.pc":"login.description.mobile")}),w&&e.jsxs("div",{className:"error-message",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),w]}),s&&n&&v==="pending"&&e.jsx("div",{className:"signing-prompt",children:e.jsxs("div",{className:"signing-prompt-content",children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"})}),e.jsxs("div",{className:"signing-prompt-text",children:[e.jsx("p",{className:"signing-prompt-title",children:t("signing.pendingTitle","è«‹å®Œæˆç°½åä»¥å®Œæˆç™»å…¥")}),e.jsx("p",{className:"signing-prompt-desc",children:t("signing.pendingDesc","éŒ¢åŒ…å·²é€£æŽ¥ï¼Œè«‹åœ¨éŒ¢åŒ…ä¸­ç¢ºèªç°½åè«‹æ±‚")})]}),e.jsx("button",{className:"signing-prompt-btn",onClick:async()=>{T("pending"),m("");try{await k(n),T("success")}catch(l){const g=(l==null?void 0:l.message)||(l==null?void 0:l.toString())||"";g.includes("å–æ¶ˆ")||g.includes("rejected")||g.includes("cancel")?T("pending"):T("failed")}},children:t("signing.retry","é‡æ–°ç°½å")})]})}),e.jsx(Je,{availableWallets:L,onWalletClick:async l=>{var g;console.log("[TronWalletLogin] TronLink æŒ‰éˆ•è¢«é»žæ“Š:",{walletName:l.adapter.name,detectedName:l.detectedName,availableWallets:L.map(f=>f.adapter.name),connecting:N,currentWallet:(g=E==null?void 0:E.adapter)==null?void 0:g.name});try{m(""),console.log("[TronWalletLogin] é–‹å§‹è™•ç†å¿«é€Ÿé€£æŽ¥..."),await b(l),console.log("[TronWalletLogin] å¿«é€Ÿé€£æŽ¥æˆåŠŸ")}catch(f){console.error("[TronWalletLogin] å¿«é€Ÿé€£æŽ¥å¤±æ•—:",{error:f,message:f==null?void 0:f.message,stack:f==null?void 0:f.stack,walletName:l.adapter.name}),m(t("errors.connectionFailed",{error:f.message||f.toString()}))}},connecting:N,connectedWallet:E}),e.jsxs("div",{className:"login-methods",children:[e.jsx("div",{className:"official-wallet-button","data-button-text":t("login.selectWallet"),style:{"--button-text":`"${t("login.selectWallet")}"`},children:e.jsx("button",{className:"select-wallet-custom-btn",onClick:l=>{l.preventDefault(),l.stopPropagation(),console.log("[TronWalletLogin] é¸æ“‡éŒ¢åŒ…æŒ‰éˆ•è¢«é»žæ“Šï¼Œæ‰“é–‹é¸æ“‡å½ˆçª—"),r(!0)},children:t("login.selectWallet")})}),G&&ge&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"method-divider",children:e.jsx("span",{children:t("login.or")})}),e.jsxs("button",{className:"login-method-btn",onClick:ue,disabled:N,children:[e.jsx("div",{className:"method-icon",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"5",y:"2",width:"14",height:"20",rx:"2",ry:"2"}),e.jsx("line",{x1:"12",y1:"18",x2:"12.01",y2:"18"})]})}),e.jsxs("div",{className:"method-content",children:[e.jsx("h3",{children:t("login.useMobileApp")}),e.jsx("p",{children:t("login.mobileAppDesc")})]})]})]})]}),e.jsxs("div",{className:"login-tips",children:[e.jsx("p",{children:t("tips.title")}),e.jsx("ul",{children:x?C?t("tips.pcWithExtension",{wallets:A.map(l=>l.name).join("ã€")}).map((l,g)=>e.jsx("li",{children:l},g)):t("tips.pcWithoutExtension").map((l,g)=>e.jsx("li",{children:l},g)):t("tips.mobile").map((l,g)=>e.jsx("li",{children:l},g))})]})]})},Ke=()=>[new we,new xe,new Te,new Ce],Ve=()=>[new Le,new ke],He=()=>[new ve],Ge=()=>new Ne({network:Q.NETWORK,options:{projectId:Q.PROJECT_ID,metadata:Q.METADATA}}),Xe=()=>{const t=[...Ke(),...Ve(),...He()],i=Ge();return i&&t.push(i),t};function Ze(){return e.jsx("div",{className:"app",children:e.jsx("div",{className:"app-container",children:e.jsx(ze,{})})})}function Ye(){const t=h.useMemo(()=>Xe(),[]),i=n=>{console.error("éŒ¢åŒ…éŒ¯èª¤:",n)};return e.jsx(Ue,{children:e.jsx(Me,{children:e.jsx(Ee,{adapters:t,onError:i,autoConnect:!1,children:e.jsx(We,{children:e.jsx(Ze,{})})})})})}console.log("[Main] Before importing polyfills...");console.log("[Main] After importing polyfills, checking Buffer:",typeof window<"u"?typeof window.Buffer:"window undefined");console.log("[Main] App imports complete, Buffer check:",typeof window<"u"?typeof window.Buffer:"window undefined");me.createRoot(document.getElementById("root")).render(e.jsx(pe.StrictMode,{children:e.jsx(Ye,{})}));
