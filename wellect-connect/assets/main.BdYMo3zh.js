import{r as u,j as e,c as fe,R as xe}from"./react-vendor.Bj0G0Oyz.js";import"./polyfills.DCfrOiPO.js";import{ab as z,ac as we,ad as Te,ae as Ce,af as ve,ag as ke,ah as je,ai as ye,aj as Le,ak as be,al as Ne,am as Ee,an as We}from"./wallet-vendor.CHv2NQr2.js";import"./buffer-polyfill.ErO7y5re.js";const Se=()=>{const[t,r]=u.useState(!0),o=async a=>{try{const n=`${a}test`;return new Promise(d=>{const i=document.createElement("iframe");i.style.display="none",i.src=n;let c=!1;const g=setTimeout(()=>{c||(c=!0,document.body.removeChild(i),d(!1))},1e3);i.onload=()=>{c||(c=!0,clearTimeout(g),document.body.removeChild(i),d(!0))},i.onerror=()=>{c||(c=!0,clearTimeout(g),document.body.removeChild(i),d(!1))},document.body.appendChild(i)})}catch(n){return console.error("æª¢æŸ¥ APP å®‰è£ç‹€æ…‹å¤±æ•—:",n),!1}},s=async a=>{try{const n=document.createElement("a");return n.href=a,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),await new Promise(d=>setTimeout(d,300)),!0}catch(n){return console.error("è§¸ç™¼ Deep Link å¤±æ•—:",n),!1}};return u.useEffect(()=>{const a=n=>{n.origin===window.location.origin&&n.data&&n.data.type==="TRONWALLET_CALLBACK"&&console.log("æ”¶åˆ° TronWallet å›žèª¿:",n.data)};return window.addEventListener("message",a),()=>{window.removeEventListener("message",a)}},[]),{isSupported:t,checkAppInstalled:o,triggerDeepLink:s}},ae=()=>{const[t,r]=u.useState({isPC:!1,isMobile:!1,isIOS:!1,isAndroid:!1,isTablet:!1,hasExtension:!1,detectedWallets:[],isPWA:!1,isStandalone:!1,platform:"",browser:""});return u.useEffect(()=>{const o=()=>{const n=navigator.userAgent||navigator.vendor||window.opera,d=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(n),i=/iPad|iPhone|iPod/.test(n)&&!window.MSStream,c=/Android/.test(n),g=/iPad/.test(n)||c&&!/Mobile/.test(n),h=!d,p=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://"),T=p||window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches;let f="Unknown";n.indexOf("Chrome")>-1&&n.indexOf("Edg")===-1?f="Chrome":n.indexOf("Safari")>-1&&n.indexOf("Chrome")===-1?f="Safari":n.indexOf("Firefox")>-1?f="Firefox":n.indexOf("Edg")>-1?f="Edge":(n.indexOf("Opera")>-1||n.indexOf("OPR")>-1)&&(f="Opera");let l="Web";T?i?l="iOS PWA":c?l="Android PWA":l="PWA":h?l="Web PC":i?l="iOS Web":c&&(l="Android Web");const C=[],x=!1;T&&console.log("[useEnvironment] PWAæ¨¡å¼ç’°å¢ƒæª¢æ¸¬çµæžœ:",{isPWA:T,isPC:h,isMobile:d,platform:l,browser:f}),r({isPC:h,isMobile:d,isIOS:i,isAndroid:c,isTablet:g,hasExtension:x,detectedWallets:C,isPWA:T,isStandalone:p,platform:l,browser:f})};o();let s;const a=()=>{clearTimeout(s),s=setTimeout(o,300)};return window.addEventListener("resize",a),()=>{s&&clearTimeout(s),window.removeEventListener("resize",a)}},[]),t},re={apiBaseUrl:"https://agoramarketapi.purrtechllc.com/api"};async function Ae(t){const r=await fetch(`${re.apiBaseUrl}/auth/wallet-connect/nonce`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({walletAddress:t})});if(!r.ok)throw new Error("ç²å– nonce å¤±æ•—: "+r.statusText);const o=await r.json();if(o.message&&(!o.nonce||o.nonce==="")&&o.message.includes("Nonce:")){const s=o.message.match(/Nonce:\s*([^\n]+)/);s&&s[1]&&(o.nonce=s[1].trim())}if(o.message&&!o.timestamp&&o.message.includes("Timestamp:")){const s=o.message.match(/Timestamp:\s*([^\n]+)/);if(s&&s[1]){const a=parseInt(s[1].trim());isNaN(a)||(o.timestamp=a)}}if(!o.message||o.message==="")throw new Error("ç²å– nonce å¤±æ•—ï¼šç¼ºå°‘ message å­—æ®µ");if(!o.nonce||o.nonce==="")throw new Error("ç²å– nonce å¤±æ•—ï¼šç¼ºå°‘ nonce å­—æ®µ");return o.timestamp||(o.timestamp=Math.floor(Date.now()/1e3)),o}async function Pe(t,r,o,s="tron"){const a={walletAddress:t,signature:r,nonce:o.nonce,timestamp:o.timestamp};s==="tron"&&(a.chain="TRC20",a.chainType="tron");const n=await fetch(`${re.apiBaseUrl}/auth/wallet-connect/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!n.ok){const i=await n.json().catch(()=>({message:n.statusText}));throw new Error(i.message||"ç™»éŒ„å¤±æ•—: "+n.statusText)}const d=await n.json();if(!d.token||!d.refreshToken)throw new Error(d.message||"ç™»éŒ„éŸ¿æ‡‰ä¸­ç¼ºå°‘ token");return d}const S={WALLET_CONNECTED:"WALLET_CONNECTED",WALLET_DISCONNECTED:"WALLET_DISCONNECTED",WALLET_ADDRESS:"WALLET_ADDRESS",JWT_REQUEST:"JWT_REQUEST",JWT_RECEIVED:"JWT_RECEIVED",JWT_ERROR:"JWT_ERROR",READY:"READY",ERROR:"ERROR",INIT:"INIT",CLOSE:"CLOSE"},D=(t,r={})=>{const o={source:"tron-wallet-login-module",type:t,data:r,timestamp:Date.now()};window.parent&&window.parent!==window&&window.parent.postMessage(o,"*"),window.flutter_inappwebview&&window.flutter_inappwebview.callHandler("onMessage",o),window.onTronWalletLoginMessage&&window.onTronWalletLoginMessage(o)},Re=t=>{const r=o=>{o.data&&o.data.source==="flutter-app"&&t(o.data)};return window.addEventListener("message",r),window.flutter_inappwebview&&window.flutter_inappwebview.addEventListener("message",r),()=>{window.removeEventListener("message",r),window.flutter_inappwebview&&window.flutter_inappwebview.removeEventListener("message",r)}},ee=()=>{D(S.READY,{version:"1.0.0",timestamp:Date.now()})},Me=t=>{D(S.ERROR,{error:t.message||t,stack:t.stack})},Oe={common:{connect:"é€£æŽ¥",disconnect:"æ–·é–‹é€£æŽ¥",cancel:"å–æ¶ˆ",confirm:"ç¢ºèª",loading:"è¼‰å…¥ä¸­",error:"éŒ¯èª¤",success:"æˆåŠŸ",retry:"é‡è©¦",back:"è¿”å›ž"},login:{title:"é€£æŽ¥éŒ¢åŒ…",description:{pc:"è«‹é¸æ“‡éŒ¢åŒ…é€£æŽ¥æ–¹å¼",mobile:"è«‹é¸æ“‡éŒ¢åŒ…é€²è¡Œé€£æŽ¥",detected:"æª¢æ¸¬åˆ° {wallets}ï¼Œè«‹é¸æ“‡ç™»å…¥æ–¹å¼"},selectWallet:"é¸æ“‡éŒ¢åŒ…",quickLogin:"å¿«æ·ç™»å…¥",useMobileApp:"ä½¿ç”¨æ‰‹æ©Ÿ APP",mobileAppDesc:"é€šéŽ Deep Link æ‰“é–‹ TronLink APP",or:"æˆ–"},wallet:{connected:"å·²é€£æŽ¥éŒ¢åŒ…",connectedWaitingSignature:"å·²é€£æŽ¥éŒ¢åŒ…(ç­‰å¾…ç°½å)",connectedSignatureSuccess:"å·²é€£æŽ¥éŒ¢åŒ…(ç°½åæˆåŠŸ)",redirectingToLogin:"è·³è½‰ç™»å…¥...",disconnected:"éŒ¢åŒ…å·²æ–·é–‹",connecting:"é€£æŽ¥ä¸­",address:"éŒ¢åŒ…åœ°å€ï¼š",connectingTo:"æ­£åœ¨é€£æŽ¥åˆ° {wallet}...",unknown:"æœªçŸ¥éŒ¢åŒ…"},errors:{loginFailed:"ç™»å…¥å¤±æ•—ï¼Œè«‹é‡è©¦",cannotOpenApp:"ç„¡æ³•æ‰“é–‹ TronLink APPï¼Œè«‹ç¢ºèªå·²å®‰è£ä¸¦é‡è©¦",appNotInstalled:`æœªæª¢æ¸¬åˆ° TronLink APPï¼Œæ˜¯å¦å‰å¾€ä¸‹è¼‰ï¼Ÿ

å¦‚æžœå·²å®‰è£ï¼Œè«‹é»žæ“Šå–æ¶ˆå¾Œé‡è©¦ã€‚`,signatureCanceled:"ç°½åå·²å–æ¶ˆã€‚è«‹åœ¨éŒ¢åŒ…ä¸­ç¢ºèªç°½åä»¥ç¹¼çºŒç™»å…¥ã€‚",signatureFailed:"ç°½åå¤±æ•—ï¼Œè«‹é‡è©¦",jwtFailed:"JWT èªè­‰å¤±æ•—: {error}",connectionFailed:"é€£æŽ¥å¤±æ•—: {error}",walletNotSupported:"{wallet} ä¸æ”¯æŒç°½ååŠŸèƒ½ã€‚è«‹ä½¿ç”¨æ”¯æŒç°½åçš„éŒ¢åŒ…ï¼ˆå¦‚ TronLinkã€Ledger ç­‰ï¼‰ã€‚",ledgerTimeout:"Ledger ç°½åè¶…æ™‚ã€‚è«‹ç¢ºä¿è¨­å‚™å·²é€£æŽ¥ä¸¦è§£éŽ–ï¼Œç„¶å¾Œé‡è©¦ã€‚",ledgerNotConnected:"Ledger è¨­å‚™æœªé€£æŽ¥ã€‚è«‹é€£æŽ¥è¨­å‚™å¾Œé‡è©¦ã€‚",ledgerConfirm:"è«‹åœ¨ Ledger è¨­å‚™ä¸Šç¢ºèªç°½å...",nonceFailed:"ç²å– nonce å¤±æ•—: {error}",verifyFailed:"ç™»éŒ„å¤±æ•—: {error}",unknownError:"æœªçŸ¥éŒ¯èª¤"},tips:{title:"ðŸ’¡ æç¤ºï¼š",pcWithExtension:["æª¢æ¸¬åˆ° {wallets} æ“´å±•","é»žæ“Šä¸Šæ–¹æŒ‰éˆ•é¸æ“‡éŒ¢åŒ…é€²è¡Œé€£æŽ¥","æ”¯æŒå¤šç¨®éŒ¢åŒ…ï¼šç€è¦½å™¨æ“´å±•ã€ç§»å‹•ç«¯éŒ¢åŒ…ã€ç¡¬ä»¶éŒ¢åŒ…","é¦–æ¬¡ä½¿ç”¨éœ€è¦åœ¨éŒ¢åŒ…ä¸­æŽˆæ¬Š"],pcWithoutExtension:["æŽ¨è–¦å®‰è£ TronLinkã€TokenPocket ç­‰ç€è¦½å™¨æ“´å±•","æˆ–ä½¿ç”¨ WalletConnect é€£æŽ¥ç§»å‹•ç«¯éŒ¢åŒ…","æ”¯æŒ Ledger ç¡¬ä»¶éŒ¢åŒ…","é»žæ“Šä¸Šæ–¹æŒ‰éˆ•æŸ¥çœ‹æ‰€æœ‰å¯ç”¨é¸é …"],mobile:["ç§»å‹•ç«¯æŽ¨è–¦ä½¿ç”¨ WalletConnect é€£æŽ¥éŒ¢åŒ…","æˆ–é€šéŽ Deep Link æ‰“é–‹ TronLink APP","æ”¯æŒ Trust Walletã€ImToken ç­‰ç§»å‹•ç«¯éŒ¢åŒ…","é»žæ“Šä¸Šæ–¹æŒ‰éˆ•æŸ¥çœ‹æ‰€æœ‰å¯ç”¨é¸é …"]},modal:{connectWalletTitle:"é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ",detected:"å·²æª¢æ¸¬",notFound:"æœªæ‰¾åˆ°",installed:"å·²å®‰è£",notInstalled:"æœªå®‰è£",loading:"è¼‰å…¥ä¸­",connecting:"é€£æŽ¥ä¸­",connected:"å·²é€£æŽ¥",disconnect:"æ–·é–‹é€£æŽ¥"},environment:{webPC:"Web PC",webMobile:"Web ç§»å‹•ç«¯",iosWeb:"iOS Web",androidWeb:"Android Web",iosPWA:"iOS PWA",androidPWA:"Android PWA",pwa:"PWA"},process:{gettingNonce:"ðŸ“¨ æ­£åœ¨ç²å– nonce...",nonceSuccess:"âœ… Nonce ç²å–æˆåŠŸ",signing:"âœï¸ æ­£åœ¨ç°½åæ¶ˆæ¯...",signatureSuccess:"âœ… ç°½åæˆåŠŸ",verifying:"ðŸ” æ­£åœ¨é©—è­‰ç°½åä¸¦ç™»å…¥...",loginSuccess:"âœ… ç™»å…¥æˆåŠŸï¼Œå·²ç²å– Token",jwtSent:"âœ… JWT Token å·²ç™¼é€çµ¦ Flutter",ledgerDetected:"ðŸ” æª¢æ¸¬åˆ° Ledger ç¡¬ä»¶éŒ¢åŒ…ï¼Œè«‹åœ¨è¨­å‚™ä¸Šç¢ºèªç°½å..."},signing:{pendingTitle:"è«‹å®Œæˆç°½åä»¥å®Œæˆç™»å…¥",pendingDesc:"éŒ¢åŒ…å·²é€£æŽ¥ï¼Œè«‹åœ¨éŒ¢åŒ…ä¸­ç¢ºèªç°½åè«‹æ±‚",retry:"é‡æ–°ç°½å"}},De={common:{connect:"Connect",disconnect:"Disconnect",cancel:"Cancel",confirm:"Confirm",loading:"Loading",error:"Error",success:"Success",retry:"Retry",back:"Back"},login:{title:"Connect Wallet",description:{pc:"Please select wallet connection method",mobile:"Please select a wallet to connect",detected:"Detected {wallets}, please select login method"},selectWallet:"Select Wallet",quickLogin:"Quick Login",useMobileApp:"Use Mobile APP",mobileAppDesc:"Open TronLink APP via Deep Link",or:"or"},wallet:{connected:"Wallet Connected",connectedWaitingSignature:"Wallet Connected (Waiting for Signature)",connectedSignatureSuccess:"Wallet Connected (Signature Success)",redirectingToLogin:"Redirecting to Login...",disconnected:"Wallet Disconnected",connecting:"Connecting",address:"Wallet Address:",connectingTo:"Connecting to {wallet}...",unknown:"Unknown Wallet"},errors:{loginFailed:"Login failed, please try again",cannotOpenApp:"Cannot open TronLink APP, please confirm it is installed and try again",appNotInstalled:`TronLink APP not detected, go to download?

If already installed, please click cancel and try again.`,signatureCanceled:"Signature canceled. Please confirm the signature in the wallet to continue login.",signatureFailed:"Signature failed, please try again",jwtFailed:"JWT authentication failed: {error}",connectionFailed:"Connection failed: {error}",walletNotSupported:"{wallet} does not support signature function. Please use a wallet that supports signatures (such as TronLink, Ledger, etc.).",ledgerTimeout:"Ledger signature timeout. Please ensure the device is connected and unlocked, then try again.",ledgerNotConnected:"Ledger device not connected. Please connect the device and try again.",ledgerConfirm:"Please confirm signature on Ledger device...",nonceFailed:"Failed to get nonce: {error}",verifyFailed:"Login failed: {error}",unknownError:"Unknown error"},tips:{title:"ðŸ’¡ Tips:",pcWithExtension:["Detected {wallets} extension","Click the button above to select wallet for connection","Supports multiple wallets: browser extensions, mobile wallets, hardware wallets","First-time use requires authorization in the wallet"],pcWithoutExtension:["Recommended to install TronLink, TokenPocket and other browser extensions","Or use WalletConnect to connect mobile wallets","Supports Ledger hardware wallet","Click the button above to view all available options"],mobile:["Mobile devices recommend using WalletConnect to connect wallets","Or open TronLink APP via Deep Link","Supports Trust Wallet, ImToken and other mobile wallets","Click the button above to view all available options"]},modal:{connectWalletTitle:"Connect a wallet on Tron to continue",detected:"Detected",notFound:"NotFound",installed:"Installed",notInstalled:"NotInstalled",loading:"Loading",connecting:"Connecting",connected:"Connected",disconnect:"Disconnect"},environment:{webPC:"Web PC",webMobile:"Web Mobile",iosWeb:"iOS Web",androidWeb:"Android Web",iosPWA:"iOS PWA",androidPWA:"Android PWA",pwa:"PWA"},process:{gettingNonce:"ðŸ“¨ Getting nonce...",nonceSuccess:"âœ… Nonce obtained successfully",signing:"âœï¸ Signing message...",signatureSuccess:"âœ… Signature successful",verifying:"ðŸ” Verifying signature and logging in...",loginSuccess:"âœ… Login successful, Token obtained",jwtSent:"âœ… JWT Token sent to Flutter",ledgerDetected:"ðŸ” Ledger hardware wallet detected, please confirm signature on device..."},signing:{pendingTitle:"Please complete signature to finish login",pendingDesc:"Wallet connected, please confirm signature request in wallet",retry:"Retry Signature"}},ie=u.createContext(),B=()=>{const t=u.useContext(ie);if(!t)throw new Error("useLanguage must be used within LanguageProvider");return t},Ie=({children:t})=>{const r=()=>{try{return localStorage.getItem("wallet-login-language")==="en"?"en":"zh"}catch{return"zh"}},[o,s]=u.useState(r),a={zh:Oe,en:De},n=(h,p={})=>{const T=h.split(".");let f=a[o];for(const l of T)if(f&&typeof f=="object")f=f[l];else return h;return typeof f=="string"&&Object.keys(p).length>0?f.replace(/\{(\w+)\}/g,(l,C)=>p[C]!==void 0?p[C]:l):Array.isArray(f)&&Object.keys(p).length>0?f.map(l=>typeof l=="string"?l.replace(/\{(\w+)\}/g,(C,x)=>p[x]!==void 0?p[x]:C):l):f||h},d=h=>{(h==="zh"||h==="en")&&(s(h),localStorage.setItem("wallet-login-language",h),window.dispatchEvent(new Event("languageChanged")))},i=()=>o,c=()=>o==="zh",g=()=>o==="en";return e.jsx(ie.Provider,{value:{language:o,t:n,changeLanguage:d,getLanguage:i,isZh:c,isEn:g},children:t})},Fe=()=>{const[t,r]=u.useState(""),{signMessage:o,wallet:s}=z(),{t:a}=B(),n=u.useCallback(async d=>{var i,c;try{r(""),console.log(a("process.gettingNonce"));const g=await Ae(d);if(console.log(a("process.nonceSuccess"),g.nonce),!o){const p=((i=s==null?void 0:s.adapter)==null?void 0:i.name)||a("wallet.unknown");throw new Error(a("errors.walletNotSupported",{wallet:p}))}const h=((c=s==null?void 0:s.adapter)==null?void 0:c.name)==="Ledger";h?(console.log(a("process.ledgerDetected")),r(a("errors.ledgerConfirm"))):console.log(a("process.signing"));try{const p=await o(g.message);console.log(a("process.signatureSuccess")),h&&r(""),console.log(a("process.verifying"));const T=await Pe(d,p,g,"tron");console.log(a("process.loginSuccess")),D(S.JWT_RECEIVED,{token:T.token,refreshToken:T.refreshToken,user:T.user,address:d,timestamp:Date.now()}),console.log(a("process.jwtSent"))}catch(p){const T=p.message||p.toString();if(T.includes("rejected")||T.includes("denied")||T.includes("cancel")||T.includes("å–æ¶ˆ")||T.includes("æ‹’çµ•"))throw new Error(a("errors.signatureCanceled"));if(h){if(T.includes("timeout")||T.includes("è¶…æ™‚"))throw new Error(a("errors.ledgerTimeout"));if(T.includes("not connected")||T.includes("æœªé€£æŽ¥"))throw new Error(a("errors.ledgerNotConnected"))}throw p}}catch(g){throw console.error("âŒ JWT è«‹æ±‚å¤±æ•—:",g),Me(g),r(a("errors.jwtFailed",{error:g.message||g.toString()})),g}},[o,s,a]);return{error:t,setError:r,handleJWTRequest:n}},_e={TronLink:"TronLink",TokenPocket:"TokenPocket",BitKeep:"BitKeep",OkxWallet:"OKX Wallet",Ledger:"Ledger",WalletConnect:"WalletConnect",Trust:"Trust Wallet",ImToken:"imToken"},Be=t=>_e[t]||t,$e=()=>{const{wallets:t,select:r,connect:o,connecting:s,connected:a,wallet:n}=z(),d=u.useMemo(()=>!t||t.length===0?[]:t.filter(g=>{const h=g.adapter.readyState;return h==="Installed"||h==="Loadable"}).map(g=>({...g,detectedName:Be(g.adapter.name)})),[t]),i=u.useRef(0);return u.useEffect(()=>{const g=d.length,h=i.current;g!==h&&(g>0?console.log("[useQuickLogin] å¯ç”¨éŒ¢åŒ…åˆ—è¡¨ï¼ˆåŸºæ–¼å®˜æ–¹é©é…å™¨ readyStateï¼‰:",{availableWallets:d.map(p=>({name:p.adapter.name,detectedName:p.detectedName,readyState:p.adapter.readyState})),allWallets:(t==null?void 0:t.map(p=>({name:p.adapter.name,readyState:p.adapter.readyState})))||[]}):t&&t.length>0&&console.log("[useQuickLogin] ç„¡å¯ç”¨éŒ¢åŒ…ï¼ˆæ‰€æœ‰éŒ¢åŒ…ç‹€æ…‹ï¼‰:",{walletsCount:t.length,allWallets:t.map(p=>({name:p.adapter.name,readyState:p.adapter.readyState}))}),i.current=g)},[d,t]),{availableWallets:d,handleQuickConnect:async g=>{var p,T,f,l,C,x,v,j,N;const h=g.adapter.name;console.log("[QuickLogin] é–‹å§‹é€£æŽ¥éŒ¢åŒ…:",{walletName:h,availableWallets:t.map(k=>k.adapter.name),currentWallet:(p=n==null?void 0:n.adapter)==null?void 0:p.name,connecting:s,connected:a});try{const k=t.find(L=>L.adapter.name===h);if(console.log("[QuickLogin] æŸ¥æ‰¾éŒ¢åŒ…é©é…å™¨:",{walletName:h,found:!!k,targetWalletName:(T=k==null?void 0:k.adapter)==null?void 0:T.name,allWallets:t.map(L=>({name:L.adapter.name,readyState:L.adapter.readyState}))}),!k)throw new Error(`æ‰¾ä¸åˆ°éŒ¢åŒ…é©é…å™¨: ${h}`);console.log("[QuickLogin] æ­¥é©Ÿ 1: é¸æ“‡éŒ¢åŒ…",h),await r(h),console.log("[QuickLogin] æ­¥é©Ÿ 1 å®Œæˆ: select() å·²èª¿ç”¨"),console.log("[QuickLogin] æ­¥é©Ÿ 2: ç­‰å¾…é¸æ“‡å®Œæˆ..."),await new Promise(L=>setTimeout(L,500)),console.log("[QuickLogin] é¸æ“‡å¾Œç‹€æ…‹:",{currentWallet:(f=n==null?void 0:n.adapter)==null?void 0:f.name,expectedWallet:h,match:((l=n==null?void 0:n.adapter)==null?void 0:l.name)===h}),console.log("[QuickLogin] æ­¥é©Ÿ 3: é–‹å§‹é€£æŽ¥éŒ¢åŒ…..."),await o(),console.log("[QuickLogin] æ­¥é©Ÿ 3 å®Œæˆ: connect() æˆåŠŸ")}catch(k){console.error("[QuickLogin] å¿«é€Ÿé€£æŽ¥éŒ¯èª¤:",{error:k,message:k==null?void 0:k.message,stack:k==null?void 0:k.stack,walletName:h,currentWallet:(C=n==null?void 0:n.adapter)==null?void 0:C.name,connecting:s,connected:a});const L=(k==null?void 0:k.message)||(k==null?void 0:k.toString())||"";if(L.includes("No wallet is selected")||L.includes("not selected"))try{console.log('[QuickLogin] æª¢æ¸¬åˆ° "No wallet is selected" éŒ¯èª¤ï¼Œå˜—è©¦é‡è©¦...'),console.log("[QuickLogin] é‡è©¦å‰ç‹€æ…‹:",{walletName:h,currentWallet:(x=n==null?void 0:n.adapter)==null?void 0:x.name,wallets:t.map(y=>y.adapter.name)}),console.log("[QuickLogin] é‡è©¦: å†æ¬¡é¸æ“‡éŒ¢åŒ…",h),await r(h),console.log("[QuickLogin] é‡è©¦: ç­‰å¾…é¸æ“‡å®Œæˆ..."),await new Promise(y=>setTimeout(y,800)),console.log("[QuickLogin] é‡è©¦å¾Œç‹€æ…‹:",{currentWallet:(v=n==null?void 0:n.adapter)==null?void 0:v.name,expectedWallet:h,match:((j=n==null?void 0:n.adapter)==null?void 0:j.name)===h}),console.log("[QuickLogin] é‡è©¦: å†æ¬¡å˜—è©¦é€£æŽ¥..."),await o(),console.log("[QuickLogin] é‡è©¦æˆåŠŸ")}catch(y){console.error("[QuickLogin] é‡è©¦é€£æŽ¥å¤±æ•—:",{error:y,message:y==null?void 0:y.message,stack:y==null?void 0:y.stack,walletName:h,currentWallet:(N=n==null?void 0:n.adapter)==null?void 0:N.name});const A=(y==null?void 0:y.message)||(y==null?void 0:y.toString())||"";throw A.includes("No wallet is selected")||A.includes("not selected")?new Error(`ç„¡æ³•é¸æ“‡éŒ¢åŒ… ${h}ã€‚è«‹ç¢ºä¿ TronLink æ“´å±•å·²å®‰è£ä¸¦å•Ÿç”¨ã€‚`):y}else throw k}},connecting:s,connected:a,currentWallet:n}};function V(){try{return localStorage.getItem("wallet-login-language")==="en"?"en":"zh"}catch{return"zh"}}const qe={"Connect a wallet on Tron to continue.":"é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ","Connect a wallet on Tron to continue":"é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ","Connect a wallet on":"é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ","Tron to continue":"é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ","Connect a wallet":"é€£æŽ¥éŒ¢åŒ…",Detected:"å·²æª¢æ¸¬",NotFound:"æœªæ‰¾åˆ°",NotDetected:"æœªæª¢æ¸¬",Installed:"å·²å®‰è£",NotInstalled:"æœªå®‰è£",Loading:"è¼‰å…¥ä¸­",Connecting:"é€£æŽ¥ä¸­",Connected:"å·²é€£æŽ¥",Disconnect:"æ–·é–‹é€£æŽ¥","Select Wallet":"é¸æ“‡éŒ¢åŒ…",Wallet:"éŒ¢åŒ…","on Tron":"TRON","to continue":"ä»¥ç¹¼çºŒ"},Qe={"Connect a wallet on Tron to continue.":"Connect a wallet on Tron to continue.","Connect a wallet on Tron to continue":"Connect a wallet on Tron to continue","Connect a wallet on":"Connect a wallet on","Tron to continue":"Tron to continue","Connect a wallet":"Connect a wallet",Detected:"Detected",NotFound:"NotFound",NotDetected:"NotDetected",Installed:"Installed",NotInstalled:"NotInstalled",Loading:"Loading",Connecting:"Connecting",Connected:"Connected",Disconnect:"Disconnect","Select Wallet":"Select Wallet",Wallet:"Wallet","on Tron":"on Tron","to continue":"to continue"};function le(){return V()==="zh"?qe:Qe}function te(t){if(!t)return t;const r=le();V()==="zh"&&(t=t.replace(/Connect a wallet on Tron to continue\.?/gi,r["Connect a wallet on Tron to continue"]),t=t.replace(/Connect a wallet on\s*$/gi,r["Connect a wallet on Tron to continue"]),t.includes(r["Connect a wallet on Tron to continue"])?t=t.replace(/Tron to continue\.?/gi,""):t=t.replace(/Tron to continue\.?/gi,""));for(const[s,a]of Object.entries(r)){if(t.trim()===s)return a;const n=new RegExp(`^\\s*${s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\s*$`,"gi");t=t.replace(n,a)}return t}function ce(t){if(t){if(t.nodeType===Node.TEXT_NODE){const r=t.textContent,o=te(r);o!==r&&(t.textContent=o)}else if(t.nodeType===Node.ELEMENT_NODE){const r=t.textContent&&(t.textContent.includes("Connect a wallet")||t.textContent.includes("Detected")||t.textContent.includes("NotFound")||t.textContent.includes("Select Wallet"));if(t.dataset.translated==="true"&&!r)return;const o=t.textContent.trim(),a=le()["Connect a wallet on Tron to continue"];if(o.includes("Connect a wallet on Tron to continue")||o.includes("Connect a wallet on")&&o.includes("Tron to continue")){t.innerHTML=a,t.dataset.translated="true";return}if(t.children.length===0){const n=t.textContent.trim(),d=te(n);if(d!==n){t.textContent=d,t.dataset.translated="true";return}}Array.from(t.childNodes).forEach(n=>{ce(n)})}}}function Ue(t){if(!t)return!1;if(t.textContent.trim().includes("Connect a wallet on Tron to continue"))return t.innerHTML="é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ",t.dataset.translated="true",!0;const o=Array.from(t.childNodes);let s=!1,a=!1,n=null,d=null;return o.forEach(i=>{const c=i.textContent.trim();(c.includes("Connect a wallet on")||c==="Connect a wallet on")&&(s=!0,n=i),(c.includes("Tron to continue")||c==="Tron to continue")&&(a=!0,d=i)}),s&&a?(n&&(n.textContent="é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ",n.dataset.translated="true"),d&&(d.textContent=""),t.dataset.translated="true",!0):(o.forEach(i=>{if(i.nodeType===Node.TEXT_NODE){const c=i.textContent.trim();if(c==="Connect a wallet on"||c.includes("Connect a wallet on"))i.textContent="é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ";else if(c==="Tron to continue"||c.includes("Tron to continue")){const g=i.previousSibling;g&&g.textContent&&g.textContent.includes("é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ"),i.textContent=""}}else if(i.nodeType===Node.ELEMENT_NODE){const c=i.textContent.trim();c==="Connect a wallet on"||c.includes("Connect a wallet on")?(i.textContent="é€£æŽ¥ TRON éŒ¢åŒ…ä»¥ç¹¼çºŒ",i.dataset.translated="true"):(c==="Tron to continue"||c.includes("Tron to continue"))&&(i.textContent="")}}),!1)}function O(){['[role="dialog"]','[class*="wallet-adapter"]','[class*="wallet-modal"]','[class*="WalletModal"]','[class*="modal"]'].forEach(r=>{try{document.querySelectorAll(r).forEach(s=>{s&&(s.textContent&&(s.textContent.includes("Connect a wallet")||s.textContent.includes("Detected")||s.textContent.includes("NotFound")||s.textContent.includes("Select Wallet")||s.textContent.includes("NotDetected")||s.textContent.includes("NotInstalled"))&&(s.dataset.translated="false",s.querySelectorAll('[data-translated="true"]').forEach(n=>{n.dataset.translated="false"})),(!s.dataset.translated||s.dataset.translated==="false")&&(s.querySelectorAll('h1, h2, h3, h4, h5, h6, [class*="title"], [class*="Title"]').forEach(d=>{(!d.dataset.translated||d.dataset.translated==="false")&&Ue(d)}),ce(s),s.dataset.translated="true"))})}catch{}})}function ze(t=null){t||V();const r=new MutationObserver(n=>{let d=!1;n.forEach(i=>{i.addedNodes.forEach(c=>{var g;if(c.nodeType===Node.ELEMENT_NODE){const h=((g=c.classList)==null?void 0:g.toString())||"",p=c.getAttribute("role")||"";(h.includes("wallet")||h.includes("modal")||p==="dialog"||c.querySelector('[role="dialog"]')||c.querySelector('[class*="wallet"]')||c.querySelector('[class*="modal"]'))&&(d=!0)}})}),d&&requestAnimationFrame(()=>{O(),requestAnimationFrame(()=>{O()})})});document.body&&r.observe(document.body,{childList:!0,subtree:!0});const o=()=>{O()};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",o):o();const s=setInterval(()=>{O()},200),a=()=>{document.querySelectorAll('[data-translated="true"]').forEach(n=>{n.dataset.translated="false"}),O()};return window.addEventListener("storage",a),window.addEventListener("languageChanged",a),{disconnect:()=>{r.disconnect(),clearInterval(s),window.removeEventListener("storage",a),window.removeEventListener("languageChanged",a)}}}const _={TRONWALLET_SCHEME:"tronlink://",TRONWALLET_UNIVERSAL_LINK:"https://www.tronlink.org/",CALLBACK_PATH:"/callback"},U={PROJECT_ID:"7412eb629501759c091220ccc09ded23",NETWORK:"mainnet",get METADATA(){return{name:"TRON éŒ¢åŒ…ç™»å…¥æ¨¡å¡Š",description:"TRON éŒ¢åŒ…ç™»å…¥æ¨¡å¡Š - Flutter Web é›†æˆ",url:window.location.origin,icons:[`${window.location.origin}/favicon.ico`]}}},de=u.createContext(),Ve=()=>{const t=u.useContext(de);if(!t)throw new Error("useTheme must be used within ThemeProvider");return t},Je=({children:t})=>{const r=()=>{try{const n=localStorage.getItem("wallet-login-theme");return n?n==="dark"?"dark":"light":window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}catch{return"light"}},[o,s]=u.useState(r),a=()=>{const n=o==="light"?"dark":"light";s(n),localStorage.setItem("wallet-login-theme",n),document.documentElement.setAttribute("data-theme",n)};return u.useEffect(()=>{document.documentElement.setAttribute("data-theme",o)},[o]),u.useEffect(()=>{const n=window.matchMedia("(prefers-color-scheme: dark)"),d=i=>{localStorage.getItem("wallet-login-theme")||s(i.matches?"dark":"light")};return n.addEventListener("change",d),()=>n.removeEventListener("change",d)},[]),e.jsx(de.Provider,{value:{theme:o,toggleTheme:a,isDark:o==="dark",isLight:o==="light"},children:t})},ne=()=>{const{language:t,changeLanguage:r}=B(),{theme:o,toggleTheme:s}=Ve();return e.jsxs("div",{className:"language-switcher",children:[e.jsx("button",{className:"theme-btn",onClick:s,title:o==="light"?"åˆ‡æ›åˆ°æ·±è‰²ä¸»é¡Œ":"åˆ‡æ›åˆ°æ·ºè‰²ä¸»é¡Œ","aria-label":o==="light"?"Switch to dark theme":"Switch to light theme",children:o==="light"?e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})}):e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),e.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),e.jsx("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),e.jsx("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),e.jsx("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),e.jsx("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),e.jsx("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),e.jsx("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]})}),e.jsx("button",{className:`lang-btn ${t==="zh"?"active":""}`,onClick:()=>r("zh"),title:"ä¸­æ–‡",children:"ä¸­æ–‡"}),e.jsx("button",{className:`lang-btn ${t==="en"?"active":""}`,onClick:()=>r("en"),title:"English",children:"EN"})]})},He=({address:t,signingStatus:r})=>{const{t:o}=B(),{platform:s,browser:a,isPWA:n}=ae(),i=r==="pending"?{title:o("wallet.connectedWaitingSignature","å·²é€£æŽ¥éŒ¢åŒ…(ç­‰å¾…ç°½å)"),icon:e.jsx("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"})}),className:"status-waiting"}:r==="success"?{title:o("wallet.connectedSignatureSuccess","å·²é€£æŽ¥éŒ¢åŒ…(ç°½åæˆåŠŸ)"),icon:e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),className:"status-success"}:{title:o("wallet.connected","å·²é€£æŽ¥éŒ¢åŒ…"),icon:e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),className:"status-default"};return e.jsxs("div",{className:"wallet-info",children:[e.jsxs("div",{className:`success-message ${i.className}`,children:[e.jsx("div",{className:"status-icon-wrapper",children:i.icon}),e.jsx("h2",{children:i.title}),r==="success"&&e.jsx("p",{className:"login-redirect-message",children:o("wallet.redirectingToLogin","è·³è½‰ç™»å…¥...")})]}),e.jsx("div",{className:"environment-info",children:e.jsxs("div",{className:"env-badge",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),e.jsx("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),e.jsx("line",{x1:"12",y1:"17",x2:"12",y2:"21"})]}),e.jsx("span",{className:"env-platform",children:s}),a&&a!=="Unknown"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"env-separator",children:"Â·"}),e.jsx("span",{className:"env-browser",children:a})]}),n&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"env-separator",children:"Â·"}),e.jsx("span",{className:"env-pwa-badge",children:"PWA"})]})]})}),e.jsxs("div",{className:"address-display",children:[e.jsxs("label",{children:[o("wallet.address"),"ï¼š"]}),e.jsx("div",{className:"address-value",children:t})]}),e.jsx("div",{className:"wallet-actions",children:e.jsx(we,{})})]})},Ke=({availableWallets:t,onWalletClick:r,connecting:o,connectedWallet:s})=>t.length===0?null:e.jsx("div",{className:"quick-login-section",children:e.jsx("div",{className:"quick-login-buttons",children:t.map(a=>{var i,c;const n=a.adapter.name===((i=s==null?void 0:s.adapter)==null?void 0:i.name),d=o&&n;return e.jsxs("button",{className:"quick-login-btn",onClick:()=>r(a),disabled:d,children:[e.jsxs("div",{className:"quick-login-icon",children:[a.adapter.icon&&e.jsx("img",{src:a.adapter.icon,alt:a.detectedName,onError:g=>{g.target.style.display="none"}}),(!a.adapter.icon||!a.adapter.icon.startsWith("data:"))&&e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]})]}),e.jsx("span",{className:"quick-login-name",children:a.detectedName}),o&&a.adapter.name===((c=s==null?void 0:s.adapter)==null?void 0:c.name)&&e.jsx("div",{className:"quick-login-spinner"})]},a.adapter.name)})})}),Ge=500,Xe=()=>{const[t,r]=u.useState([]),[o,s]=u.useState(!0),a=u.useRef(null),n=u.useRef(null),d=u.useRef(null),i=u.useRef(o),c=u.useRef(null);u.useEffect(()=>{i.current=o},[o]);const g=u.useCallback((f,l,C=null)=>{if(i.current)try{const x=new Date().toLocaleTimeString("zh-TW",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3}),v={id:Date.now()+Math.random(),timestamp:x,level:f,message:l,data:C?JSON.stringify(C,null,2):null};r(j=>[...j,v].slice(-Ge))}catch(x){n.current&&n.current("Logger error:",x)}},[]);u.useEffect(()=>{c.current=g},[g]),u.useEffect(()=>{const f=setTimeout(()=>{i.current&&(a.current||(a.current=console.log.bind(console),n.current=console.error.bind(console),d.current=console.warn.bind(console)),console.log=(...l)=>{try{if(a.current(...l),!i.current||!c.current)return;const C=l.find(j=>typeof j=="string")||"",x=l.find(j=>typeof j=="object"&&j!==null&&!Array.isArray(j))||null;["[useEnvironment]","[useQuickLogin]","[TronWalletLogin]","[QuickLogin]","[Flutter Bridge]"].some(j=>C.includes(j))&&setTimeout(()=>{c.current&&c.current("log",C,x)},0)}catch{a.current&&a.current(...l)}},console.error=(...l)=>{var C;try{if(n.current(...l),!i.current||!c.current)return;const x=l.find(j=>typeof j=="string")||((C=l[0])==null?void 0:C.toString())||"Error",v=l.find(j=>typeof j=="object"&&j!==null&&!Array.isArray(j))||null;setTimeout(()=>{c.current&&c.current("error",x,v)},0)}catch{n.current&&n.current(...l)}},console.warn=(...l)=>{var C;try{if(d.current(...l),!i.current||!c.current)return;const x=l.find(j=>typeof j=="string")||((C=l[0])==null?void 0:C.toString())||"Warning",v=l.find(j=>typeof j=="object"&&j!==null&&!Array.isArray(j))||null;setTimeout(()=>{c.current&&c.current("warn",x,v)},0)}catch{d.current&&d.current(...l)}})},100);return()=>{clearTimeout(f),a.current&&(console.log=a.current,console.error=n.current,console.warn=d.current)}},[]);const h=u.useCallback(()=>{r([])},[]),p=u.useCallback(()=>{const f=t.map(l=>{const C=l.data?`
${l.data}`:"";return`[${l.timestamp}] [${l.level.toUpperCase()}] ${l.message}${C}`}).join(`

`);navigator.clipboard.writeText(f).then(()=>{g("info","æ—¥èªŒå·²è¤‡è£½åˆ°å‰ªè²¼æ¿")}).catch(l=>{g("error","è¤‡è£½æ—¥èªŒå¤±æ•—: "+l.message)})},[t,g]),T=u.useCallback(()=>{const f=t.map(v=>{const j=v.data?`
${v.data}`:"";return`[${v.timestamp}] [${v.level.toUpperCase()}] ${v.message}${j}`}).join(`

`),l=new Blob([f],{type:"text/plain"}),C=URL.createObjectURL(l),x=document.createElement("a");x.href=C,x.download=`tronwallet-logs-${new Date().toISOString().replace(/[:.]/g,"-")}.txt`,document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(C),g("info","æ—¥èªŒå·²å°Žå‡º")},[t,g]);return{logs:t,isEnabled:o,setIsEnabled:s,clearLogs:h,copyLogs:p,exportLogs:T,addLog:g}},ue=u.createContext(null),Ye=({children:t})=>{const r=Xe();return e.jsx(ue.Provider,{value:r,children:t})},Ze=()=>u.useContext(ue),oe=()=>{const t=Ze();if(!t)return null;const{logs:r,isEnabled:o,setIsEnabled:s,clearLogs:a,copyLogs:n,exportLogs:d}=t,[i,c]=u.useState(!1),[g,h]=u.useState(!0),p=u.useRef(null),T=l=>{switch(l){case"error":return"log-entry-error";case"warn":return"log-entry-warn";case"info":return"log-entry-info";default:return"log-entry-log"}},f=()=>{p.current&&g&&(p.current.scrollTop=p.current.scrollHeight)};return u.useEffect(()=>{i&&g&&setTimeout(f,100)},[r,i,g]),o?e.jsxs("div",{className:`logger-panel ${i?"expanded":"collapsed"}`,children:[e.jsxs("div",{className:"logger-header",children:[e.jsxs("div",{className:"logger-header-left",children:[e.jsx("button",{className:"logger-toggle-btn",onClick:()=>c(!i),title:i?"æ”¶èµ·æ—¥èªŒ":"å±•é–‹æ—¥èªŒ",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:i?e.jsx("path",{d:"M18 15l-6-6-6 6"}):e.jsx("path",{d:"M6 9l6 6 6-6"})})}),e.jsxs("span",{className:"logger-title",children:["èª¿è©¦æ—¥èªŒ (",r.length,")"]})]}),i&&e.jsxs("div",{className:"logger-actions",children:[e.jsxs("label",{className:"logger-checkbox",children:[e.jsx("input",{type:"checkbox",checked:g,onChange:l=>h(l.target.checked)}),e.jsx("span",{children:"è‡ªå‹•æ»¾å‹•"})]}),e.jsx("button",{className:"logger-action-btn",onClick:a,title:"æ¸…é™¤æ—¥èªŒ",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})}),e.jsx("button",{className:"logger-action-btn",onClick:n,title:"è¤‡è£½æ—¥èªŒ",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),e.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]})}),e.jsx("button",{className:"logger-action-btn",onClick:d,title:"å°Žå‡ºæ—¥èªŒ",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"7 10 12 15 17 10"}),e.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]})}),e.jsx("button",{className:"logger-action-btn",onClick:()=>s(!1),title:"é—œé–‰æ—¥èªŒ",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]})]}),i&&e.jsx("div",{className:"logger-content",ref:p,children:r.length===0?e.jsxs("div",{className:"logger-empty",children:[e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",opacity:"0.3",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e.jsx("polyline",{points:"10 9 9 9 8 9"})]}),e.jsx("p",{children:"æš«ç„¡æ—¥èªŒ"})]}):e.jsx("div",{className:"logger-entries",children:r.map(l=>e.jsxs("div",{className:`log-entry ${T(l.level)}`,children:[e.jsxs("div",{className:"log-entry-header",children:[e.jsx("span",{className:"log-timestamp",children:l.timestamp}),e.jsx("span",{className:`log-level log-level-${l.level}`,children:l.level.toUpperCase()})]}),e.jsx("div",{className:"log-message",children:l.message}),l.data&&e.jsxs("details",{className:"log-data",children:[e.jsx("summary",{children:"æŸ¥çœ‹æ•¸æ“š"}),e.jsx("pre",{children:l.data})]})]},l.id))})})]}):e.jsx("button",{className:"logger-toggle-btn",onClick:()=>s(!0),title:"å•Ÿç”¨æ—¥èªŒ",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e.jsx("polyline",{points:"10 9 9 9 8 9"})]})})},se=t=>{const r=(t==null?void 0:t.message)||(t==null?void 0:t.toString())||"";return r.includes("å–æ¶ˆ")||r.includes("rejected")||r.includes("cancel")||r.includes("denied")||r.includes("æ‹’çµ•")},et=()=>{var Z;const{t,language:r}=B(),{address:o,connected:s,wallet:a,select:n,connect:d}=z(),{setVisible:i,visible:c}=Te(),{triggerDeepLink:g,checkAppInstalled:h}=Se(),p=ae(),{error:T,setError:f,handleJWTRequest:l}=Fe(),[C,x]=u.useState(null),{availableWallets:v,handleQuickConnect:j,connecting:N,currentWallet:k}=$e(),{isPC:L,isMobile:y,platform:A,browser:$,isPWA:P}=p,R=v.length>0,q=(L||P&&!y)&&R,ge=y||!R,J=u.useRef(s),H=u.useRef(o),I=u.useRef(!1),K=u.useRef(v.length),G=u.useRef(s);u.useEffect(()=>{var m;(v.length!==K.current||s!==G.current)&&(console.log("[TronWalletLogin] çµ„ä»¶ç‹€æ…‹æ›´æ–°:",{isPWA:P,isPC:L,isMobile:y,platform:A,availableWalletsCount:v.length,availableWallets:v.map(w=>({name:w.adapter.name,detectedName:w.detectedName,readyState:w.adapter.readyState})),hasExtension:R,showExtensionOption:q,connecting:N,connected:s,currentWallet:(m=k==null?void 0:k.adapter)==null?void 0:m.name,address:o}),K.current=v.length,G.current=s)},[v.length,R,N,s,(Z=k==null?void 0:k.adapter)==null?void 0:Z.name,o,P,L,y,A,q]);const he=()=>{const w=`login_${Date.now()}`,b=encodeURIComponent(window.location.origin+_.CALLBACK_PATH);return{deepLinkUrl:`${_.TRONWALLET_SCHEME}login?callback=${b}&requestId=${w}`,requestId:w,callbackUrl:b}},me=async()=>{f("");try{const{deepLinkUrl:m}=he();if(y&&!await h(_.TRONWALLET_SCHEME)){window.confirm(t("errors.appNotInstalled"))&&window.open(_.TRONWALLET_UNIVERSAL_LINK,"_blank");return}await g(m)||f(t("errors.cannotOpenApp"))}catch(m){console.error("APP ç™»å…¥éŒ¯èª¤:",m),f(t("errors.loginFailed"))}};u.useEffect(()=>{const m=new URLSearchParams(window.location.search),w=m.get("address"),b=m.get("requestId");w&&b&&(window.history.replaceState({},document.title,window.location.pathname),console.log("æ”¶åˆ° Deep Link å›žèª¿:",{address:w,requestId:b}))},[]);const X=u.useRef(!1),M=u.useRef(!1);u.useEffect(()=>{var b;const m=X.current,w=c||!1;if(m&&!w&&a&&!s&&!N){const E=(b=a==null?void 0:a.adapter)==null?void 0:b.name;E&&(console.log("[TronWalletLogin] æª¢æ¸¬åˆ°ç”¨æˆ¶åœ¨å½ˆçª—ä¸­é¸æ“‡äº†éŒ¢åŒ…ï¼Œè‡ªå‹•é€£æŽ¥:",{walletName:E}),M.current=!0,d().catch(W=>{console.error("[TronWalletLogin] å½ˆçª—é¸æ“‡å¾Œè‡ªå‹•é€£æŽ¥å¤±æ•—:",W),f(t("errors.connectionFailed",{error:W.message||W.toString()})),M.current=!1}))}w&&!m&&(M.current=!1),s&&M.current&&(M.current=!1),X.current=w},[c,a,s,N,d,f,t]),u.useEffect(()=>{var E;const m=J.current,w=H.current;(s!==m||o!==w)&&(console.log("[TronWalletLogin] é€£æŽ¥ç‹€æ…‹è®ŠåŒ–:",{wasConnected:m,connected:s,prevAddress:w,address:o,wallet:(E=a==null?void 0:a.adapter)==null?void 0:E.name,connecting:N}),s&&o?(console.log("[TronWalletLogin] è§¸ç™¼é€£æŽ¥æµç¨‹"),f(""),x("pending"),D(S.WALLET_CONNECTED,{address:o,timestamp:Date.now()}),l(o).then(()=>{x("success")}).catch(W=>{se(W)?x("pending"):x("failed")})):!s&&m&&(console.log("[TronWalletLogin] è§¸ç™¼æ–·é–‹æµç¨‹"),x(null),D(S.WALLET_DISCONNECTED,{timestamp:Date.now()})),J.current=s,H.current=o)},[s,o]),u.useEffect(()=>{const m=()=>{const W=document.querySelectorAll(".official-wallet-button button");if(W.length===0)return;const pe=document.documentElement.getAttribute("data-theme")==="dark"?"#4b5563":"#e5e7eb";W.forEach(F=>{F instanceof HTMLElement&&(F.style.setProperty("background","transparent","important"),F.style.setProperty("border",`2px solid ${pe}`,"important"),F.style.setProperty("background-image","none","important"))})},w=setTimeout(()=>{requestAnimationFrame(m)},100),b=new MutationObserver(()=>{requestAnimationFrame(m)}),E=document.querySelector(".tronwallet-login");return E&&b.observe(E,{childList:!0,subtree:!0}),()=>{clearTimeout(w),b.disconnect()}},[v.length]),u.useEffect(()=>{const m=ze(r);return()=>{m&&m.disconnect&&m.disconnect()}},[r]),u.useEffect(()=>(I.current||(ee(),I.current=!0),Re(w=>{switch(w.type){case S.INIT:I.current||(ee(),I.current=!0);break;case S.CLOSE:console.log("Flutter è«‹æ±‚é—œé–‰ç™»å…¥æ¨¡å¡Š");break}})),[]);const Q=u.useMemo(()=>document.referrer&&document.referrer!==window.location.href?!0:window.history.length>1,[]),Y=()=>{Q&&window.history.back()};return s&&o?e.jsxs(e.Fragment,{children:[Q()&&e.jsxs("button",{className:"back-button",onClick:Y,title:t("common.back"),children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7"})}),e.jsx("span",{children:t("common.back")})]}),e.jsx(ne,{}),e.jsx(He,{address:o,signingStatus:C}),e.jsx(oe,{})]}):e.jsxs("div",{className:"tronwallet-login",children:[Q&&e.jsxs("button",{className:"back-button",onClick:Y,title:t("common.back"),children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7"})}),e.jsx("span",{children:t("common.back")})]}),e.jsx(ne,{}),e.jsx("div",{className:"login-icon",children:e.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]})}),e.jsx("h2",{className:"login-title",children:t("login.title")}),e.jsx("div",{className:"environment-info",children:e.jsxs("div",{className:"env-badge",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),e.jsx("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),e.jsx("line",{x1:"12",y1:"17",x2:"12",y2:"21"})]}),e.jsx("span",{className:"env-platform",children:A}),$&&$!=="Unknown"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"env-separator",children:"Â·"}),e.jsx("span",{className:"env-browser",children:$})]}),P&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"env-separator",children:"Â·"}),e.jsx("span",{className:"env-pwa-badge",children:"PWA"})]})]})}),e.jsx("p",{className:"login-description",children:v.length>0?t("login.description.detected",{wallets:v.map(m=>m.detectedName).join("ã€")}):t(L||P&&!y?"login.description.pc":"login.description.mobile")}),T&&e.jsxs("div",{className:"error-message",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),T]}),s&&o&&C==="pending"&&e.jsx("div",{className:"signing-prompt",children:e.jsxs("div",{className:"signing-prompt-content",children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"})}),e.jsxs("div",{className:"signing-prompt-text",children:[e.jsx("p",{className:"signing-prompt-title",children:t("signing.pendingTitle","è«‹å®Œæˆç°½åä»¥å®Œæˆç™»å…¥")}),e.jsx("p",{className:"signing-prompt-desc",children:t("signing.pendingDesc","éŒ¢åŒ…å·²é€£æŽ¥ï¼Œè«‹åœ¨éŒ¢åŒ…ä¸­ç¢ºèªç°½åè«‹æ±‚")})]}),e.jsx("button",{className:"signing-prompt-btn",onClick:async()=>{x("pending"),f("");try{await l(o),x("success")}catch(m){se(m)?x("pending"):x("failed")}},children:t("signing.retry","é‡æ–°ç°½å")})]})}),v.length>0&&e.jsx(Ke,{availableWallets:v,onWalletClick:async m=>{console.log("[TronWalletLogin] å¿«æ·ç™»å…¥æŒ‰éˆ•è¢«é»žæ“Š:",{walletName:m.adapter.name,detectedName:m.detectedName});try{f(""),await j(m),console.log("[TronWalletLogin] å¿«æ·ç™»å…¥æˆåŠŸ")}catch(w){console.error("[TronWalletLogin] å¿«æ·ç™»å…¥å¤±æ•—:",w),f(t("errors.connectionFailed",{error:w.message||w.toString()}))}},connecting:N,connectedWallet:k}),e.jsxs("div",{className:"login-methods",children:[v.length>0&&e.jsx("div",{className:"method-divider",children:e.jsx("span",{children:t("login.or")})}),e.jsx("div",{className:"official-wallet-button","data-button-text":t("login.selectWallet"),style:{"--button-text":`"${t("login.selectWallet")}"`},children:e.jsx("button",{className:"select-wallet-custom-btn",onClick:m=>{m.preventDefault(),m.stopPropagation(),console.log("[TronWalletLogin] æ‰“é–‹å®˜æ–¹éŒ¢åŒ…é¸æ“‡å½ˆçª—"),i(!0)},children:t("login.selectWallet")})}),q&&ge&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"method-divider",children:e.jsx("span",{children:t("login.or")})}),e.jsxs("button",{className:"login-method-btn",onClick:me,disabled:N,children:[e.jsx("div",{className:"method-icon",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"5",y:"2",width:"14",height:"20",rx:"2",ry:"2"}),e.jsx("line",{x1:"12",y1:"18",x2:"12.01",y2:"18"})]})}),e.jsxs("div",{className:"method-content",children:[e.jsx("h3",{children:t("login.useMobileApp")}),e.jsx("p",{children:t("login.mobileAppDesc")})]})]})]})]}),e.jsxs("div",{className:"login-tips",children:[e.jsx("p",{children:t("tips.title")}),e.jsx("ul",{children:L?R?t("tips.pcWithExtension",{wallets:v.map(m=>m.detectedName).join("ã€")}).map((m,w)=>e.jsx("li",{children:m},w)):t("tips.pcWithoutExtension").map((m,w)=>e.jsx("li",{children:m},w)):t("tips.mobile").map((m,w)=>e.jsx("li",{children:m},w))})]}),e.jsx(oe,{})]})},tt=()=>[new Ce,new ve,new ke,new je],nt=()=>[new ye,new Le],ot=()=>[new be],st=()=>{const t=U.METADATA;return new Ne({network:U.NETWORK,options:{projectId:U.PROJECT_ID,metadata:t}})},at=()=>{const t=[...tt(),...nt(),...ot()],r=st();return r&&t.push(r),t};function rt(){return e.jsx("div",{className:"app",children:e.jsx("div",{className:"app-container",children:e.jsx(et,{})})})}function it(){const t=u.useMemo(()=>at(),[]),r=o=>{console.error("éŒ¢åŒ…éŒ¯èª¤:",o)};return e.jsx(Je,{children:e.jsx(Ie,{children:e.jsx(Ye,{children:e.jsx(Ee,{adapters:t,onError:r,autoConnect:!1,children:e.jsx(We,{children:e.jsx(rt,{})})})})})})}console.log("[Main] Before importing polyfills...");console.log("[Main] After importing polyfills, checking Buffer:",typeof window<"u"?typeof window.Buffer:"window undefined");console.log("[Main] App imports complete, Buffer check:",typeof window<"u"?typeof window.Buffer:"window undefined");fe.createRoot(document.getElementById("root")).render(e.jsx(xe.StrictMode,{children:e.jsx(it,{})}));
