<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Redirecting...</title>
  <script>
    // GitHub Pages SPA 路由支持
    // 将所有 404 请求重定向到 index.html，让 Flutter 路由系统处理
    (function() {
      'use strict';
      
      const path = window.location.pathname;
      const search = window.location.search;
      const hash = window.location.hash;
      const STORAGE_KEY = '_404_redirect_path';
      const MAX_REDIRECTS = 3;
      
      // 防止循环重定向：检查重定向次数
      let redirectCount = 0;
      try {
        const count = sessionStorage.getItem('_404_redirect_count');
        redirectCount = count ? parseInt(count, 10) : 0;
        
        if (redirectCount >= MAX_REDIRECTS) {
          console.error('[404] Too many redirects, stopping to prevent loop');
          return;
        }
      } catch (e) {
        console.error('[404] Failed to check redirect count:', e);
      }
      
      // 防止循环重定向：检查是否已经包含 /index.html
      if (path.includes('/index.html')) {
        // 提取原始路径（去掉所有 /index.html 前缀）
        const originalPath = path.replace(/\/index\.html/g, '') || '/';
        const fullPath = originalPath + search + hash;
        
        // 保存原始路径到 sessionStorage
        try {
          sessionStorage.setItem(STORAGE_KEY, fullPath);
          sessionStorage.setItem('_404_redirect_count', String(redirectCount + 1));
        } catch (e) {
          console.error('[404] Failed to save redirect path:', e);
        }
        
        // 直接重定向到 /index.html
        window.location.replace('/index.html');
        return;
      }
      
      // 第一次访问：保存原始路径和查询参数
      try {
        const fullPath = path + search + hash;
        sessionStorage.setItem(STORAGE_KEY, fullPath);
        sessionStorage.setItem('_404_redirect_count', '1');
      } catch (e) {
        console.error('[404] Failed to save redirect path:', e);
      }
      
      // 直接重定向到 /index.html（不带路径，避免循环）
      window.location.replace('/index.html');
    })();
  </script>
  <meta http-equiv="refresh" content="0; url=/index.html">
</head>
<body>
  <p>Redirecting to <a href="/">home page</a>...</p>
</body>
</html>

